<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üéØ Sistema de Avalia√ß√£o de Desempenho - Integrado com Google Sheets</title>
    <style>
        :root {
            --cor-primaria: #1e441e;     /* Emerald */
            --cor-secundaria: #8FD694;   /* Celadon */
            --cor-acento: #77AD78;       /* Asparagus */
            --cor-neutra: #6F8F72;       /* Reseda green */
            --cor-escura: #504B43;       /* Walnut brown */
            --cor-clara: #F8FAF9;
            --cor-branca: #FFFFFF;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            background: var(--cor-clara); 
            line-height: 1.6;
            color: var(--cor-escura);
            animation: fadeIn 0.5s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideInUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes slideInDown {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes slideInLeft {
            from { opacity: 0; transform: translateX(-20px); }
            to { opacity: 1; transform: translateX(0); }
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.02); }
        }

        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-8px); }
            60% { transform: translateY(-4px); }
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @keyframes shimmer {
            0% { background-position: -200% 0; }
            100% { background-position: 200% 0; }
        }

        .container { 
            max-width: 1200px; 
            margin: 0 auto; 
            padding: 20px;
            animation: slideInUp 0.6s ease-out;
        }

        /* Header */
        .main-header {
            background: linear-gradient(135deg, var(--cor-primaria) 0%, var(--cor-primaria) 100%);
            color: white;
            padding: 30px 0;
            text-align: center;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            margin-bottom: 30px;
            border-radius: 15px;
            animation: slideInDown 0.7s ease-out;
            position: relative;
            overflow: hidden;
        }

        .main-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
            animation: shimmer 3s infinite;
        }

        .main-header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            animation: bounce 1s ease-out 0.5s both;
        }

        .main-header p {
            animation: slideInUp 0.5s ease-out 0.8s both;
        }

        /* Navega√ß√£o */
        .nav-menu {
            background: var(--cor-branca);
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            margin-bottom: 30px;
            text-align: center;
            animation: slideInUp 0.6s ease-out 0.2s both;
        }

        .nav-btn {
            background: linear-gradient(135deg, var(--cor-primaria) 0%, var(--cor-primaria) 100%);
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px;
            transition: all 0.3s ease;
            font-weight: 600;
            position: relative;
            overflow: hidden;
        }

        .nav-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }

        .nav-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 15px rgba(125, 186, 132, 0.3);
        }

        .nav-btn:hover::before {
            left: 100%;
        }

        .nav-btn.active {
            background: linear-gradient(135deg, var(--cor-secundaria) 0%, var(--cor-secundaria) 100%);
            box-shadow: 0 4px 10px rgba(143, 214, 148, 0.4);
            animation: pulse 2s infinite;
        }

        /* Se√ß√µes */
        .section {
            background: var(--cor-branca);
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            margin-bottom: 30px;
            display: none;
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.5s ease;
        }

        .section.active {
            display: block;
            animation: slideInUp 0.5s ease-out forwards;
        }

        .section h2 {
            color: var(--cor-secundaria);
            margin-bottom: 25px;
            font-size: 1.8em;
            border-bottom: 3px solid var(--cor-primaria);
            padding-bottom: 10px;
            animation: slideInLeft 0.6s ease-out;
        }

        /* Forms */
        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .form-group {
            margin-bottom: 20px;
            animation: slideInLeft 0.5s ease-out;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--cor-escura);
            transition: all 0.3s ease;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            border-color: var(--cor-primaria);
            outline: none;
            box-shadow: 0 0 10px rgba(125, 186, 132, 0.2);
            transform: translateY(-2px);
        }

        /* Bot√µes */
        .btn {
            background: linear-gradient(135deg, var(--cor-primaria) 0%, var(--cor-primaria) 100%);
            color: white;
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            margin: 5px;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            transition: width 0.4s, height 0.4s;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(125, 186, 132, 0.3);
        }

        .btn:hover::before {
            width: 300px;
            height: 300px;
        }

        .btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .btn-success {
            background: linear-gradient(135deg, var(--cor-primaria) 0%, var(--cor-primaria) 100%);
        }

        .btn-danger {
            background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
        }

        .btn-warning {
            background: linear-gradient(135deg, #ffc107 0%, #e0a800 100%);
        }

        .btn-info {
            background: linear-gradient(135deg, var(--cor-primaria) 0%, var(--cor-primaria) 100%);
        }

        .btn-sm {
            padding: 8px 15px;
            font-size: 12px;
        }

        /* Stats */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .stat-card {
            background: linear-gradient(135deg, var(--cor-primaria) 0%, var(--cor-primaria) 100%);
            color: white;
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            transition: all 0.3s ease;
            animation: slideInUp 0.6s ease-out;
            cursor: pointer;
        }

        .stat-card:hover {
            transform: translateY(-5px) scale(1.02);
            box-shadow: 0 8px 20px rgba(30, 68, 30, 0.3);
        }

        .stat-number {
            font-size: 2.5em;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .stat-label {
            font-size: 1em;
            opacity: 0.9;
        }

        /* Loading */
        .loading {
            display: none;
            text-align: center;
            padding: 20px;
            animation: fadeIn 0.5s ease-out;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid var(--cor-primaria);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }

        /* Alert */
        .alert {
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            border-left: 5px solid;
            animation: slideInLeft 0.5s ease-out;
        }

        .alert-success {
            background: rgba(143, 214, 148, 0.1);
            border-color: var(--cor-secundaria);
            color: var(--cor-acento);
        }

        .alert-danger {
            background: #f8d7da;
            border-color: #dc3545;
            color: #721c24;
        }

        .alert-warning {
            background: #fff3cd;
            border-color: #ffc107;
            color: #856404;
        }

        .alert-info {
            background: rgba(111, 143, 114, 0.1);
            border-color: var(--cor-neutra);
            color: var(--cor-escura);
        }

        /* Compet√™ncias */
        .competencia-card {
            background: #f8faf9;
            border: 1px solid #e0e0e0;
            border-radius: 15px;
            margin: 20px 0;
            overflow: hidden;
            transition: all 0.3s ease;
            animation: slideInUp 0.6s ease-out;
        }

        .competencia-header {
            background: linear-gradient(135deg, var(--cor-primaria) 0%, var(--cor-acento) 100%);
            color: white;
            padding: 20px;
            font-size: 1.2em;
            font-weight: bold;
        }

        .fator-item {
            padding: 20px;
            border-bottom: 1px solid #eee;
        }

        .fator-texto {
            margin-bottom: 15px;
            font-weight: 500;
            color: var(--cor-escura);
        }

        .rating-container {
            display: flex;
            align-items: center;
            gap: 15px;
            flex-wrap: wrap;
        }

        .rating-label {
            font-size: 12px;
            color: var(--cor-neutra);
            font-weight: 600;
        }

        .rating-option {
            display: flex;
            flex-direction: column;
            align-items: center;
            cursor: pointer;
            padding: 10px;
            border-radius: 8px;
            transition: all 0.3s ease;
        }

        .rating-option:hover {
            background: rgba(125, 186, 132, 0.1);
            transform: scale(1.05);
        }

        .rating-option input[type="radio"] {
            margin-bottom: 5px;
            transform: scale(1.2);
            accent-color: var(--cor-primaria);
        }

        /* Progress */
        .progress-container {
            background: var(--cor-branca);
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin: 20px 0;
        }

        .progress-bar {
            width: 100%;
            height: 25px;
            background: #e0e0e0;
            border-radius: 15px;
            overflow: hidden;
            margin: 10px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(135deg, var(--cor-secundaria) 0%, var(--cor-primaria) 100%);
            width: 0%;
            transition: width 0.8s ease;
            border-radius: 15px;
        }

        /* Resultado */
        .resultado-card {
            background: linear-gradient(135deg, #f8faf9 0%, #e9f5ea 100%);
            border: 2px solid var(--cor-secundaria);
            border-radius: 15px;
            padding: 30px;
            text-align: center;
            margin: 30px 0;
            display: none;
        }

        .resultado-card.show {
            display: block;
            animation: slideInUp 0.8s ease-out;
        }

        .pontuacao-display {
            font-size: 3em;
            font-weight: bold;
            margin: 20px 0;
            color: var(--cor-primaria);
        }

        .classificacao-display {
            font-size: 1.5em;
            font-weight: bold;
            padding: 15px 30px;
            border-radius: 50px;
            margin: 20px 0;
            display: inline-block;
            background: var(--cor-primaria);
            color: white;
        }

        /* Info Cards */
        .info-card {
            background: var(--cor-branca);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            margin: 20px 0;
            animation: slideInUp 0.6s ease-out;
        }
    </style>
</head>
<body>
    <!-- Header Principal -->
    <header class="main-header">
        <div class="container">
            <h1>üéØ SISTEMA DE AVALIA√á√ÉO DE DESEMPENHO</h1>
            <p>Integrado com Google Sheets - Dados Compartilhados</p>
        </div>

    <!-- Cr√©ditos do Desenvolvedor -->
    <footer style="background: var(--cor-primaria); color: white; text-align: center; padding: 15px; margin-top: 50px;">
        <div class="container">
            <p style="margin: 2px 0; font-size: 11px; opacity: 0.7;">
                Desenvolvido por Juliano Patrick | julianocorrea@bateforte.com.br | Sistema v2.1 - Google Sheets ¬© 2025
            </p>
        </div>
    </footer>
    </header>

    <div class="container">
        <!-- Menu de Navega√ß√£o -->
        <nav class="nav-menu">
            <button class="nav-btn active" onclick="showSection('home')">üè† Home</button>
            <button class="nav-btn" onclick="showSection('avaliacao')">üìù Nova Avalia√ß√£o</button>
            <button class="nav-btn" id="btnHistorico" onclick="verificarAcessoHistorico()">üìã Hist√≥rico</button>
            <button class="nav-btn" id="btnConfiguracoes" onclick="verificarAcessoConfiguracoes()">‚öôÔ∏è Configura√ß√µes</button>
        </nav>

        <!-- Se√ß√£o Home -->
        <section id="home" class="section active">
            <h2>üè† Sistema Integrado com Google Sheets</h2>
            
            <div class="alert alert-info">
                <h4>üîó Sistema Conectado ao Google Sheets</h4>
                <p><strong>Todos os usu√°rios agora compartilham os mesmos dados!</strong></p>
                <ul style="margin: 10px 0; padding-left: 30px;">
                    <li>‚úÖ Avalia√ß√µes sincronizadas em tempo real</li>
                    <li>‚úÖ Colaboradores e gestores compartilhados</li>
                    <li>‚úÖ Hist√≥rico centralizado na nuvem</li>
                    <li>‚úÖ Backup autom√°tico no Google Sheets</li>
                    <li>‚úÖ Acesso de qualquer lugar</li>
                </ul>
                <p><strong>Status:</strong> <span id="statusConexaoHome">Verificando...</span></p>
            </div>
            
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-number" id="totalAvaliacoesHome">0</div>
                    <div class="stat-label">Avalia√ß√µes Realizadas</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="mediaGeralHome">0.00</div>
                    <div class="stat-label">M√©dia Geral</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="excelentesHome">0</div>
                    <div class="stat-label">Avalia√ß√µes Excelentes</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="usuariosOnline">1</div>
                    <div class="stat-label">Usu√°rios Conectados</div>
                </div>
            </div>

            <div class="info-card">
                <h3>üìã Sobre o Sistema Integrado</h3>
                <p>Esta vers√£o est√° integrada ao Google Sheets, permitindo que todos os usu√°rios compartilhem os mesmos dados em tempo real.</p>
                
                <h4 style="margin-top: 20px;">üéØ Compet√™ncias Avaliadas:</h4>
                <ul style="margin: 15px 0; padding-left: 30px;">
                    <li><strong>Comunica√ß√£o e Influ√™ncia</strong> - 5 fatores</li>
                    <li><strong>Disciplina de Execu√ß√£o</strong> - 5 fatores</li>
                    <li><strong>Foco em Resultados</strong> - 5 fatores</li>
                    <li><strong>Foco no Cliente/Tutor</strong> - 5 fatores</li>
                    <li><strong>Lideran√ßa e Gest√£o de Pessoas</strong> - 6 fatores</li>
                    <li><strong>Postura de Dono</strong> - 5 fatores</li>
                </ul>

                <h4>üîß Comandos √öteis (Console):</h4>
                <ul style="margin: 15px 0; padding-left: 30px;">
                    <li><code>sistemaGG.sincronizar()</code> - For√ßar sincroniza√ß√£o</li>
                    <li><code>sistemaGG.testarConexao()</code> - Testar conex√£o</li>
                    <li><code>sistemaGG.backup()</code> - Fazer backup</li>
                    <li><code>sistemaGG.info()</code> - Ver informa√ß√µes</li>
                </ul>
            </div>
        </section>

        <!-- Se√ß√£o Nova Avalia√ß√£o -->
        <section id="avaliacao" class="section">
            <h2>üìù Nova Avalia√ß√£o</h2>

            <!-- Dados Pessoais -->
            <div class="info-card">
                <h3>üë§ Dados Pessoais</h3>
                <div class="form-row">
                    <div class="form-group">
                        <label for="matriculaAvaliado">Matr√≠cula do Avaliado *</label>
                        <input type="text" id="matriculaAvaliado" required placeholder="Digite a matr√≠cula...">
                    </div>
                    <div class="form-group">
                        <label for="nomeAvaliado">Nome do Avaliado</label>
                        <input type="text" id="nomeAvaliado" readonly style="background: #f0f0f0;">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="funcaoAvaliado">Fun√ß√£o do Avaliado</label>
                        <input type="text" id="funcaoAvaliado" readonly style="background: #f0f0f0;">
                    </div>
                    <div class="form-group">
                        <label for="filial">Filial</label>
                        <input type="text" id="filial" readonly style="background: #f0f0f0;">
                    </div>
                </div>
                
                <hr style="margin: 30px 0; border: 1px solid #e0e0e0;">
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="matriculaGestor">Matr√≠cula do Gestor *</label>
                        <input type="text" id="matriculaGestor" required placeholder="Digite a matr√≠cula do gestor...">
                    </div>
                    <div class="form-group">
                        <label for="nomeGestor">Nome do Gestor</label>
                        <input type="text" id="nomeGestor" readonly style="background: #f0f0f0;">
                    </div>
                </div>
            </div>

            <!-- Progresso -->
            <div class="progress-container">
                <h3>üìä Progresso da Avalia√ß√£o</h3>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
                <div class="progress-text" id="progressText">0 de 31 fatores avaliados</div>
            </div>

            <!-- Compet√™ncias -->
            <div id="competenciasContainer">
                <!-- Ser√° preenchido dinamicamente -->
            </div>

            <!-- Feedback -->
            <div class="info-card">
                <h3>üí¨ Feedback e Coment√°rios</h3>
                <div class="form-group">
                    <label for="pontosFortes">Pontos Fortes</label>
                    <textarea id="pontosFortes" rows="4" placeholder="Principais pontos fortes identificados..."></textarea>
                </div>
                <div class="form-group">
                    <label for="oportunidades">Oportunidades de Desenvolvimento</label>
                    <textarea id="oportunidades" rows="4" placeholder="√Åreas que precisam de desenvolvimento..."></textarea>
                </div>
                <div class="form-group">
                    <label for="comentarios">Coment√°rios Gerais</label>
                    <textarea id="comentarios" rows="4" placeholder="Coment√°rios adicionais sobre a avalia√ß√£o..."></textarea>
                </div>
            </div>

            <!-- Resultado -->
            <div id="resultadoCard" class="resultado-card">
                <h3>üìä Resultado da Avalia√ß√£o</h3>
                <div class="pontuacao-display" id="pontuacaoDisplay">0.00/5.00</div>
                <div class="classificacao-display" id="classificacaoDisplay">-</div>
                <div id="laudoResumo" style="margin-top: 20px; font-size: 1.1em; line-height: 1.6;"></div>
            </div>

            <!-- A√ß√µes -->
            <div style="text-align: center; margin: 30px 0;">
                <button class="btn btn-info" onclick="calcularResultado()">üìä Calcular Resultado</button>
                <button class="btn btn-success" onclick="salvarAvaliacao()" id="btnSalvar" disabled>‚òÅÔ∏è Salvar no Google Sheets</button>
                <button class="btn" onclick="limparFormulario()">üóëÔ∏è Limpar Formul√°rio</button>
            </div>

            <div class="loading" id="loading">
                <div class="spinner"></div>
                <p>Salvando no Google Sheets...</p>
            </div>
        </section>

        <!-- Se√ß√£o de Login para Hist√≥rico -->
        <section id="loginHistorico" class="section">
            <h2>üîê Acesso ao Hist√≥rico</h2>
            
            <div class="login-card">
                <h3 class="login-title">üîí Digite a Senha de Acesso</h3>
                
                <div class="form-group">
                    <input type="password" id="senhaHistorico" class="login-input" placeholder="Digite a senha..." onkeypress="verificarEnterHistorico(event)">
                </div>
                
                <button class="btn btn-success" onclick="validarSenhaHistorico()">üîì Acessar Hist√≥rico</button>
                <button class="btn" onclick="showSection('home')">‚ùå Cancelar</button>
                
                <div class="access-info">
                    <h4>‚ÑπÔ∏è Informa√ß√µes de Acesso</h4>
                    <p><strong>Controle de Acesso por Filial:</strong></p>
                    <ul style="text-align: left; margin: 15px 0;">
                        <li>üîë Cada filial possui sua senha espec√≠fica</li>
                        <li>üîí GGMASTER: Acesso a todas as filiais</li>
                        <li>üîí GGMASTERJP: Acesso total administrativo</li>
                        <li>üìû Entre em contato para obter sua senha</li>
                    </ul>
                    <div class="access-levels">
                        <span class="access-level level-master">MASTER</span>
                        <span class="access-level level-filial">FILIAL</span>
                    </div>
                </div>
            </div>
        </section>

        <!-- Se√ß√£o de Login para Configura√ß√µes -->
        <section id="loginConfiguracoes" class="section">
            <h2>‚öôÔ∏è Acesso √†s Configura√ß√µes</h2>
            
            <div class="login-card">
                <h3 class="login-title">üîí √Årea Restrita - Configura√ß√µes</h3>
                
                <div class="form-group">
                    <input type="password" id="senhaConfiguracoes" class="login-input" placeholder="Digite a senha de administrador..." onkeypress="verificarEnterConfig(event)">
                </div>
                
                <button class="btn btn-success" onclick="validarSenhaConfiguracoes()">üîì Acessar Configura√ß√µes</button>
                <button class="btn" onclick="showSection('home')">‚ùå Cancelar</button>
                
                <div class="access-info">
                    <h4>‚ÑπÔ∏è √Årea Administrativa</h4>
                    <p><strong>Acesso Restrito:</strong></p>
                    <ul style="text-align: left; margin: 15px 0;">
                        <li>üîí Apenas administradores autorizados</li>
                        <li>‚öôÔ∏è Configura√ß√£o de colaboradores e gestores</li>
                        <li>üìã Importa√ß√£o de dados via planilha</li>
                        <li>üîß Configura√ß√µes do sistema</li>
                    </ul>
                    <p style="margin-top: 15px; font-size: 0.9em; color: #666;">
                        <strong>Senha requerida:</strong> GGMASTERJP
                    </p>
                </div>
            </div>
        </section>

        <!-- Se√ß√£o Hist√≥rico -->
        <section id="historico" class="section">
            <div id="accessStatus" class="access-status" style="display: none;">
                <!-- Status ser√° preenchido dinamicamente -->
            </div>

            <h2>üìã Hist√≥rico de Avalia√ß√µes</h2>

            <div class="alert alert-success">
                <p>üîó <strong>Dados sincronizados com Google Sheets</strong> - Todas as avalia√ß√µes est√£o sendo carregadas da nuvem em tempo real.</p>
            </div>

            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-number" id="totalAvaliacoes">0</div>
                    <div class="stat-label">Total de Avalia√ß√µes</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="mediaGeral">0.00</div>
                    <div class="stat-label">M√©dia Geral</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="excelentes">0</div>
                    <div class="stat-label">Excelentes</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="precisamMelhorar">0</div>
                    <div class="stat-label">Precisam Melhorar</div>
                </div>
            </div>

            <div style="text-align: center; margin: 30px 0;">
                <button class="btn btn-info" onclick="carregarHistorico()">üîÑ Sincronizar com Google Sheets</button>
                <button class="btn btn-warning" onclick="exportarDados()">üì• Exportar Dados</button>
            </div>

            <div id="tabelaHistorico">
                <p style="text-align: center; padding: 30px; color: #666;">
                    üìä Carregando dados do Google Sheets...
                </p>
            </div>
        </section>

        <!-- Se√ß√£o Configura√ß√µes -->
        <section id="configuracoes" class="section">
            <div id="configStatus" class="access-status" style="display: none;">
                <!-- Status ser√° preenchido dinamicamente -->
            </div>

            <h2>‚öôÔ∏è Configura√ß√µes do Sistema</h2>

            <div class="alert alert-warning">
                <h4>üîß Configura√ß√£o da Integra√ß√£o</h4>
                <p><strong>URL da Web App:</strong> <span id="webappUrl">N√£o configurada</span></p>
                <button class="btn btn-sm" onclick="configurarWebApp()">üîó Configurar URL</button>
            </div>

            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-number" id="totalColaboradores">0</div>
                    <div class="stat-label">Colaboradores</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="totalGestoresConfig">0</div>
                    <div class="stat-label">Gestores</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="statusSincronizacao">OK</div>
                    <div class="stat-label">Status Sync</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="ultimaSync">Agora</div>
                    <div class="stat-label">√öltima Sync</div>
                </div>
            </div>

            <!-- Importa√ß√£o de Colaboradores -->
            <div class="info-card">
                <h3>üë• Importar Colaboradores (Sincroniza com Google Sheets)</h3>
                <p>Arquivo ser√° salvo no Google Sheets e ficar√° dispon√≠vel para todos os usu√°rios.</p>
                
                <div class="form-group">
                    <label for="arquivoColaboradores">Arquivo de Colaboradores (CSV)</label>
                    <input type="file" id="arquivoColaboradores" accept=".csv" style="width: 100%; padding: 12px; border: 2px dashed var(--cor-primaria); border-radius: 8px;">
                </div>
                
                <div style="text-align: center; margin: 20px 0;">
                    <button class="btn btn-info" onclick="importarColaboradores()">‚òÅÔ∏è Importar para Google Sheets</button>
                    <button class="btn btn-warning" onclick="baixarModeloColaboradores()">üì• Baixar Modelo</button>
                </div>
            </div>

            <!-- Importa√ß√£o de Gestores -->
            <div class="info-card">
                <h3>üëî Importar Gestores (Sincroniza com Google Sheets)</h3>
                <p>Arquivo ser√° salvo no Google Sheets e ficar√° dispon√≠vel para todos os usu√°rios.</p>
                
                <div class="form-group">
                    <label for="arquivoGestores">Arquivo de Gestores (CSV)</label>
                    <input type="file" id="arquivoGestores" accept=".csv" style="width: 100%; padding: 12px; border: 2px dashed var(--cor-primaria); border-radius: 8px;">
                </div>
                
                <div style="text-align: center; margin: 20px 0;">
                    <button class="btn btn-info" onclick="importarGestores()">‚òÅÔ∏è Importar para Google Sheets</button>
                    <button class="btn btn-warning" onclick="baixarModeloGestores()">üì• Baixar Modelo</button>
                </div>
            </div>

            <!-- A√ß√µes Avan√ßadas -->
            <div class="info-card">
                <h3>üîß A√ß√µes Avan√ßadas</h3>
                <div style="text-align: center; margin: 20px 0;">
                    <button class="btn btn-success" onclick="testarConexaoSheets()">üß™ Testar Conex√£o</button>
                    <button class="btn btn-info" onclick="sincronizarDados()">üîÑ Sincronizar Dados</button>
                    <button class="btn btn-warning" onclick="backupGoogleSheets()">üíæ Backup Google Sheets</button>
                </div>
            </div>
        </section>
    </div>

    <script>
        // =====================================================
        // CONFIGURA√á√ÉO DA INTEGRA√á√ÉO GOOGLE SHEETS
        // =====================================================

        // URL da Web App do Google Apps Script (SUBSTITUA PELA SUA URL)
        let WEBAPP_URL = 'SUA_URL_DO_GOOGLE_APPS_SCRIPT_AQUI';

        // Cache local para performance
        let cacheLocal = {
            avaliacoes: [],
            colaboradores: {},
            gestores: {},
            ultimaAtualizacao: null
        };

        // Vari√°veis globais
        let avaliacoes = [];
        let colaboradores = {};
        let gestores = {};
        let avaliacaoAtual = null;

        // Compet√™ncias do sistema
        const COMPETENCIAS = [
            {
                nome: 'COMUNICA√á√ÉO E INFLU√äNCIA',
                fatores: [
                    'Tem clareza, √© emp√°tico(a) e inclusivo(a) na sua comunica√ß√£o.',
                    'Possui habilidades em comunicar temas cr√≠ticos, transmitindo confian√ßa ao time.',
                    '√â influenciador(a) e inspira seu time e a rede de relacionamento pelo exemplo.',
                    'Respeita as opini√µes divergentes, escuta de maneira aberta.',
                    'Cria um ambiente de seguran√ßa e confian√ßa m√∫tua.'
                ]
            },
            {
                nome: 'DISCIPLINA DE EXECU√á√ÉO',
                fatores: [
                    'Garante planejamento e execu√ß√£o com efici√™ncia dentro dos prazos.',
                    'Constr√≥i regras e processos e busca eliminar burocracias desnecess√°rias.',
                    'Assume responsabilidade, cumpre normas e procedimentos.',
                    'Estimula o time para que esteja comprometido com prazos e entregas.',
                    'Garante n√≠veis excelentes de qualidade nas entregas.'
                ]
            },
            {
                nome: 'FOCO EM RESULTADOS',
                fatores: [
                    'Possui consist√™ncia nas entregas.',
                    'Tem flexibilidade para liderar diferentes frentes.',
                    'Elabora e cumpre planos de a√ß√µes para o atingimento das metas.',
                    'Conhece o neg√≥cio e acompanha resultados atrav√©s de dados.',
                    'Estimula o time para possu√≠rem vis√£o cr√≠tica e trazerem solu√ß√µes.'
                ]
            },
            {
                nome: 'FOCO NO CLIENTE/TUTOR',
                fatores: [
                    'Entende, prioriza e antecipa as necessidades dos clientes.',
                    'Constr√≥i alian√ßas com clientes, pares, √°reas parceiras.',
                    'Implementa novas solu√ß√µes para atingir expectativas do cliente.',
                    'Direciona o time para conhecer as necessidades dos clientes.',
                    'Desenvolve a√ß√µes efetivas e de sucesso para os clientes.'
                ]
            },
            {
                nome: 'LIDERAN√áA E GEST√ÉO DE PESSOAS',
                fatores: [
                    'Age com clareza na distribui√ß√£o dos pap√©is e responsabilidades.',
                    'Sabe identificar desafios compat√≠veis com a capacidade de cada um.',
                    'Estimula e conduz o time para que alcance/supere as metas.',
                    'Direciona o time com clareza para as atividades.',
                    'Orienta, d√° feedbacks efetivos e acompanha evolu√ß√µes.',
                    'Possui preocupa√ß√£o genu√≠na com as pessoas e desenvolve liderados.'
                ]
            },
            {
                nome: 'POSTURA DE DONO',
                fatores: [
                    'Possui senso de urg√™ncia e sabe direcionar o time.',
                    'Assume responsabilidade e n√£o terceiriza para outras √°reas.',
                    '√â exemplo e estimula o time a ser inconformado com entregas.',
                    '√â atento √†s tend√™ncias de mercado e busca aplic√°-las.',
                    '√â atento e gerencia os desperd√≠cios e custos.'
                ]
            }
        ];

        // =====================================================
        // FUN√á√ïES DE COMUNICA√á√ÉO COM GOOGLE SHEETS
        // =====================================================

        async function enviarParaGoogleSheets(acao, dados = {}) {
            if (!WEBAPP_URL || WEBAPP_URL === 'SUA_URL_DO_GOOGLE_APPS_SCRIPT_AQUI') {
                throw new Error('URL da Web App n√£o configurada. Configure em Configura√ß√µes.');
            }

            try {
                mostrarLoading(true);
                console.log('üì§ Enviando para Google Sheets:', acao);
                
                const payload = { acao: acao, ...dados };
                
                const response = await fetch(WEBAPP_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const resultado = await response.json();
                console.log('üì• Resposta do Google Sheets:', resultado);
                
                return resultado;
                
            } catch (error) {
                console.error('‚ùå Erro na comunica√ß√£o:', error);
                throw error;
            } finally {
                mostrarLoading(false);
            }
        }

        async function buscarDoGoogleSheets(acao) {
            if (!WEBAPP_URL || WEBAPP_URL === 'SUA_URL_DO_GOOGLE_APPS_SCRIPT_AQUI') {
                console.log('‚ö†Ô∏è URL n√£o configurada, usando dados locais');
                return usarCacheLocal(acao);
            }

            try {
                const response = await fetch(`${WEBAPP_URL}?acao=${acao}`, { method: 'GET' });
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const resultado = await response.json();
                console.log('üìã Dados recebidos:', acao, resultado.dados?.length || Object.keys(resultado.dados || {}).length);
                
                return resultado;
                
            } catch (error) {
                console.error('‚ùå Erro na busca:', error);
                return usarCacheLocal(acao);
            }
        }

        function usarCacheLocal(acao) {
            console.log('üíæ Usando cache local para:', acao);
            
            switch(acao) {
                case 'buscar_avaliacoes':
                    return { sucesso: true, dados: cacheLocal.avaliacoes || [], mensagem: 'Cache local' };
                case 'buscar_colaboradores':
                    return { sucesso: true, dados: cacheLocal.colaboradores || {}, mensagem: 'Cache local' };
                case 'buscar_gestores':
                    return { sucesso: true, dados: cacheLocal.gestores || {}, mensagem: 'Cache local' };
                default:
                    return { sucesso: false, mensagem: 'N√£o dispon√≠vel no cache' };
            }
        }

        // =====================================================
        // FUN√á√ïES PRINCIPAIS DO SISTEMA
        // =====================================================

        async function carregarDadosSalvos() {
            console.log('üìÇ Carregando dados...');
            
            try {
                // Tentar carregar do Google Sheets
                const [resAvaliacoes, resColaboradores, resGestores] = await Promise.all([
                    buscarDoGoogleSheets('buscar_avaliacoes'),
                    buscarDoGoogleSheets('buscar_colaboradores'),
                    buscarDoGoogleSheets('buscar_gestores')
                ]);
                
                if (resAvaliacoes.sucesso) {
                    avaliacoes = resAvaliacoes.dados || [];
                    cacheLocal.avaliacoes = avaliacoes;
                }
                
                if (resColaboradores.sucesso) {
                    colaboradores = resColaboradores.dados || {};
                    cacheLocal.colaboradores = colaboradores;
                }
                
                if (resGestores.sucesso) {
                    gestores = resGestores.dados || {};
                    cacheLocal.gestores = gestores;
                }
                
                cacheLocal.ultimaAtualizacao = new Date();
                
                console.log('‚úÖ Dados carregados:', {
                    avaliacoes: avaliacoes.length,
                    colaboradores: Object.keys(colaboradores).length,
                    gestores: Object.keys(gestores).length
                });
                
                // Se n√£o h√° dados, criar exemplos
                if (avaliacoes.length === 0 && Object.keys(colaboradores).length === 0) {
                    await criarDadosExemplo();
                }
                
            } catch (error) {
                console.error('‚ùå Erro ao carregar:', error);
                carregarDadosDoLocalStorage();
            }
        }

        function carregarDadosDoLocalStorage() {
            console.log('üíæ Usando localStorage como fallback...');
            
            try {
                avaliacoes = JSON.parse(localStorage.getItem('avaliacoes_gg') || '[]');
                colaboradores = JSON.parse(localStorage.getItem('colaboradores_gg') || '{}');
                gestores = JSON.parse(localStorage.getItem('gestores_gg') || '{}');
                
                cacheLocal = { avaliacoes, colaboradores, gestores, ultimaAtualizacao: new Date() };
                
            } catch (error) {
                console.error('‚ùå Erro no localStorage:', error);
                avaliacoes = [];
                colaboradores = {};
                gestores = {};
            }
        }

        async function salvarAvaliacao() {
            if (!avaliacaoAtual) {
                mostrarAlerta('‚ùå Calcule o resultado primeiro!', 'danger');
                return;
            }

            const nomeAvaliado = document.getElementById('nomeAvaliado').value;
            const nomeGestor = document.getElementById('nomeGestor').value;
            const filial = document.getElementById('filial').value;

            if (!nomeAvaliado || !nomeGestor || !filial) {
                mostrarAlerta('‚ùå Preencha os campos obrigat√≥rios!', 'danger');
                return;
            }

            const avaliacao = {
                id: 'AV' + Date.now(),
                data: new Date(),
                nomeAvaliado: nomeAvaliado,
                matricula: document.getElementById('matriculaAvaliado').value,
                funcaoAvaliado: document.getElementById('funcaoAvaliado').value,
                nomeGestor: nomeGestor,
                matriculaGestor: document.getElementById('matriculaGestor').value,
                filial: filial,
                regional: document.getElementById('regional').value || 'N/A',
                pontuacao: avaliacaoAtual.pontuacao.toFixed(2),
                classificacao: avaliacaoAtual.classificacao,
                pontosFortes: document.getElementById('pontosFortes').value,
                oportunidades: document.getElementById('oportunidades').value,
                comentarios: document.getElementById('comentarios').value,
                respostas: avaliacaoAtual.respostas || {}
            };

            try {
                const resultado = await enviarParaGoogleSheets('salvar_avaliacao', { avaliacao: avaliacao });
                
                if (resultado.sucesso) {
                    avaliacoes.push(avaliacao);
                    cacheLocal.avaliacoes = avaliacoes;
                    localStorage.setItem('avaliacoes_gg', JSON.stringify(avaliacoes));
                    
                    mostrarAlerta('‚úÖ Avalia√ß√£o salva no Google Sheets! ID: ' + avaliacao.id, 'success');
                    
                    document.getElementById('btnSalvar').textContent = '‚úÖ Salvo na Cloud!';
                    setTimeout(() => {
                        document.getElementById('btnSalvar').textContent = '‚òÅÔ∏è Salvar no Google Sheets';
                    }, 3000);
                    
                } else {
                    throw new Error(resultado.mensagem);
                }
                
            } catch (error) {
                console.error('‚ùå Erro ao salvar na cloud:', error);
                
                // Fallback para localStorage
                avaliacoes.push(avaliacao);
                localStorage.setItem('avaliacoes_gg', JSON.stringify(avaliacoes));
                mostrarAlerta('‚ö†Ô∏è Avalia√ß√£o salva localmente. Ser√° sincronizada quando poss√≠vel.', 'warning');
            }
        }

        async function importarColaboradores() {
            const arquivo = document.getElementById('arquivoColaboradores').files[0];
            if (!arquivo) {
                mostrarAlerta('‚ùå Selecione um arquivo primeiro!', 'danger');
                return;
            }

            mostrarLoading(true);
            
            const reader = new FileReader();
            reader.onload = async function(e) {
                try {
                    const dados = processarCSV(e.target.result);
                    
                    if (!dados || dados.length === 0) {
                        mostrarAlerta('‚ùå Arquivo vazio ou formato inv√°lido!', 'danger');
                        mostrarLoading(false);
                        return;
                    }

                    const novosColaboradores = {};
                    let processados = 0;

                    dados.forEach((linha) => {
                        if (linha.length >= 2) {
                            const matricula = linha[0]?.toString().trim();
                            const nome = linha[1]?.toString().trim();
                            const funcao = linha[2]?.toString().trim() || '';
                            const filial = linha[3]?.toString().trim() || '';
                            const regional = linha[4]?.toString().trim() || '';

                            if (matricula && nome) {
                                novosColaboradores[matricula] = { nome, funcao, filial, regional };
                                processados++;
                            }
                        }
                    });

                    if (processados === 0) {
                        mostrarAlerta('‚ùå Nenhum colaborador foi processado!', 'danger');
                        mostrarLoading(false);
                        return;
                    }

                    try {
                        const resultado = await enviarParaGoogleSheets('salvar_colaboradores', { 
                            colaboradores: novosColaboradores 
                        });
                        
                        if (resultado.sucesso) {
                            colaboradores = { ...colaboradores, ...novosColaboradores };
                            cacheLocal.colaboradores = colaboradores;
                            localStorage.setItem('colaboradores_gg', JSON.stringify(colaboradores));
                            
                            atualizarEstatisticasConfig();
                            mostrarAlerta(`‚úÖ ${processados} colaboradores salvos no Google Sheets!`, 'success');
                            
                        } else {
                            throw new Error(resultado.mensagem);
                        }
                        
                    } catch (error) {
                        console.error('‚ùå Erro ao salvar na cloud:', error);
                        colaboradores = { ...colaboradores, ...novosColaboradores };
                        localStorage.setItem('colaboradores_gg', JSON.stringify(colaboradores));
                        mostrarAlerta(`‚ö†Ô∏è ${processados} colaboradores salvos localmente.`, 'warning');
                    }

                } catch (error) {
                    console.error('‚ùå Erro na importa√ß√£o:', error);
                    mostrarAlerta('‚ùå Erro ao processar arquivo: ' + error.message, 'danger');
                } finally {
                    mostrarLoading(false);
                }
            };

            reader.readAsText(arquivo, 'UTF-8');
        }

        async function importarGestores() {
            const arquivo = document.getElementById('arquivoGestores').files[0];
            if (!arquivo) {
                mostrarAlerta('‚ùå Selecione um arquivo primeiro!', 'danger');
                return;
            }

            mostrarLoading(true);
            
            const reader = new FileReader();
            reader.onload = async function(e) {
                try {
                    const dados = processarCSV(e.target.result);
                    
                    if (!dados || dados.length === 0) {
                        mostrarAlerta('‚ùå Arquivo vazio ou formato inv√°lido!', 'danger');
                        mostrarLoading(false);
                        return;
                    }

                    const novosGestores = {};
                    let processados = 0;

                    dados.forEach((linha) => {
                        if (linha.length >= 2) {
                            const matricula = linha[0]?.toString().trim();
                            const nome = linha[1]?.toString().trim();
                            const funcao = linha[2]?.toString().trim() || '';
                            const filial = linha[3]?.toString().trim() || '';
                            const regional = linha[4]?.toString().trim() || '';

                            if (matricula && nome) {
                                novosGestores[matricula] = { nome, funcao, filial, regional };
                                processados++;
                            }
                        }
                    });

                    if (processados === 0) {
                        mostrarAlerta('‚ùå Nenhum gestor foi processado!', 'danger');
                        mostrarLoading(false);
                        return;
                    }

                    try {
                        const resultado = await enviarParaGoogleSheets('salvar_gestores', { 
                            gestores: novosGestores 
                        });
                        
                        if (resultado.sucesso) {
                            gestores = { ...gestores, ...novosGestores };
                            cacheLocal.gestores = gestores;
                            localStorage.setItem('gestores_gg', JSON.stringify(gestores));
                            
                            atualizarEstatisticasConfig();
                            mostrarAlerta(`‚úÖ ${processados} gestores salvos no Google Sheets!`, 'success');
                            
                        } else {
                            throw new Error(resultado.mensagem);
                        }
                        
                    } catch (error) {
                        console.error('‚ùå Erro ao salvar na cloud:', error);
                        gestores = { ...gestores, ...novosGestores };
                        localStorage.setItem('gestores_gg', JSON.stringify(gestores));
                        mostrarAlerta(`‚ö†Ô∏è ${processados} gestores salvos localmente.`, 'warning');
                    }

                } catch (error) {
                    console.error('‚ùå Erro na importa√ß√£o:', error);
                    mostrarAlerta('‚ùå Erro ao processar arquivo: ' + error.message, 'danger');
                } finally {
                    mostrarLoading(false);
                }
            };

            reader.readAsText(arquivo, 'UTF-8');
        }

        // =====================================================
        // FUN√á√ïES DE INTERFACE
        // =====================================================

        function showSection(sectionId) {
            document.querySelectorAll('.section').forEach(section => {
                section.classList.remove('active');
            });

            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('active');
            });

            document.getElementById(sectionId).classList.add('active');

            // Adicionar classe ativa ao bot√£o correto
            const botoes = document.querySelectorAll('.nav-btn');
            botoes.forEach(btn => {
                if (btn.onclick && btn.onclick.toString().includes(sectionId)) {
                    btn.classList.add('active');
                }
            });

            // Atualizar dados espec√≠ficos da se√ß√£o
            switch(sectionId) {
                case 'home':
                    atualizarEstatisticasHome();
                    break;
                case 'avaliacao':
                    inicializarFormularioAvaliacao();
                    break;
                case 'historico':
                    carregarHistorico();
                    break;
                case 'configuracoes':
                    atualizarEstatisticasConfig();
                    break;
            }
        }

        function inicializarFormularioAvaliacao() {
            criarFormularioCompetencias();
            atualizarProgresso();
            configurarBuscaAutomatica();
        }

        function criarFormularioCompetencias() {
            const container = document.getElementById('competenciasContainer');
            let html = '';
            let fatorIndex = 0;

            COMPETENCIAS.forEach((competencia) => {
                html += '<div class="competencia-card">';
                html += '<div class="competencia-header">' + competencia.nome + '</div>';

                competencia.fatores.forEach((fator) => {
                    html += '<div class="fator-item">';
                    html += '<div class="fator-texto">' + fator + '</div>';
                    html += '<div class="rating-container">';
                    html += '<span class="rating-label">Inadequado</span>';
                    
                    for(let i = 1; i <= 5; i++) {
                        html += '<label class="rating-option">';
                        html += '<input type="radio" name="fator_' + fatorIndex + '" value="' + i + '" onchange="atualizarProgresso()">';
                        html += '<span>' + i + '</span>';
                        html += '</label>';
                    }
                    
                    html += '<span class="rating-label">Excelente</span>';
                    html += '</div>';
                    html += '</div>';
                    fatorIndex++;
                });

                html += '</div>';
            });

            container.innerHTML = html;
        }

        function configurarBuscaAutomatica() {
            const campoMatriculaAvaliado = document.getElementById('matriculaAvaliado');
            if (campoMatriculaAvaliado) {
                campoMatriculaAvaliado.addEventListener('input', function() {
                    const matricula = this.value.trim();
                    if (matricula.length >= 3) {
                        const colaborador = colaboradores[matricula];
                        if (colaborador) {
                            document.getElementById('nomeAvaliado').value = colaborador.nome || '';
                            document.getElementById('funcaoAvaliado').value = colaborador.funcao || '';
                            document.getElementById('filial').value = colaborador.filial || '';
                            document.getElementById('regional').value = colaborador.regional || '';
                            
                            this.style.borderColor = 'var(--cor-secundaria)';
                            this.style.backgroundColor = 'rgba(143, 214, 148, 0.1)';
                        } else {
                            document.getElementById('nomeAvaliado').value = '';
                            document.getElementById('funcaoAvaliado').value = '';
                            document.getElementById('filial').value = '';
                            document.getElementById('regional').value = '';
                            
                            this.style.borderColor = '#e0e0e0';
                            this.style.backgroundColor = '';
                        }
                    }
                });
            }

            const campoMatriculaGestor = document.getElementById('matriculaGestor');
            if (campoMatriculaGestor) {
                campoMatriculaGestor.addEventListener('input', function() {
                    const matricula = this.value.trim();
                    if (matricula.length >= 3) {
                        const gestor = gestores[matricula];
                        if (gestor) {
                            document.getElementById('nomeGestor').value = gestor.nome || '';
                            
                            this.style.borderColor = 'var(--cor-secundaria)';
                            this.style.backgroundColor = 'rgba(143, 214, 148, 0.1)';
                        } else {
                            document.getElementById('nomeGestor').value = '';
                            
                            this.style.borderColor = '#e0e0e0';
                            this.style.backgroundColor = '';
                        }
                    }
                });
            }
        }

        function atualizarProgresso() {
            const totalFatores = 31;
            const fatoresAvaliados = document.querySelectorAll('input[type="radio"]:checked').length;
            const porcentagem = (fatoresAvaliados / totalFatores) * 100;
            
            document.getElementById('progressFill').style.width = porcentagem + '%';
            document.getElementById('progressText').textContent = fatoresAvaliados + ' de ' + totalFatores + ' fatores avaliados';
            
            return fatoresAvaliados;
        }

        function calcularResultado() {
            const fatoresAvaliados = atualizarProgresso();
            
            if (fatoresAvaliados === 0) {
                mostrarAlerta('‚ùå Avalie pelo menos um fator antes de calcular!', 'danger');
                return;
            }

            const radios = document.querySelectorAll('input[type="radio"]:checked');
            let somaNotas = 0;
            
            radios.forEach(radio => {
                somaNotas += parseInt(radio.value);
            });

            const pontuacao = fatoresAvaliados > 0 ? (somaNotas / fatoresAvaliados) : 0;
            let classificacao = '';
            
            if (pontuacao >= 4.5) {
                classificacao = 'EXCELENTE';
            } else if (pontuacao >= 3.5) {
                classificacao = 'BOM';
            } else if (pontuacao >= 2.5) {
                classificacao = 'REGULAR';
            } else {
                classificacao = 'PRECISA MELHORAR';
            }

            document.getElementById('pontuacaoDisplay').textContent = pontuacao.toFixed(2) + '/5.00';
            document.getElementById('classificacaoDisplay').textContent = classificacao;

            const laudoResumo = gerarLaudoResumo(pontuacao, classificacao);
            document.getElementById('laudoResumo').innerHTML = laudoResumo;

            document.getElementById('resultadoCard').classList.add('show');

            document.getElementById('btnSalvar').disabled = fatoresAvaliados < 15;

            avaliacaoAtual = {
                pontuacao: pontuacao,
                classificacao: classificacao,
                fatoresAvaliados: fatoresAvaliados,
                respostas: coletarRespostas()
            };

            if (fatoresAvaliados < 15) {
                mostrarAlerta('‚ö†Ô∏è Avalie pelo menos 15 fatores para poder salvar a avalia√ß√£o completa.', 'warning');
            }
        }

        function coletarRespostas() {
            const respostas = {};
            const radios = document.querySelectorAll('input[type="radio"]:checked');
            
            radios.forEach(radio => {
                respostas[radio.name] = radio.value;
            });

            return respostas;
        }

        function gerarLaudoResumo(pontuacao, classificacao) {
            let resumo = '';
            
            if (pontuacao >= 4.5) {
                resumo = '<strong style="color: var(--cor-primaria);">üéØ EXCELENTE DESEMPENHO!</strong><br>';
                resumo += 'O(a) avaliado(a) demonstra compet√™ncias excepcionais em lideran√ßa. ';
                resumo += 'Recomenda-se aproveitar seu potencial em projetos estrat√©gicos e como mentor(a) de outros l√≠deres.';
            } else if (pontuacao >= 3.5) {
                resumo = '<strong style="color: var(--cor-primaria);">üëç BOM DESEMPENHO!</strong><br>';
                resumo += 'O(a) avaliado(a) apresenta desempenho s√≥lido com oportunidades espec√≠ficas de desenvolvimento. ';
                resumo += 'Com investimento direcionado, pode alcan√ßar n√≠vel de excel√™ncia.';
            } else if (pontuacao >= 2.5) {
                resumo = '<strong style="color: #ffc107;">üìà DESEMPENHO REGULAR</strong><br>';
                resumo += '√â necess√°rio um plano de desenvolvimento estruturado. ';
                resumo += 'Recomenda-se coaching individual e acompanhamento pr√≥ximo para evolu√ß√£o das compet√™ncias.';
            } else {
                resumo = '<strong style="color: #dc3545;">üìö PRECISA MELHORAR</strong><br>';
                resumo += 'Necess√°ria interven√ß√£o imediata com programa intensivo de desenvolvimento. ';
                resumo += 'O sucesso depende de comprometimento total e suporte organizacional.';
            }

            return resumo;
        }

        function limparFormulario() {
            if (confirm('üóëÔ∏è Deseja realmente limpar todos os dados do formul√°rio?')) {
                document.getElementById('nomeAvaliado').value = '';
                document.getElementById('matriculaAvaliado').value = '';
                document.getElementById('funcaoAvaliado').value = '';
                document.getElementById('nomeGestor').value = '';
                document.getElementById('matriculaGestor').value = '';
                document.getElementById('filial').value = '';
                document.getElementById('regional').value = '';
                document.getElementById('pontosFortes').value = '';
                document.getElementById('oportunidades').value = '';
                document.getElementById('comentarios').value = '';

                document.querySelectorAll('input[type="radio"]').forEach(radio => {
                    radio.checked = false;
                });

                document.getElementById('resultadoCard').classList.remove('show');
                document.getElementById('btnSalvar').disabled = true;
                
                atualizarProgresso();
                avaliacaoAtual = null;

                mostrarAlerta('üóëÔ∏è Formul√°rio limpo com sucesso!', 'info');
            }
        }

        async function carregarHistorico() {
            console.log('üìã Carregando hist√≥rico...');
            
            try {
                mostrarLoading(true);
                await carregarDadosSalvos();
                atualizarEstatisticasHistorico();
                atualizarTabelaHistorico();
                mostrarAlerta('‚úÖ Hist√≥rico sincronizado com Google Sheets!', 'success');
                
            } catch (error) {
                console.error('‚ùå Erro ao carregar hist√≥rico:', error);
                mostrarAlerta('‚ùå Erro ao carregar hist√≥rico do Google Sheets.', 'danger');
            } finally {
                mostrarLoading(false);
            }
        }

        function atualizarEstatisticasHistorico() {
            const total = avaliacoes.length;
            let somaNotas = 0;
            let excelentes = 0;
            let precisamMelhorar = 0;

            avaliacoes.forEach(av => {
                const nota = parseFloat(av.pontuacao);
                somaNotas += nota;
                
                if (av.classificacao === 'EXCELENTE') excelentes++;
                if (av.classificacao === 'PRECISA MELHORAR') precisamMelhorar++;
            });

            const media = total > 0 ? (somaNotas / total).toFixed(2) : '0.00';

            animarNumero('totalAvaliacoes', total);
            animarNumero('mediaGeral', parseFloat(media));
            animarNumero('excelentes', excelentes);
            animarNumero('precisamMelhorar', precisamMelhorar);
        }

        function atualizarTabelaHistorico() {
            const container = document.getElementById('tabelaHistorico');
            
            if (avaliacoes.length === 0) {
                container.innerHTML = '<p style="text-align: center; padding: 30px; color: #666;">üì≠ Nenhuma avalia√ß√£o encontrada</p>';
                return;
            }

            let html = '<table style="width: 100%; border-collapse: collapse; margin: 20px 0;">';
            html += '<thead><tr style="background: var(--cor-primaria); color: white;">';
            html += '<th style="padding: 15px; border: 1px solid #ddd;">Data</th>';
            html += '<th style="padding: 15px; border: 1px solid #ddd;">Avaliado</th>';
            html += '<th style="padding: 15px; border: 1px solid #ddd;">Gestor</th>';
            html += '<th style="padding: 15px; border: 1px solid #ddd;">Filial</th>';
            html += '<th style="padding: 15px; border: 1px solid #ddd;">Pontua√ß√£o</th>';
            html += '<th style="padding: 15px; border: 1px solid #ddd;">Classifica√ß√£o</th>';
            html += '</tr></thead>';
            html += '<tbody>';

            avaliacoes.forEach(av => {
                const data = new Date(av.data).toLocaleDateString('pt-BR');
                html += '<tr style="transition: all 0.3s ease;">';
                html += '<td style="padding: 15px; border: 1px solid #ddd;">' + data + '</td>';
                html += '<td style="padding: 15px; border: 1px solid #ddd;">' + av.nomeAvaliado + '</td>';
                html += '<td style="padding: 15px; border: 1px solid #ddd;">' + av.nomeGestor + '</td>';
                html += '<td style="padding: 15px; border: 1px solid #ddd;">' + av.filial + '</td>';
                html += '<td style="padding: 15px; border: 1px solid #ddd;"><strong>' + av.pontuacao + '</strong></td>';
                html += '<td style="padding: 15px; border: 1px solid #ddd;">' + av.classificacao + '</td>';
                html += '</tr>';
            });

            html += '</tbody></table>';
            container.innerHTML = html;
        }

        function atualizarEstatisticasHome() {
            const total = avaliacoes.length;
            let somaNotas = 0;
            let excelentes = 0;

            avaliacoes.forEach(av => {
                somaNotas += parseFloat(av.pontuacao);
                if (av.classificacao === 'EXCELENTE') excelentes++;
            });

            const media = total > 0 ? (somaNotas / total).toFixed(2) : '0.00';

            animarNumero('totalAvaliacoesHome', total);
            animarNumero('mediaGeralHome', parseFloat(media));
            animarNumero('excelentesHome', excelentes);
            animarNumero('usuariosOnline', 1);
            
            // Atualizar status de conex√£o
            const statusEl = document.getElementById('statusConexaoHome');
            if (statusEl) {
                if (WEBAPP_URL && WEBAPP_URL !== 'SUA_URL_DO_GOOGLE_APPS_SCRIPT_AQUI') {
                    statusEl.innerHTML = 'üü¢ <strong>Conectado ao Google Sheets</strong>';
                    statusEl.style.color = 'var(--cor-primaria)';
                } else {
                    statusEl.innerHTML = 'üî¥ <strong>URL n√£o configurada</strong>';
                    statusEl.style.color = '#dc3545';
                }
            }
        }

        function atualizarEstatisticasConfig() {
            const totalColabs = Object.keys(colaboradores).length;
            const totalGests = Object.keys(gestores).length;

            animarNumero('totalColaboradores', totalColabs);
            animarNumero('totalGestoresConfig', totalGests);
            
            document.getElementById('statusSincronizacao').textContent = 'OK';
            document.getElementById('ultimaSync').textContent = 'Agora';
            
            // Atualizar URL exibida
            const urlEl = document.getElementById('webappUrl');
            if (urlEl) {
                if (WEBAPP_URL && WEBAPP_URL !== 'SUA_URL_DO_GOOGLE_APPS_SCRIPT_AQUI') {
                    urlEl.textContent = WEBAPP_URL.substring(0, 50) + '...';
                    urlEl.style.color = 'var(--cor-primaria)';
                } else {
                    urlEl.textContent = 'N√£o configurada';
                    urlEl.style.color = '#dc3545';
                }
            }
        }

        // =====================================================
        // FUN√á√ïES DE CONFIGURA√á√ÉO
        // =====================================================

        function configurarWebApp() {
            const novaURL = prompt('üîó Digite a URL da sua Web App do Google Apps Script:\n\n(Exemplo: https://script.google.com/macros/s/SEU_ID/exec)', WEBAPP_URL);
            
            if (novaURL && novaURL.trim()) {
                WEBAPP_URL = novaURL.trim();
                localStorage.setItem('webapp_url_gg', WEBAPP_URL);
                
                atualizarEstatisticasConfig();
                atualizarEstatisticasHome();
                
                mostrarAlerta('‚úÖ URL da Web App configurada com sucesso!', 'success');
                console.log('üîó URL configurada:', WEBAPP_URL);
            }
        }

        async function testarConexaoSheets() {
            try {
                mostrarLoading(true);
                const resultado = await buscarDoGoogleSheets('status');
                
                if (resultado.sucesso) {
                    mostrarAlerta('‚úÖ Conex√£o com Google Sheets funcionando perfeitamente!', 'success');
                } else {
                    mostrarAlerta('‚ö†Ô∏è Conectado, mas com problemas: ' + resultado.mensagem, 'warning');
                }
                
            } catch (error) {
                mostrarAlerta('‚ùå Erro na conex√£o: ' + error.message, 'danger');
            } finally {
                mostrarLoading(false);
            }
        }

        async function sincronizarDados() {
            try {
                mostrarLoading(true);
                await carregarDadosSalvos();
                
                atualizarEstatisticasHome();
                atualizarEstatisticasConfig();
                
                mostrarAlerta('‚úÖ Sincroniza√ß√£o completa realizada!', 'success');
                
            } catch (error) {
                mostrarAlerta('‚ùå Erro na sincroniza√ß√£o: ' + error.message, 'danger');
            } finally {
                mostrarLoading(false);
            }
        }

        async function backupGoogleSheets() {
            try {
                const resultado = await enviarParaGoogleSheets('backup_completo');
                
                if (resultado.sucesso) {
                    const blob = new Blob([JSON.stringify(resultado.dados, null, 2)], { type: 'application/json' });
                    const url = window.URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = 'backup_sheets_' + new Date().toISOString().split('T')[0] + '.json';
                    a.click();
                    window.URL.revokeObjectURL(url);
                    
                    mostrarAlerta('üíæ Backup do Google Sheets exportado!', 'success');
                } else {
                    throw new Error(resultado.mensagem);
                }
                
            } catch (error) {
                mostrarAlerta('‚ùå Erro no backup: ' + error.message, 'danger');
            }
        }

        // =====================================================
        // FUN√á√ïES AUXILIARES
        // =====================================================

        function processarCSV(conteudo) {
            const linhas = conteudo.split('\n');
            const dados = [];
            
            linhas.forEach((linha) => {
                if (linha.trim()) {
                    let campos;
                    
                    if (linha.includes(';')) {
                        campos = linha.split(';').map(campo => campo.trim().replace(/"/g, ''));
                    } else if (linha.includes(',')) {
                        campos = linha.split(',').map(campo => campo.trim().replace(/"/g, ''));
                    } else {
                        campos = [linha.trim()];
                    }
                    
                    dados.push(campos);
                }
            });

            // Remover cabe√ßalho se existir
            if (dados.length > 0) {
                const textoLinha = dados[0].join(' ').toLowerCase();
                if (textoLinha.includes('matricula') || textoLinha.includes('nome')) {
                    dados.shift();
                }
            }

            return dados;
        }

        function baixarModeloColaboradores() {
            const modelo = 'Matricula;Nome;Funcao;Filial;Regional\n12345;Jo√£o Silva;Analista;713;SP\n67890;Maria Santos;Coordenadora;743;MS';
            
            const blob = new Blob([modelo], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'modelo_colaboradores.csv';
            a.click();
            window.URL.revokeObjectURL(url);

            mostrarAlerta('üì• Modelo de colaboradores baixado!', 'info');
        }

        function baixarModeloGestores() {
            const modelo = 'Matricula;Nome;Funcao;Filial;Regional\nG001;Pedro Oliveira;Gerente;713;SP\nG002;Ana Costa;Supervisora;743;MS';
            
            const blob = new Blob([modelo], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'modelo_gestores.csv';
            a.click();
            window.URL.revokeObjectURL(url);

            mostrarAlerta('üì• Modelo de gestores baixado!', 'info');
        }

        function exportarDados() {
            if (avaliacoes.length === 0) {
                mostrarAlerta('‚ùå Nenhuma avalia√ß√£o para exportar!', 'danger');
                return;
            }

            let csv = 'Data,Avaliado,Matricula,Funcao,Gestor,Filial,Pontuacao,Classificacao\n';
            
            avaliacoes.forEach(av => {
                const linha = [
                    new Date(av.data).toLocaleDateString('pt-BR'),
                    av.nomeAvaliado,
                    av.matricula || '',
                    av.funcaoAvaliado || '',
                    av.nomeGestor,
                    av.filial,
                    av.pontuacao,
                    av.classificacao
                ].join(',');
                csv += linha + '\n';
            });

            const blob = new Blob([csv], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'avaliacoes_gg_' + new Date().toISOString().split('T')[0] + '.csv';
            a.click();
            window.URL.revokeObjectURL(url);

            mostrarAlerta('üì• Dados exportados com sucesso!', 'success');
        }

        function animarNumero(elementId, valorFinal, duracao = 1000) {
            const elemento = document.getElementById(elementId);
            if (!elemento) return;

            const valorInicial = parseFloat(elemento.textContent) || 0;
            const inicio = performance.now();

            function animar(tempoAtual) {
                const decorrido = tempoAtual - inicio;
                const progresso = Math.min(decorrido / duracao, 1);
                const progressoSuave = 1 - Math.pow(1 - progresso, 3);
                const valorAtual = valorInicial + (valorFinal - valorInicial) * progressoSuave;
                
                if (elementId.includes('media') || elementId.includes('Media')) {
                    elemento.textContent = valorAtual.toFixed(2);
                } else {
                    elemento.textContent = Math.round(valorAtual);
                }

                if (progresso < 1) {
                    requestAnimationFrame(animar);
                }
            }

            requestAnimationFrame(animar);
        }

        function mostrarAlerta(mensagem, tipo) {
            const alertasExistentes = document.querySelectorAll('.alert');
            alertasExistentes.forEach(alerta => alerta.remove());

            const alerta = document.createElement('div');
            alerta.className = 'alert alert-' + tipo;
            alerta.innerHTML = mensagem;

            const secaoAtiva = document.querySelector('.section.active');
            secaoAtiva.insertBefore(alerta, secaoAtiva.firstChild);

            setTimeout(() => {
                if (alerta.parentNode) {
                    alerta.remove();
                }
            }, 5000);
        }

        function mostrarLoading(mostrar) {
            const loading = document.getElementById('loading');
            if (loading) {
                loading.style.display = mostrar ? 'block' : 'none';
            }
        }

        async function criarDadosExemplo() {
            console.log('üÜï Criando dados de exemplo...');
            
            // Dados de exemplo
            const colaboradoresExemplo = {
                '12345': { nome: 'Jo√£o Silva', funcao: 'COORD. DE LOGISTICA', filial: '713', regional: 'SP' },
                '67890': { nome: 'Ana Costa', funcao: 'GERENTE DE OPERACOES', filial: '264', regional: 'SC' },
                '11111': { nome: 'Carlos Mendes', funcao: 'ANALISTA DE LOGISTICA', filial: '743', regional: 'MS' }
            };

            const gestoresExemplo = {
                'G001': { nome: 'Maria Santos', funcao: 'GERENTE GERAL', filial: '713', regional: 'SP' },
                'G002': { nome: 'Pedro Oliveira', funcao: 'GERENTE REGIONAL', filial: '264', regional: 'SC' },
                'G003': { nome: 'Fernanda Lima', funcao: 'SUPERVISORA GERAL', filial: '743', regional: 'MS' }
            };

            // Atualizar dados locais
            colaboradores = colaboradoresExemplo;
            gestores = gestoresExemplo;
            cacheLocal.colaboradores = colaboradores;
            cacheLocal.gestores = gestores;

            // Salvar localmente
            localStorage.setItem('colaboradores_gg', JSON.stringify(colaboradores));
            localStorage.setItem('gestores_gg', JSON.stringify(gestores));

            // Tentar salvar no Google Sheets se configurado
            if (WEBAPP_URL && WEBAPP_URL !== 'SUA_URL_DO_GOOGLE_APPS_SCRIPT_AQUI') {
                try {
                    await Promise.all([
                        enviarParaGoogleSheets('salvar_colaboradores', { colaboradores: colaboradoresExemplo }),
                        enviarParaGoogleSheets('salvar_gestores', { gestores: gestoresExemplo })
                    ]);
                    console.log('‚úÖ Dados de exemplo salvos no Google Sheets');
                } catch (error) {
                    console.log('‚ö†Ô∏è Dados de exemplo criados localmente apenas');
                }
            }

            console.log('‚úÖ Dados de exemplo criados');
        }

        // =====================================================
        // INICIALIZA√á√ÉO
        // =====================================================

        document.addEventListener('DOMContentLoaded', async function() {
            console.log('üîÑ Iniciando sistema integrado com Google Sheets...');
            
            // Carregar URL salva
            const urlSalva = localStorage.getItem('webapp_url_gg');
            if (urlSalva) {
                WEBAPP_URL = urlSalva;
            }
            
            // Carregar dados
            await carregarDadosSalvos();
            
            // Inicializar interface
            atualizarEstatisticasHome();
            
            console.log('üéØ Sistema integrado inicializado!');
        });

        // =====================================================
        // COMANDOS DE CONSOLE
        // =====================================================

        window.sistemaGG = {
            info: () => ({
                versao: '2.1.0 - Google Sheets Integration',
                totalAvaliacoes: avaliacoes.length,
                totalColaboradores: Object.keys(colaboradores).length,
                totalGestores: Object.keys(gestores).length,
                webappURL: WEBAPP_URL,
                cache: cacheLocal
            }),
            sincronizar: sincronizarDados,
            testarConexao: testarConexaoSheets,
            configurarURL: configurarWebApp,
            backup: backupGoogleSheets,
            cache: () => cacheLocal,
            avaliacoes: () => avaliacoes,
            colaboradores: () => colaboradores,
            gestores: () => gestores
        };

        console.log(`
üéØ SISTEMA G&G - VERS√ÉO GOOGLE SHEETS INTEGRATION
================================================
‚úÖ Sistema integrado com Google Sheets
‚úÖ Dados compartilhados entre usu√°rios
‚úÖ Sincroniza√ß√£o em tempo real
‚úÖ Fallback para localStorage
‚úÖ Interface otimizada
‚úÖ Comandos de console dispon√≠veis

üîó CONFIGURA√á√ÉO:
1. Configure a URL da Web App em Configura√ß√µes
2. Importe colaboradores e gestores
3. Comece a usar o sistema

üíª DESENVOLVIDO POR: Juliano Patrick
üìß CONTATO: julianocorrea@bateforte.com.br
================================================
        `);
        /* Info Cards */
        .info-card {
            background: var(--cor-branca);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            margin: 20px 0;
            animation: slideInUp 0.6s ease-out;
        }

        /* Login Cards */
        .login-card {
            background: var(--cor-branca);
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 8px 20px rgba(0,0,0,0.1);
            margin: 20px auto;
            max-width: 500px;
            text-align: center;
            animation: slideInUp 0.6s ease-out;
        }

        .login-title {
            color: var(--cor-primaria);
            margin-bottom: 30px;
            font-size: 1.5em;
            border-bottom: 3px solid var(--cor-secundaria);
            padding-bottom: 15px;
        }

        .login-input {
            width: 100%;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 16px;
            margin: 15px 0;
            text-align: center;
            transition: all 0.3s ease;
        }

        .login-input:focus {
            border-color: var(--cor-primaria);
            outline: none;
            box-shadow: 0 0 15px rgba(125, 186, 132, 0.3);
            transform: translateY(-2px);
        }

        .access-info {
            background: rgba(143, 214, 148, 0.1);
            border-radius: 15px;
            padding: 25px;
            margin-top: 30px;
            text-align: left;
        }

        .access-info h4 {
            color: var(--cor-primaria);
            margin-bottom: 15px;
        }

        .access-levels {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-top: 20px;
        }

        .access-level {
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            text-transform: uppercase;
        }

        .level-master {
            background: var(--cor-primaria);
            color: white;
        }

        .level-filial {
            background: var(--cor-secundaria);
            color: var(--cor-escura);
        }

        .access-status {
            background: linear-gradient(135deg, var(--cor-primaria) 0%, var(--cor-acento) 100%);
            color: white;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            text-align: center;
            animation: slideInDown 0.5s ease-out;
        }

        .access-status h4 {
            margin-bottom: 10px;
            font-size: 1.2em;
        }
    </script>
</body>
</html>
