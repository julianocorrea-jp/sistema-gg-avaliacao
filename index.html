<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üéØ Sistema de Avalia√ß√£o de Desempenho - Busca Autom√°tica</title>
    <style>
        :root {
            --cor-primaria: #1e441e;     
            --cor-secundaria: #8FD694;   
            --cor-acento: #77AD78;       
            --cor-neutra: #6F8F72;       
            --cor-escura: #504B43;       
            --cor-clara: #F8FAF9;
            --cor-branca: #FFFFFF;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            background: var(--cor-clara); 
            line-height: 1.6;
            color: var(--cor-escura);
            animation: fadeIn 0.5s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideInUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes slideInDown {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes slideInLeft {
            from { opacity: 0; transform: translateX(-20px); }
            to { opacity: 1; transform: translateX(0); }
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.02); }
        }

        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-8px); }
            60% { transform: translateY(-4px); }
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @keyframes shimmer {
            0% { background-position: -200% 0; }
            100% { background-position: 200% 0; }
        }

        .container { 
            max-width: 1200px; 
            margin: 0 auto; 
            padding: 20px;
            animation: slideInUp 0.6s ease-out;
        }

        /* Header */
        .main-header {
            background: linear-gradient(135deg, var(--cor-primaria) 0%, var(--cor-primaria) 100%);
            color: white;
            padding: 30px 0;
            text-align: center;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            margin-bottom: 30px;
            border-radius: 15px;
            animation: slideInDown 0.7s ease-out;
            position: relative;
            overflow: hidden;
        }

        .main-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
            animation: shimmer 3s infinite;
        }

        .main-header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            animation: bounce 1s ease-out 0.5s both;
        }

        .main-header p {
            animation: slideInUp 0.5s ease-out 0.8s both;
        }

        /* Navega√ß√£o */
        .nav-menu {
            background: var(--cor-branca);
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            margin-bottom: 30px;
            text-align: center;
            animation: slideInUp 0.6s ease-out 0.2s both;
        }

        .nav-btn {
            background: linear-gradient(135deg, var(--cor-primaria) 0%, var(--cor-primaria) 100%);
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px;
            transition: all 0.3s ease;
            font-weight: 600;
            position: relative;
            overflow: hidden;
        }

        .nav-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }

        .nav-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 15px rgba(125, 186, 132, 0.3);
        }

        .nav-btn:hover::before {
            left: 100%;
        }

        .nav-btn.active {
            background: linear-gradient(135deg, var(--cor-secundaria) 0%, var(--cor-secundaria) 100%);
            box-shadow: 0 4px 10px rgba(143, 214, 148, 0.4);
            animation: pulse 2s infinite;
        }

        /* Se√ß√µes */
        .section {
            background: var(--cor-branca);
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            margin-bottom: 30px;
            display: none;
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.5s ease;
        }

        .section.active {
            display: block;
            animation: slideInUp 0.5s ease-out forwards;
        }

        .section h2 {
            color: var(--cor-secundaria);
            margin-bottom: 25px;
            font-size: 1.8em;
            border-bottom: 3px solid var(--cor-primaria);
            padding-bottom: 10px;
            animation: slideInLeft 0.6s ease-out;
        }

        /* Login Cards */
        .login-card {
            background: linear-gradient(135deg, #f8faf9 0%, #e9f5ea 100%);
            border: 2px solid var(--cor-secundaria);
            border-radius: 20px;
            padding: 40px;
            text-align: center;
            margin: 30px 0;
            box-shadow: 0 8px 25px rgba(30, 68, 30, 0.1);
        }

        .login-title {
            color: var(--cor-primaria);
            margin-bottom: 30px;
            font-size: 1.5em;
        }

        .login-input {
            width: 100%;
            max-width: 400px;
            padding: 15px 20px;
            border: 2px solid var(--cor-primaria);
            border-radius: 50px;
            font-size: 16px;
            text-align: center;
            margin: 20px auto;
            display: block;
            transition: all 0.3s ease;
            background: rgba(255, 255, 255, 0.9);
        }

        .login-input:focus {
            outline: none;
            box-shadow: 0 0 20px rgba(30, 68, 30, 0.3);
            transform: translateY(-2px);
        }

        .access-info {
            background: rgba(255, 255, 255, 0.7);
            border-radius: 15px;
            padding: 25px;
            margin-top: 30px;
            text-align: left;
        }

        .access-info h4 {
            color: var(--cor-primaria);
            margin-bottom: 15px;
            text-align: center;
        }

        .access-levels {
            text-align: center;
            margin-top: 20px;
        }

        .access-level {
            display: inline-block;
            padding: 8px 15px;
            border-radius: 20px;
            margin: 5px;
            font-weight: bold;
            font-size: 12px;
        }

        .level-master {
            background: linear-gradient(135deg, var(--cor-primaria) 0%, var(--cor-acento) 100%);
            color: white;
        }

        .level-filial {
            background: linear-gradient(135deg, var(--cor-secundaria) 0%, var(--cor-neutra) 100%);
            color: white;
        }

        .access-status {
            background: var(--cor-primaria);
            color: white;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: center;
            font-weight: bold;
        }

        /* Forms */
        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .form-group {
            margin-bottom: 20px;
            animation: slideInLeft 0.5s ease-out;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--cor-escura);
            transition: all 0.3s ease;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            border-color: var(--cor-primaria);
            outline: none;
            box-shadow: 0 0 10px rgba(125, 186, 132, 0.2);
            transform: translateY(-2px);
        }

        /* Bot√µes */
        .btn {
            background: linear-gradient(135deg, var(--cor-primaria) 0%, var(--cor-primaria) 100%);
            color: white;
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            margin: 5px;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            transition: width 0.4s, height 0.4s;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(125, 186, 132, 0.3);
        }

        .btn:hover::before {
            width: 300px;
            height: 300px;
        }

        .btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .btn-success {
            background: linear-gradient(135deg, var(--cor-primaria) 0%, var(--cor-primaria) 100%);
        }

        .btn-danger {
            background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
        }

        .btn-warning {
            background: linear-gradient(135deg, #ffc107 0%, #e0a800 100%);
        }

        .btn-info {
            background: linear-gradient(135deg, var(--cor-primaria) 0%, var(--cor-primaria) 100%);
        }

        .btn-sm {
            padding: 8px 15px;
            font-size: 12px;
        }

        /* Stats */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .stat-card {
            background: linear-gradient(135deg, var(--cor-primaria) 0%, var(--cor-primaria) 100%);
            color: white;
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            transition: all 0.3s ease;
            animation: slideInUp 0.6s ease-out;
            cursor: pointer;
        }

        .stat-card:hover {
            transform: translateY(-5px) scale(1.02);
            box-shadow: 0 8px 20px rgba(30, 68, 30, 0.3);
        }

        .stat-number {
            font-size: 2.5em;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .stat-label {
            font-size: 1em;
            opacity: 0.9;
        }

        /* Loading */
        .loading {
            display: none;
            text-align: center;
            padding: 20px;
            animation: fadeIn 0.5s ease-out;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid var(--cor-primaria);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }

        /* Alert */
        .alert {
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            border-left: 5px solid;
            animation: slideInLeft 0.5s ease-out;
        }

        .alert-success {
            background: rgba(143, 214, 148, 0.1);
            border-color: var(--cor-secundaria);
            color: var(--cor-acento);
        }

        .alert-danger {
            background: #f8d7da;
            border-color: #dc3545;
            color: #721c24;
        }

        .alert-warning {
            background: #fff3cd;
            border-color: #ffc107;
            color: #856404;
        }

        .alert-info {
            background: rgba(111, 143, 114, 0.1);
            border-color: var(--cor-neutra);
            color: var(--cor-escura);
        }

        /* Compet√™ncias */
        .competencia-card {
            background: #f8faf9;
            border: 1px solid #e0e0e0;
            border-radius: 15px;
            margin: 20px 0;
            overflow: hidden;
            transition: all 0.3s ease;
            animation: slideInUp 0.6s ease-out;
        }

        .competencia-header {
            background: linear-gradient(135deg, var(--cor-primaria) 0%, var(--cor-acento) 100%);
            color: white;
            padding: 20px;
            font-size: 1.2em;
            font-weight: bold;
        }

        .fator-item {
            padding: 20px;
            border-bottom: 1px solid #eee;
        }

        .fator-texto {
            margin-bottom: 15px;
            font-weight: 500;
            color: var(--cor-escura);
        }

        .rating-container {
            display: flex;
            align-items: center;
            gap: 15px;
            flex-wrap: wrap;
        }

        .rating-label {
            font-size: 12px;
            color: var(--cor-neutra);
            font-weight: 600;
        }

        .rating-option {
            display: flex;
            flex-direction: column;
            align-items: center;
            cursor: pointer;
            padding: 10px;
            border-radius: 8px;
            transition: all 0.3s ease;
        }

        .rating-option:hover {
            background: rgba(125, 186, 132, 0.1);
            transform: scale(1.05);
        }

        .rating-option input[type="radio"] {
            margin-bottom: 5px;
            transform: scale(1.2);
            accent-color: var(--cor-primaria);
        }

        /* Progress */
        .progress-container {
            background: var(--cor-branca);
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin: 20px 0;
        }

        .progress-bar {
            width: 100%;
            height: 25px;
            background: #e0e0e0;
            border-radius: 15px;
            overflow: hidden;
            margin: 10px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(135deg, var(--cor-secundaria) 0%, var(--cor-primaria) 100%);
            width: 0%;
            transition: width 0.8s ease;
            border-radius: 15px;
        }

        /* Resultado */
        .resultado-card {
            background: linear-gradient(135deg, #f8faf9 0%, #e9f5ea 100%);
            border: 2px solid var(--cor-secundaria);
            border-radius: 15px;
            padding: 30px;
            text-align: center;
            margin: 30px 0;
            display: none;
        }

        .resultado-card.show {
            display: block;
            animation: slideInUp 0.8s ease-out;
        }

        .pontuacao-display {
            font-size: 3em;
            font-weight: bold;
            margin: 20px 0;
            color: var(--cor-primaria);
        }

        .classificacao-display {
            font-size: 1.5em;
            font-weight: bold;
            padding: 15px 30px;
            border-radius: 50px;
            margin: 20px 0;
            display: inline-block;
            background: var(--cor-primaria);
            color: white;
        }

        /* Info Cards */
        .info-card {
            background: var(--cor-branca);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            margin: 20px 0;
            animation: slideInUp 0.6s ease-out;
        }

        /* Tabela Hist√≥rico */
        .tabela-historico {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .tabela-historico th {
            background: var(--cor-primaria);
            color: white;
            padding: 15px;
            font-weight: 600;
            text-align: center;
        }

        .tabela-historico td {
            padding: 15px;
            border-bottom: 1px solid #eee;
            text-align: center;
        }

        .tabela-historico tr:nth-child(even) {
            background: rgba(248, 250, 249, 0.5);
        }

        .tabela-historico tr:hover {
            background: rgba(143, 214, 148, 0.1);
            transform: scale(1.01);
            transition: all 0.3s ease;
        }

        .status-conexao {
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
            text-align: center;
            font-weight: bold;
        }

        .status-conectado {
            background: rgba(143, 214, 148, 0.1);
            border: 2px solid var(--cor-secundaria);
            color: var(--cor-primaria);
        }

        .status-desconectado {
            background: rgba(220, 53, 69, 0.1);
            border: 2px solid #dc3545;
            color: #721c24;
        }
    </style>
</head>
<body>
    <!-- Header Principal -->
    <header class="main-header">
        <div class="container">
            <h1>üéØ SISTEMA DE AVALIA√á√ÉO DE DESEMPENHO</h1>
            <p>Busca Autom√°tica no Google Sheets - Dados Sempre Atualizados</p>
        </div>

        <!-- Cr√©ditos do Desenvolvedor -->
        <footer style="background: var(--cor-primaria); color: white; text-align: center; padding: 15px; margin-top: 50px;">
            <div class="container">
                <p style="margin: 2px 0; font-size: 11px; opacity: 0.7;">
                    Desenvolvido por Juliano Patrick | julianocorrea@bateforte.com.br | Sistema v3.0 - Busca Autom√°tica ¬© 2025
                </p>
            </div>
        </footer>
    </header>

    <div class="container">
        <!-- Menu de Navega√ß√£o -->
        <nav class="nav-menu">
            <button class="nav-btn active" onclick="showSection('home')">üè† Home</button>
            <button class="nav-btn" onclick="showSection('avaliacao')">üìù Nova Avalia√ß√£o</button>
            <button class="nav-btn" id="btnHistorico" onclick="verificarAcessoHistorico()">üìã Hist√≥rico</button>
            <button class="nav-btn" id="btnConfiguracoes" onclick="verificarAcessoConfiguracoes()">‚öôÔ∏è Configura√ß√µes</button>
        </nav>

        <!-- Se√ß√£o Home -->
        <section id="home" class="section active">
            <h2>üè† Sistema com Busca Autom√°tica</h2>
            
            <div id="statusConexaoHome" class="status-conexao">
                <span id="textoStatus">üîÑ Verificando conex√£o...</span>
            </div>
            
            <div class="alert alert-info">
                <h4>üîó Sistema Conectado ao Google Sheets</h4>
                <p><strong>Busca autom√°tica de dados sempre atualizados!</strong></p>
                <ul style="margin: 10px 0; padding-left: 30px;">
                    <li>‚úÖ Colaboradores buscados automaticamente das planilhas</li>
                    <li>‚úÖ Gestores sincronizados em tempo real</li>
                    <li>‚úÖ Avalia√ß√µes salvas na nuvem instantaneamente</li>
                    <li>‚úÖ Hist√≥rico centralizado com filtros por filial</li>
                    <li>üîê Controle de acesso por filial mantido</li>
                    <li>üõ°Ô∏è Dados sempre atualizados das planilhas</li>
                </ul>
            </div>
            
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-number" id="totalAvaliacoesHome">0</div>
                    <div class="stat-label">Avalia√ß√µes Realizadas</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="mediaGeralHome">0.00</div>
                    <div class="stat-label">M√©dia Geral</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="totalColaboradoresHome">0</div>
                    <div class="stat-label">Colaboradores Cadastrados</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="totalGestoresHome">0</div>
                    <div class="stat-label">Gestores Cadastrados</div>
                </div>
            </div>

            <div class="info-card">
                <h3>üîê Controle de Acesso por Filial</h3>
                <p><strong>Sistema de Seguran√ßa Mantido:</strong></p>
                <ul style="margin: 15px 0; padding-left: 30px;">
                    <li>üìã <strong>Hist√≥rico:</strong> Acesso restrito por filial com senha espec√≠fica</li>
                    <li>‚öôÔ∏è <strong>Configura√ß√µes:</strong> Acesso exclusivo para administradores (GGMASTERJP)</li>
                    <li>üîë <strong>Senhas Master:</strong> GGMASTER e GGMASTERJP para acesso total</li>
                    <li>üõ°Ô∏è <strong>Filtros Autom√°ticos:</strong> Dados filtrados conforme n√≠vel de acesso</li>
                    <li>üîÑ <strong>Busca Autom√°tica:</strong> Dados sempre atualizados das planilhas</li>
                </ul>

                <h4 style="margin-top: 20px;">üéØ Compet√™ncias Avaliadas:</h4>
                <ul style="margin: 15px 0; padding-left: 30px;">
                    <li><strong>Comunica√ß√£o e Influ√™ncia</strong> - 5 fatores</li>
                    <li><strong>Disciplina de Execu√ß√£o</strong> - 5 fatores</li>
                    <li><strong>Foco em Resultados</strong> - 5 fatores</li>
                    <li><strong>Foco no Cliente/Tutor</strong> - 5 fatores</li>
                    <li><strong>Lideran√ßa e Gest√£o de Pessoas</strong> - 6 fatores</li>
                    <li><strong>Postura de Dono</strong> - 5 fatores</li>
                </ul>
            </div>
        </section>

        <!-- Se√ß√£o Nova Avalia√ß√£o -->
        <section id="avaliacao" class="section">
            <h2>üìù Nova Avalia√ß√£o</h2>

            <!-- Status de Carregamento dos Dados -->
            <div id="statusDados" class="alert alert-info">
                <p>üîÑ <strong>Carregando dados das planilhas...</strong></p>
            </div>

            <!-- Dados Pessoais -->
            <div class="info-card">
                <h3>üë§ Dados Pessoais</h3>
                <div class="form-row">
                    <div class="form-group">
                        <label for="matriculaAvaliado">Matr√≠cula do Avaliado *</label>
                        <input type="text" id="matriculaAvaliado" required placeholder="Digite a matr√≠cula..." 
                               onchange="buscarColaborador(this.value)">
                    </div>
                    <div class="form-group">
                        <label for="nomeAvaliado">Nome do Avaliado</label>
                        <input type="text" id="nomeAvaliado" readonly style="background: #f0f0f0;">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="funcaoAvaliado">Fun√ß√£o do Avaliado</label>
                        <input type="text" id="funcaoAvaliado" readonly style="background: #f0f0f0;">
                    </div>
                    <div class="form-group">
                        <label for="filial">Filial</label>
                        <input type="text" id="filial" readonly style="background: #f0f0f0;">
                    </div>
                </div>
                
                <hr style="margin: 30px 0; border: 1px solid #e0e0e0;">
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="matriculaGestor">Matr√≠cula do Gestor *</label>
                        <input type="text" id="matriculaGestor" required placeholder="Digite a matr√≠cula do gestor..." 
                               onchange="buscarGestor(this.value)">
                    </div>
                    <div class="form-group">
                        <label for="nomeGestor">Nome do Gestor</label>
                        <input type="text" id="nomeGestor" readonly style="background: #f0f0f0;">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="funcaoGestor">Fun√ß√£o do Gestor</label>
                        <input type="text" id="funcaoGestor" readonly style="background: #f0f0f0;">
                    </div>
                    <div class="form-group">
                        <label for="regionalGestor">Regional</label>
                        <input type="text" id="regionalGestor" readonly style="background: #f0f0f0;">
                    </div>
                </div>
            </div>

            <!-- Progresso -->
            <div class="progress-container">
                <h3>üìä Progresso da Avalia√ß√£o</h3>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
                <div class="progress-text" id="progressText">0 de 31 fatores avaliados</div>
            </div>

            <!-- Compet√™ncias -->
            <div id="competenciasContainer">
                <!-- Ser√° preenchido dinamicamente -->
            </div>

            <!-- Feedback -->
            <div class="info-card">
                <h3>üí¨ Feedback e Coment√°rios</h3>
                <div class="form-group">
                    <label for="pontosFortes">Pontos Fortes</label>
                    <textarea id="pontosFortes" rows="4" placeholder="Principais pontos fortes identificados..."></textarea>
                </div>
                <div class="form-group">
                    <label for="oportunidades">Oportunidades de Desenvolvimento</label>
                    <textarea id="oportunidades" rows="4" placeholder="√Åreas que precisam de desenvolvimento..."></textarea>
                </div>
                <div class="form-group">
                    <label for="comentarios">Coment√°rios Gerais</label>
                    <textarea id="comentarios" rows="4" placeholder="Coment√°rios adicionais sobre a avalia√ß√£o..."></textarea>
                </div>
            </div>

            <!-- Resultado -->
            <div id="resultadoCard" class="resultado-card">
                <h3>üìä Resultado da Avalia√ß√£o</h3>
                <div class="pontuacao-display" id="pontuacaoDisplay">0.00/5.00</div>
                <div class="classificacao-display" id="classificacaoDisplay">-</div>
                <div id="laudoResumo" style="margin-top: 20px; font-size: 1.1em; line-height: 1.6;"></div>
            </div>

            <!-- A√ß√µes -->
            <div style="text-align: center; margin: 30px 0;">
                <button class="btn btn-info" onclick="calcularResultado()">üìä Calcular Resultado</button>
                <button class="btn btn-success" onclick="salvarAvaliacao()" id="btnSalvar" disabled>‚òÅÔ∏è Salvar no Google Sheets</button>
                <button class="btn" onclick="limparFormulario()">üóëÔ∏è Limpar Formul√°rio</button>
            </div>

            <div class="loading" id="loading">
                <div class="spinner"></div>
                <p>Salvando no Google Sheets...</p>
            </div>
        </section>

        <!-- Se√ß√£o de Login para Hist√≥rico -->
        <section id="loginHistorico" class="section">
            <h2>üîê Acesso ao Hist√≥rico por Filial</h2>
            
            <div class="login-card">
                <h3 class="login-title">üîí Digite a Senha da sua Filial</h3>
                
                <div class="form-group">
                    <input type="password" id="senhaHistorico" class="login-input" placeholder="Digite a senha da sua filial..." onkeypress="verificarEnterHistorico(event)">
                </div>
                
                <button class="btn btn-success" onclick="validarSenhaHistorico()">üîì Acessar Hist√≥rico</button>
                <button class="btn" onclick="showSection('home')">‚ùå Cancelar</button>
                
                <div class="access-info">
                    <h4>‚ÑπÔ∏è Sistema de Controle por Filial</h4>
                    <p><strong>Acesso Seguro e Personalizado:</strong></p>
                    <ul style="text-align: left; margin: 15px 0;">
                        <li>üîë Cada filial possui senha espec√≠fica (GGxxxxx)</li>
                        <li>üîç Hist√≥rico filtrado automaticamente por filial</li>
                        <li>üîí GGMASTER: Acesso a todas as filiais</li>
                        <li>üõ°Ô∏è GGMASTERJP: Acesso administrativo completo</li>
                        <li>üìû Entre em contato para obter sua senha</li>
                    </ul>
                    
                    <div style="background: rgba(30, 68, 30, 0.1); padding: 15px; border-radius: 10px; margin-top: 15px;">
                        <p style="margin: 0; font-size: 0.9em; color: var(--cor-primaria); font-weight: 600;">
                            üè¢ <strong>Filiais Cadastradas:</strong><br>
                            743-MS | 264-SC | 753-MT | 364-DF | 713-SP<br>
                            468-MT | 892-SP | 723-SP | 230-SP | 773-RS<br>
                            473-MT | 167-MS | 20-AGP
                        </p>
                    </div>
                    
                    <div class="access-levels">
                        <span class="access-level level-master">MASTER</span>
                        <span class="access-level level-filial">FILIAL</span>
                    </div>
                </div>
            </div>
        </section>

        <!-- Se√ß√£o de Login para Configura√ß√µes -->
        <section id="loginConfiguracoes" class="section">
            <h2>‚öôÔ∏è Acesso √†s Configura√ß√µes</h2>
            
            <div class="login-card">
                <h3 class="login-title">üîí √Årea Restrita - Administra√ß√£o</h3>
                
                <div class="form-group">
                    <input type="password" id="senhaConfiguracoes" class="login-input" placeholder="Digite a senha de administrador..." onkeypress="verificarEnterConfig(event)">
                </div>
                
                <button class="btn btn-success" onclick="validarSenhaConfiguracoes()">üîì Acessar Configura√ß√µes</button>
                <button class="btn" onclick="showSection('home')">‚ùå Cancelar</button>
                
                <div class="access-info">
                    <h4>‚ÑπÔ∏è √Årea Administrativa Restrita</h4>
                    <p><strong>Acesso Exclusivo para Administradores:</strong></p>
                    <ul style="text-align: left; margin: 15px 0;">
                        <li>üîí Apenas administradores autorizados</li>
                        <li>‚öôÔ∏è Configura√ß√£o da URL da Web App</li>
                        <li>üîß Testes de conex√£o com Google Sheets</li>
                        <li>üìä Visualiza√ß√£o de estat√≠sticas completas</li>
                        <li>üõ†Ô∏è Ferramentas de diagn√≥stico e manuten√ß√£o</li>
                    </ul>
                    
                    <div style="background: rgba(220, 53, 69, 0.1); padding: 15px; border-radius: 10px; margin-top: 15px; border-left: 4px solid #dc3545;">
                        <p style="margin: 0; font-size: 0.9em; color: #721c24; font-weight: 600;">
                            üîê <strong>Senha Necess√°ria:</strong> GGMASTERJP<br>
                            ‚ö†Ô∏è <strong>Acesso Restrito:</strong> Somente desenvolvedores autorizados
                        </p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Se√ß√£o Hist√≥rico -->
        <section id="historico" class="section">
            <div id="accessStatus" class="access-status" style="display: none;">
                <!-- Status ser√° preenchido dinamicamente -->
            </div>

            <h2>üìã Hist√≥rico de Avalia√ß√µes</h2>

            <div class="alert alert-success">
                <p>üîó <strong>Dados sincronizados com Google Sheets</strong> - Hist√≥rico filtrado conforme seu n√≠vel de acesso.</p>
            </div>

            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-number" id="totalAvaliacoes">0</div>
                    <div class="stat-label">Total de Avalia√ß√µes</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="mediaGeral">0.00</div>
                    <div class="stat-label">M√©dia Geral</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="excelentes">0</div>
                    <div class="stat-label">Excelentes</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="precisamMelhorar">0</div>
                    <div class="stat-label">Precisam Melhorar</div>
                </div>
            </div>

            <div style="text-align: center; margin: 30px 0;">
                <button class="btn btn-info" onclick="carregarHistorico()">üîÑ Sincronizar com Google Sheets</button>
                <button class="btn btn-warning" onclick="exportarDados()">üì• Exportar Dados</button>
                <button class="btn btn-danger" onclick="logout()">üö™ Sair do Hist√≥rico</button>
            </div>

            <div id="tabelaHistorico">
                <p style="text-align: center; padding: 30px; color: #666;">
                    üìä Carregando dados do Google Sheets...
                </p>
            </div>
        </section>

        <!-- Se√ß√£o Configura√ß√µes -->
        <section id="configuracoes" class="section">
            <div id="configStatus" class="access-status" style="display: none;">
                <!-- Status ser√° preenchido dinamicamente -->
            </div>

            <h2>‚öôÔ∏è Configura√ß√µes do Sistema</h2>

            <!-- Configura√ß√£o da URL -->
            <div class="info-card">
                <h3>üîó Configura√ß√£o da Web App</h3>
                <div class="alert alert-warning">
                    <p><strong>URL Atual:</strong> <span id="webappUrl">N√£o configurada</span></p>
                </div>
                <div style="text-align: center; margin: 20px 0;">
                    <button class="btn btn-info" onclick="configurarWebApp()">üîó Configurar URL da Web App</button>
                    <button class="btn btn-success" onclick="testarConexaoSheets()">üß™ Testar Conex√£o</button>
                </div>
            </div>

            <!-- Status dos Dados -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-number" id="totalColaboradoresConfig">0</div>
                    <div class="stat-label">Colaboradores na Base</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="totalGestoresConfig">0</div>
                    <div class="stat-label">Gestores na Base</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="totalAvaliacoesConfig">0</div>
                    <div class="stat-label">Avalia√ß√µes na Base</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="statusSincronizacao">--</div>
                    <div class="stat-label">Status da Conex√£o</div>
                </div>
            </div>

            <!-- Ferramentas de Administra√ß√£o -->
            <div class="info-card">
                <h3>üõ†Ô∏è Ferramentas de Administra√ß√£o</h3>
                <p>Mantenha o sistema sempre atualizado e funcionando perfeitamente.</p>
                
                <div style="text-align: center; margin: 20px 0;">
                    <button class="btn btn-info" onclick="sincronizarDados()">üîÑ Sincronizar Todos os Dados</button>
                    <button class="btn btn-warning" onclick="verificarIntegridadeDados()">üîç Verificar Integridade</button>
                    <button class="btn btn-success" onclick="gerarRelatorioCompleto()">üìä Relat√≥rio Completo</button>
                    <button class="btn btn-danger" onclick="logout()">üö™ Sair das Configura√ß√µes</button>
                </div>
            </div>

            <!-- Instru√ß√µes -->
            <div class="info-card">
                <h3>üìã Como Atualizar os Dados</h3>
                <div class="alert alert-info">
                    <p><strong>Para atualizar colaboradores e gestores:</strong></p>
                    <ol style="margin: 15px 0; padding-left: 30px; text-align: left;">
                        <li>Acesse as planilhas do Google Sheets diretamente</li>
                        <li>Edite os dados na planilha de Colaboradores</li>
                        <li>Edite os dados na planilha de Gestores</li>
                        <li>O sistema buscar√° automaticamente os dados atualizados</li>
                        <li>Use o bot√£o "Sincronizar" para for√ßar atualiza√ß√£o</li>
                    </ol>
                    <p style="margin-top: 15px;"><strong>üí° Dica:</strong> As mudan√ßas nas planilhas s√£o refletidas automaticamente no sistema!</p>
                </div>
            </div>
        </section>
    </div>

    <script>
        // =====================================================
        // CONFIGURA√á√ÉO DA INTEGRA√á√ÉO GOOGLE SHEETS
        // =====================================================

        // URL da Web App do Google Apps Script
        let WEBAPP_URL = 'https://script.google.com/a/macros/bateforte.com.br/s/AKfycbzmJW51Luw_JslQTuwrrFqpUdbFjITnyrKLstRZXqb7reEdmQ6Of1Lvm_A3NoWSgDN5/exec';

        // Sistema de controle de acesso
        let acessoAtual = {
            tipo: null,           
            senha: null,          
            filial: null,         
            permissoes: []        
        };

        // Mapeamento de senhas por filial
        const SENHAS_FILIAIS = {
            'GG74301': { filial: '743', regional: 'MS' },
            'GG26402': { filial: '264', regional: 'SC' },
            'GG75303': { filial: '753', regional: 'MT' },
            'GG36404': { filial: '364', regional: 'DF' },
            'GG71305': { filial: '713', regional: 'SP' },
            'GG46806': { filial: '468', regional: 'MT' },
            'GG89207': { filial: '892', regional: 'SP' },
            'GG72308': { filial: '723', regional: 'SP' },
            'GG23009': { filial: '230', regional: 'SP' },
            'GG77310': { filial: '773', regional: 'RS' },
            'GG47311': { filial: '473', regional: 'MT' },
            'GG16712': { filial: '167', regional: 'MS' },
            'GG02013': { filial: '20', regional: 'AGP' }
        };

        // Senhas especiais
        const SENHAS_ESPECIAIS = {
            'GGMASTER': { tipo: 'master', descricao: 'Acesso a todas as filiais' },
            'GGMASTERJP': { tipo: 'admin', descricao: 'Acesso administrativo completo' }
        };

        // Vari√°veis globais para dados
        let avaliacoes = [];
        let colaboradores = {};
        let gestores = {};
        let avaliacaoAtual = null;
        let dadosCarregados = false;

        // Cache com timestamp para controle de atualiza√ß√£o
        let cacheLocal = {
            avaliacoes: [],
            colaboradores: {},
            gestores: {},
            ultimaAtualizacao: null,
            tempoCache: 5 * 60 * 1000 // 5 minutos
        };

        // Compet√™ncias do sistema
        const COMPETENCIAS = [
            {
                nome: 'COMUNICA√á√ÉO E INFLU√äNCIA',
                fatores: [
                    'Tem clareza, √© emp√°tico(a) e inclusivo(a) na sua comunica√ß√£o.',
                    'Possui habilidades em comunicar temas cr√≠ticos, transmitindo confian√ßa ao time.',
                    '√â influenciador(a) e inspira seu time e a rede de relacionamento pelo exemplo.',
                    'Respeita as opini√µes divergentes, escuta de maneira aberta.',
                    'Cria um ambiente de seguran√ßa e confian√ßa m√∫tua.'
                ]
            },
            {
                nome: 'DISCIPLINA DE EXECU√á√ÉO',
                fatores: [
                    'Garante planejamento e execu√ß√£o com efici√™ncia dentro dos prazos.',
                    'Constr√≥i regras e processos e busca eliminar burocracias desnecess√°rias.',
                    'Assume responsabilidade, cumpre normas e procedimentos.',
                    'Estimula o time para que esteja comprometido com prazos e entregas.',
                    'Garante n√≠veis excelentes de qualidade nas entregas.'
                ]
            },
            {
                nome: 'FOCO EM RESULTADOS',
                fatores: [
                    'Possui consist√™ncia nas entregas.',
                    'Tem flexibilidade para liderar diferentes frentes.',
                    'Elabora e cumpre planos de a√ß√µes para o atingimento das metas.',
                    'Conhece o neg√≥cio e acompanha resultados atrav√©s de dados.',
                    'Estimula o time para possu√≠rem vis√£o cr√≠tica e trazerem solu√ß√µes.'
                ]
            },
            {
                nome: 'FOCO NO CLIENTE/TUTOR',
                fatores: [
                    'Entende, prioriza e antecipa as necessidades dos clientes.',
                    'Constr√≥i alian√ßas com clientes, pares, √°reas parceiras.',
                    'Implementa novas solu√ß√µes para atingir expectativas do cliente.',
                    'Direciona o time para conhecer as necessidades dos clientes.',
                    'Desenvolve a√ß√µes efetivas e de sucesso para os clientes.'
                ]
            },
            {
                nome: 'LIDERAN√áA E GEST√ÉO DE PESSOAS',
                fatores: [
                    'Age com clareza na distribui√ß√£o dos pap√©is e responsabilidades.',
                    'Sabe identificar desafios compat√≠veis com a capacidade de cada um.',
                    'Estimula e conduz o time para que alcance/supere as metas.',
                    'Direciona o time com clareza para as atividades.',
                    'Orienta, d√° feedbacks efetivos e acompanha evolu√ß√µes.',
                    'Possui preocupa√ß√£o genu√≠na com as pessoas e desenvolve liderados.'
                ]
            },
            {
                nome: 'POSTURA DE DONO',
                fatores: [
                    'Possui senso de urg√™ncia e sabe direcionar o time.',
                    'Assume responsabilidade e n√£o terceiriza para outras √°reas.',
                    '√â exemplo e estimula o time a ser inconformado com entregas.',
                    '√â atento √†s tend√™ncias de mercado e busca aplic√°-las.',
                    '√â atento e gerencia os desperd√≠cios e custos.'
                ]
            }
        ];

        // =====================================================
        // FUN√á√ïES DE COMUNICA√á√ÉO COM GOOGLE SHEETS
        // =====================================================

        async function buscarDoGoogleSheets(acao) {
            if (!WEBAPP_URL || WEBAPP_URL.includes('SEU_ID')) {
                console.warn('‚ö†Ô∏è URL n√£o configurada');
                throw new Error('URL da Web App n√£o configurada');
            }

            try {
                console.log(`üì° Buscando ${acao} do Google Sheets...`);
                
                const response = await fetch(`${WEBAPP_URL}?acao=${acao}`, { 
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const resultado = await response.json();
                
                if (resultado && resultado.sucesso) {
                    console.log(`‚úÖ ${acao} carregado com sucesso (${Array.isArray(resultado.dados) ? resultado.dados.length : Object.keys(resultado.dados || {}).length} itens)`);
                    return resultado;
                } else {
                    throw new Error(resultado?.mensagem || 'Resposta inv√°lida do servidor');
                }

            } catch (error) {
                console.error(`‚ùå Erro ao buscar ${acao}:`, error);
                throw error;
            }
        }

        async function enviarParaGoogleSheets(acao, dados = {}) {
            if (!WEBAPP_URL || WEBAPP_URL.includes('SEU_ID')) {
                throw new Error('URL da Web App n√£o configurada');
            }

            try {
                console.log('üì§ Enviando para Google Sheets:', acao);
                
                const payload = { acao: acao, ...dados };
                
                const response = await fetch(WEBAPP_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const resultado = await response.json();
                
                if (resultado && resultado.sucesso) {
                    console.log('‚úÖ Dados enviados com sucesso');
                    return resultado;
                } else {
                    throw new Error(resultado?.mensagem || 'Erro desconhecido');
                }
                
            } catch (error) {
                console.error('‚ùå Erro na comunica√ß√£o:', error);
                throw error;
            }
        }

        // =====================================================
        // FUN√á√ïES DE CARREGAMENTO DE DADOS
        // =====================================================

        async function carregarDadosSalvos() {
            console.log('üìÇ Carregando dados das planilhas...');
            
            try {
                // Verificar se os dados em cache ainda s√£o v√°lidos
                const agora = new Date().getTime();
                const ultimaAtualizacao = cacheLocal.ultimaAtualizacao;
                
                if (ultimaAtualizacao && (agora - ultimaAtualizacao) < cacheLocal.tempoCache && dadosCarregados) {
                    console.log('üíæ Usando dados do cache (ainda v√°lidos)');
                    atualizarStatusDados('üìã Dados em cache atualizados', 'success');
                    return;
                }
                
                atualizarStatusDados('üîÑ Buscando dados das planilhas...', 'info');
                
                // Buscar dados em paralelo
                const [resAvaliacoes, resColaboradores, resGestores] = await Promise.all([
                    buscarDoGoogleSheets('buscar_avaliacoes'),
                    buscarDoGoogleSheets('buscar_colaboradores'),
                    buscarDoGoogleSheets('buscar_gestores')
                ]);
                
                // Processar resultados
                if (resAvaliacoes.sucesso) {
                    avaliacoes = resAvaliacoes.dados || [];
                    cacheLocal.avaliacoes = avaliacoes;
                }
                
                if (resColaboradores.sucesso) {
                    colaboradores = resColaboradores.dados || {};
                    cacheLocal.colaboradores = colaboradores;
                }
                
                if (resGestores.sucesso) {
                    gestores = resGestores.dados || {};
                    cacheLocal.gestores = gestores;
                }
                
                cacheLocal.ultimaAtualizacao = agora;
                dadosCarregados = true;
                
                // Salvar no localStorage como backup
                localStorage.setItem('gg_cache', JSON.stringify(cacheLocal));
                
                console.log('‚úÖ Dados carregados:', {
                    avaliacoes: avaliacoes.length,
                    colaboradores: Object.keys(colaboradores).length,
                    gestores: Object.keys(gestores).length
                });
                
                atualizarStatusDados(`‚úÖ Dados carregados: ${Object.keys(colaboradores).length} colaboradores, ${Object.keys(gestores).length} gestores`, 'success');
                atualizarStatusConexaoHome(true);
                
            } catch (error) {
                console.error('‚ùå Erro ao carregar dados:', error);
                
                // Tentar usar cache do localStorage como fallback
                try {
                    const cacheStorage = localStorage.getItem('gg_cache');
                    if (cacheStorage) {
                        const dadosCache = JSON.parse(cacheStorage);
                        cacheLocal = dadosCache;
                        avaliacoes = dadosCache.avaliacoes || [];
                        colaboradores = dadosCache.colaboradores || {};
                        gestores = dadosCache.gestores || {};
                        dadosCarregados = true;
                        
                        atualizarStatusDados('‚ö†Ô∏è Usando dados em cache (offline)', 'warning');
                        atualizarStatusConexaoHome(false);
                    } else {
                        throw new Error('Nenhum cache dispon√≠vel');
                    }
                } catch (cacheError) {
                    console.error('‚ùå Erro no cache tamb√©m:', cacheError);
                    atualizarStatusDados('‚ùå Erro ao carregar dados. Verifique a conex√£o.', 'danger');
                    atualizarStatusConexaoHome(false);
                }
            }
        }

        function atualizarStatusDados(mensagem, tipo) {
            const statusEl = document.getElementById('statusDados');
            if (statusEl) {
                statusEl.className = `alert alert-${tipo}`;
                statusEl.innerHTML = `<p><strong>${mensagem}</strong></p>`;
            }
        }

        function atualizarStatusConexaoHome(conectado) {
            const statusEl = document.getElementById('statusConexaoHome');
            const textoEl = document.getElementById('textoStatus');
            
            if (statusEl && textoEl) {
                if (conectado) {
                    statusEl.className = 'status-conexao status-conectado';
                    textoEl.textContent = 'üü¢ Conectado ao Google Sheets - Dados Atualizados';
                } else {
                    statusEl.className = 'status-conexao status-desconectado';
                    textoEl.textContent = 'üî¥ Sem conex√£o - Usando dados em cache';
                }
            }
        }

        // =====================================================
        // FUN√á√ïES DE BUSCA DE COLABORADORES E GESTORES
        // =====================================================

        function buscarColaborador(matricula) {
            if (!matricula || matricula.trim() === '') {
                limparCamposColaborador();
                return;
            }
            
            const colaborador = colaboradores[matricula.trim()];
            
            if (colaborador) {
                document.getElementById('nomeAvaliado').value = colaborador.nome || '';
                document.getElementById('funcaoAvaliado').value = colaborador.funcao || '';
                document.getElementById('filial').value = colaborador.filial || '';
                
                // Feedback visual
                const campo = document.getElementById('matriculaAvaliado');
                campo.style.borderColor = 'var(--cor-secundaria)';
                campo.style.backgroundColor = 'rgba(143, 214, 148, 0.1)';
                
                mostrarAlerta(`‚úÖ Colaborador encontrado: ${colaborador.nome}`, 'success');
            } else {
                limparCamposColaborador();
                
                const campo = document.getElementById('matriculaAvaliado');
                campo.style.borderColor = '#dc3545';
                campo.style.backgroundColor = 'rgba(220, 53, 69, 0.1)';
                
                mostrarAlerta(`‚ùå Colaborador n√£o encontrado para a matr√≠cula: ${matricula}`, 'warning');
            }
        }

        function buscarGestor(matricula) {
            if (!matricula || matricula.trim() === '') {
                limparCamposGestor();
                return;
            }
            
            const gestor = gestores[matricula.trim()];
            
            if (gestor) {
                document.getElementById('nomeGestor').value = gestor.nome || '';
                document.getElementById('funcaoGestor').value = gestor.funcao || '';
                document.getElementById('regionalGestor').value = gestor.regional || '';
                
                // Feedback visual
                const campo = document.getElementById('matriculaGestor');
                campo.style.borderColor = 'var(--cor-secundaria)';
                campo.style.backgroundColor = 'rgba(143, 214, 148, 0.1)';
                
                mostrarAlerta(`‚úÖ Gestor encontrado: ${gestor.nome}`, 'success');
            } else {
                limparCamposGestor();
                
                const campo = document.getElementById('matriculaGestor');
                campo.style.borderColor = '#dc3545';
                campo.style.backgroundColor = 'rgba(220, 53, 69, 0.1)';
                
                mostrarAlerta(`‚ùå Gestor n√£o encontrado para a matr√≠cula: ${matricula}`, 'warning');
            }
        }

        function limparCamposColaborador() {
            document.getElementById('nomeAvaliado').value = '';
            document.getElementById('funcaoAvaliado').value = '';
            document.getElementById('filial').value = '';
            
            const campo = document.getElementById('matriculaAvaliado');
            campo.style.borderColor = '#e0e0e0';
            campo.style.backgroundColor = '';
        }

        function limparCamposGestor() {
            document.getElementById('nomeGestor').value = '';
            document.getElementById('funcaoGestor').value = '';
            document.getElementById('regionalGestor').value = '';
            
            const campo = document.getElementById('matriculaGestor');
            campo.style.borderColor = '#e0e0e0';
            campo.style.backgroundColor = '';
        }

        // =====================================================
        // FUN√á√ïES DE AUTENTICA√á√ÉO E CONTROLE DE ACESSO
        // =====================================================

        function verificarAcessoHistorico() {
            acessoAtual = { tipo: null, senha: null, filial: null, permissoes: [] };
            showSection('loginHistorico');
        }

        function verificarAcessoConfiguracoes() {
            acessoAtual = { tipo: null, senha: null, filial: null, permissoes: [] };
            showSection('loginConfiguracoes');
        }

        function validarSenhaHistorico() {
            const senha = document.getElementById('senhaHistorico').value.trim().toUpperCase();
            
            if (!senha) {
                mostrarAlerta('‚ùå Digite uma senha!', 'danger');
                return;
            }

            // Verificar senhas especiais
            if (SENHAS_ESPECIAIS[senha]) {
                const tipoAcesso = SENHAS_ESPECIAIS[senha].tipo;
                
                acessoAtual = {
                    tipo: tipoAcesso,
                    senha: senha,
                    filial: tipoAcesso === 'master' ? 'TODAS' : null,
                    permissoes: tipoAcesso === 'admin' ? ['historico', 'configuracoes'] : ['historico']
                };

                exibirStatusAcesso('historico');
                showSection('historico');
                carregarHistorico();
                mostrarAlerta(`‚úÖ Acesso liberado: ${SENHAS_ESPECIAIS[senha].descricao}`, 'success');
                return;
            }

            // Verificar senhas de filiais
            if (SENHAS_FILIAIS[senha]) {
                const dadosFilial = SENHAS_FILIAIS[senha];
                
                acessoAtual = {
                    tipo: 'filial',
                    senha: senha,
                    filial: dadosFilial.filial,
                    regional: dadosFilial.regional,
                    permissoes: ['historico']
                };

                exibirStatusAcesso('historico');
                showSection('historico');
                carregarHistorico();
                mostrarAlerta(`‚úÖ Acesso liberado para Filial ${dadosFilial.filial} - ${dadosFilial.regional}`, 'success');
                return;
            }

            mostrarAlerta('‚ùå Senha inv√°lida! Verifique a senha da sua filial.', 'danger');
        }

        function validarSenhaConfiguracoes() {
            const senha = document.getElementById('senhaConfiguracoes').value.trim().toUpperCase();
            
            if (senha !== 'GGMASTERJP') {
                mostrarAlerta('‚ùå Senha incorreta! Acesso restrito a administradores.', 'danger');
                return;
            }

            acessoAtual = {
                tipo: 'admin',
                senha: senha,
                filial: null,
                permissoes: ['historico', 'configuracoes']
            };

            exibirStatusAcesso('configuracoes');
            showSection('configuracoes');
            atualizarEstatisticasConfig();
            mostrarAlerta('‚úÖ Acesso administrativo liberado!', 'success');
        }

        function exibirStatusAcesso(secao) {
            const statusElement = document.getElementById(secao === 'historico' ? 'accessStatus' : 'configStatus');
            
            if (!statusElement) return;

            let statusText = '';

            switch(acessoAtual.tipo) {
                case 'admin':
                    statusText = `üîê ADMINISTRADOR | Acesso Total | Usu√°rio: ${acessoAtual.senha}`;
                    break;
                case 'master':
                    statusText = `üîë MASTER | Todas as Filiais | Usu√°rio: ${acessoAtual.senha}`;
                    break;
                case 'filial':
                    statusText = `üè¢ FILIAL ${acessoAtual.filial} - ${acessoAtual.regional} | Acesso Restrito | Usu√°rio: ${acessoAtual.senha}`;
                    break;
                default:
                    statusText = '‚ùå Acesso n√£o autorizado';
            }

            statusElement.innerHTML = statusText;
            statusElement.style.display = 'block';
        }

        function verificarEnterHistorico(event) {
            if (event.key === 'Enter') {
                validarSenhaHistorico();
            }
        }

        function verificarEnterConfig(event) {
            if (event.key === 'Enter') {
                validarSenhaConfiguracoes();
            }
        }

        function logout() {
            acessoAtual = { tipo: null, senha: null, filial: null, permissoes: [] };
            
            // Limpar campos de senha
            document.getElementById('senhaHistorico').value = '';
            document.getElementById('senhaConfiguracoes').value = '';
            
            // Ocultar status de acesso
            document.getElementById('accessStatus').style.display = 'none';
            document.getElementById('configStatus').style.display = 'none';
            
            showSection('home');
            mostrarAlerta('üö™ Sess√£o encerrada com sucesso!', 'info');
        }

        function filtrarDadosPorAcesso(dados) {
            if (!acessoAtual.tipo || acessoAtual.tipo === 'admin' || acessoAtual.tipo === 'master') {
                return dados; // Admin e Master t√™m acesso total
            }

            if (acessoAtual.tipo === 'filial' && acessoAtual.filial) {
                return dados.filter(item => item.filial === acessoAtual.filial);
            }

            return []; // Sem acesso
        }

        // =====================================================
        // FUN√á√ïES PRINCIPAIS DO SISTEMA
        // =====================================================

        async function salvarAvaliacao() {
            if (!avaliacaoAtual) {
                mostrarAlerta('‚ùå Calcule o resultado primeiro!', 'danger');
                return;
            }

            const nomeAvaliado = document.getElementById('nomeAvaliado').value;
            const nomeGestor = document.getElementById('nomeGestor').value;
            const filial = document.getElementById('filial').value;

            if (!nomeAvaliado || !nomeGestor || !filial) {
                mostrarAlerta('‚ùå Preencha os campos obrigat√≥rios!', 'danger');
                return;
            }

            const avaliacao = {
                id: 'AV' + Date.now(),
                data: new Date(),
                nomeAvaliado: nomeAvaliado,
                matricula: document.getElementById('matriculaAvaliado').value,
                funcaoAvaliado: document.getElementById('funcaoAvaliado').value,
                nomeGestor: nomeGestor,
                matriculaGestor: document.getElementById('matriculaGestor').value,
                funcaoGestor: document.getElementById('funcaoGestor').value,
                filial: filial,
                regional: document.getElementById('regionalGestor').value || 'N/A',
                pontuacao: avaliacaoAtual.pontuacao.toFixed(2),
                classificacao: avaliacaoAtual.classificacao,
                pontosFortes: document.getElementById('pontosFortes').value,
                oportunidades: document.getElementById('oportunidades').value,
                comentarios: document.getElementById('comentarios').value,
                respostas: avaliacaoAtual.respostas || {}
            };

            try {
                mostrarLoading(true);
                const resultado = await enviarParaGoogleSheets('salvar_avaliacao', { avaliacao: avaliacao });
                
                if (resultado.sucesso) {
                    avaliacoes.push(avaliacao);
                    cacheLocal.avaliacoes = avaliacoes;
                    localStorage.setItem('gg_cache', JSON.stringify(cacheLocal));
                    
                    mostrarAlerta('‚úÖ Avalia√ß√£o salva no Google Sheets! ID: ' + avaliacao.id, 'success');
                    
                    document.getElementById('btnSalvar').textContent = '‚úÖ Salvo na Cloud!';
                    setTimeout(() => {
                        document.getElementById('btnSalvar').textContent = '‚òÅÔ∏è Salvar no Google Sheets';
                    }, 3000);
                    
                } else {
                    throw new Error(resultado.mensagem);
                }
                
            } catch (error) {
                console.error('‚ùå Erro ao salvar na cloud:', error);
                mostrarAlerta('‚ùå Erro ao salvar: ' + error.message, 'danger');
            } finally {
                mostrarLoading(false);
            }
        }

        async function carregarHistorico() {
            console.log('üìã Carregando hist√≥rico...');
            
            try {
                mostrarLoading(true);
                
                // Recarregar dados se necess√°rio
                await carregarDadosSalvos();
                
                // Filtrar dados conforme acesso
                const avaliacoesFiltradas = filtrarDadosPorAcesso(avaliacoes);
                
                atualizarEstatisticasHistorico(avaliacoesFiltradas);
                atualizarTabelaHistorico(avaliacoesFiltradas);
                
                const tipoAcesso = acessoAtual.tipo === 'filial' ? `da Filial ${acessoAtual.filial}` : 'completo';
                mostrarAlerta(`‚úÖ Hist√≥rico ${tipoAcesso} sincronizado com Google Sheets!`, 'success');
                
            } catch (error) {
                console.error('‚ùå Erro ao carregar hist√≥rico:', error);
                mostrarAlerta('‚ùå Erro ao carregar hist√≥rico: ' + error.message, 'danger');
            } finally {
                mostrarLoading(false);
            }
        }

        function atualizarEstatisticasHistorico(dadosHistorico = null) {
            const dados = dadosHistorico || filtrarDadosPorAcesso(avaliacoes);
            const total = dados.length;
            let somaNotas = 0;
            let excelentes = 0;
            let precisamMelhorar = 0;

            dados.forEach(av => {
                const nota = parseFloat(av.pontuacao);
                somaNotas += nota;
                
                if (av.classificacao === 'EXCELENTE') excelentes++;
                if (av.classificacao === 'PRECISA MELHORAR') precisamMelhorar++;
            });

            const media = total > 0 ? (somaNotas / total).toFixed(2) : '0.00';

            animarNumero('totalAvaliacoes', total);
            animarNumero('mediaGeral', parseFloat(media));
            animarNumero('excelentes', excelentes);
            animarNumero('precisamMelhorar', precisamMelhorar);
        }

        function atualizarTabelaHistorico(dadosHistorico = null) {
            const container = document.getElementById('tabelaHistorico');
            const dados = dadosHistorico || filtrarDadosPorAcesso(avaliacoes);
            
            if (dados.length === 0) {
                const mensagem = acessoAtual.tipo === 'filial' 
                    ? `üì≠ Nenhuma avalia√ß√£o encontrada para a Filial ${acessoAtual.filial}`
                    : 'üì≠ Nenhuma avalia√ß√£o encontrada';
                container.innerHTML = `<p style="text-align: center; padding: 30px; color: #666;">${mensagem}</p>`;
                return;
            }

            let html = '<table class="tabela-historico">';
            html += '<thead><tr>';
            html += '<th>Data</th>';
            html += '<th>Avaliado</th>';
            html += '<th>Gestor</th>';
            html += '<th>Filial</th>';
            html += '<th>Pontua√ß√£o</th>';
            html += '<th>Classifica√ß√£o</th>';
            html += '</tr></thead>';
            html += '<tbody>';

            dados.forEach(av => {
                const data = new Date(av.data).toLocaleDateString('pt-BR');
                html += '<tr>';
                html += '<td>' + data + '</td>';
                html += '<td>' + av.nomeAvaliado + '</td>';
                html += '<td>' + av.nomeGestor + '</td>';
                html += '<td>' + av.filial + '</td>';
                html += '<td><strong>' + av.pontuacao + '</strong></td>';
                html += '<td>' + av.classificacao + '</td>';
                html += '</tr>';
            });

            html += '</tbody></table>';
            container.innerHTML = html;
        }

        // =====================================================
        // FUN√á√ïES DE INTERFACE
        // =====================================================

        function showSection(sectionId) {
            document.querySelectorAll('.section').forEach(section => {
                section.classList.remove('active');
            });

            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('active');
            });

            document.getElementById(sectionId).classList.add('active');

            // Adicionar classe ativa ao bot√£o correto
            const botoes = document.querySelectorAll('.nav-btn');
            botoes.forEach(btn => {
                if ((sectionId === 'home' && btn.textContent.includes('Home')) ||
                    (sectionId === 'avaliacao' && btn.textContent.includes('Nova')) ||
                    (sectionId === 'historico' && btn.textContent.includes('Hist√≥rico')) ||
                    (sectionId === 'configuracoes' && btn.textContent.includes('Configura√ß√µes'))) {
                    btn.classList.add('active');
                }
            });

            // Atualizar dados espec√≠ficos da se√ß√£o
            switch(sectionId) {
                case 'home':
                    atualizarEstatisticasHome();
                    break;
                case 'avaliacao':
                    inicializarFormularioAvaliacao();
                    break;
                case 'historico':
                    if (acessoAtual.tipo) {
                        carregarHistorico();
                    }
                    break;
                case 'configuracoes':
                    if (acessoAtual.tipo === 'admin') {
                        atualizarEstatisticasConfig();
                    }
                    break;
            }
        }

        function inicializarFormularioAvaliacao() {
            criarFormularioCompetencias();
            atualizarProgresso();
            
            // Verificar se os dados est√£o carregados
            if (!dadosCarregados) {
                carregarDadosSalvos();
            }
        }

        function criarFormularioCompetencias() {
            const container = document.getElementById('competenciasContainer');
            let html = '';
            let fatorIndex = 0;

            COMPETENCIAS.forEach((competencia) => {
                html += '<div class="competencia-card">';
                html += '<div class="competencia-header">' + competencia.nome + '</div>';

                competencia.fatores.forEach((fator) => {
                    html += '<div class="fator-item">';
                    html += '<div class="fator-texto">' + fator + '</div>';
                    html += '<div class="rating-container">';
                    html += '<span class="rating-label">Inadequado</span>';
                    
                    for(let i = 1; i <= 5; i++) {
                        html += '<label class="rating-option">';
                        html += '<input type="radio" name="fator_' + fatorIndex + '" value="' + i + '" onchange="atualizarProgresso()">';
                        html += '<span>' + i + '</span>';
                        html += '</label>';
                    }
                    
                    html += '<span class="rating-label">Excelente</span>';
                    html += '</div>';
                    html += '</div>';
                    fatorIndex++;
                });

                html += '</div>';
            });

            container.innerHTML = html;
        }

        function atualizarProgresso() {
            const totalFatores = 31;
            const fatoresAvaliados = document.querySelectorAll('input[type="radio"]:checked').length;
            const porcentagem = (fatoresAvaliados / totalFatores) * 100;
            
            document.getElementById('progressFill').style.width = porcentagem + '%';
            document.getElementById('progressText').textContent = fatoresAvaliados + ' de ' + totalFatores + ' fatores avaliados';
            
            return fatoresAvaliados;
        }

        function calcularResultado() {
            const fatoresAvaliados = atualizarProgresso();
            
            if (fatoresAvaliados === 0) {
                mostrarAlerta('‚ùå Avalie pelo menos um fator antes de calcular!', 'danger');
                return;
            }

            const radios = document.querySelectorAll('input[type="radio"]:checked');
            let somaNotas = 0;
            
            radios.forEach(radio => {
                somaNotas += parseInt(radio.value);
            });

            const pontuacao = fatoresAvaliados > 0 ? (somaNotas / fatoresAvaliados) : 0;
            let classificacao = '';
            
            if (pontuacao >= 4.5) {
                classificacao = 'EXCELENTE';
            } else if (pontuacao >= 3.5) {
                classificacao = 'BOM';
            } else if (pontuacao >= 2.5) {
                classificacao = 'REGULAR';
            } else {
                classificacao = 'PRECISA MELHORAR';
            }

            document.getElementById('pontuacaoDisplay').textContent = pontuacao.toFixed(2) + '/5.00';
            document.getElementById('classificacaoDisplay').textContent = classificacao;

            const laudoResumo = gerarLaudoResumo(pontuacao, classificacao);
            document.getElementById('laudoResumo').innerHTML = laudoResumo;

            document.getElementById('resultadoCard').classList.add('show');

            document.getElementById('btnSalvar').disabled = fatoresAvaliados < 15;

            avaliacaoAtual = {
                pontuacao: pontuacao,
                classificacao: classificacao,
                fatoresAvaliados: fatoresAvaliados,
                respostas: coletarRespostas()
            };

            if (fatoresAvaliados < 15) {
                mostrarAlerta('‚ö†Ô∏è Avalie pelo menos 15 fatores para poder salvar a avalia√ß√£o completa.', 'warning');
            }
        }

        function coletarRespostas() {
            const respostas = {};
            const radios = document.querySelectorAll('input[type="radio"]:checked');
            
            radios.forEach(radio => {
                respostas[radio.name] = radio.value;
            });

            return respostas;
        }

        function gerarLaudoResumo(pontuacao, classificacao) {
            let resumo = '';
            
            if (pontuacao >= 4.5) {
                resumo = '<strong style="color: var(--cor-primaria);">üéØ EXCELENTE DESEMPENHO!</strong><br>';
                resumo += 'O(a) avaliado(a) demonstra compet√™ncias excepcionais em lideran√ßa. ';
                resumo += 'Recomenda-se aproveitar seu potencial em projetos estrat√©gicos e como mentor(a) de outros l√≠deres.';
            } else if (pontuacao >= 3.5) {
                resumo = '<strong style="color: var(--cor-primaria);">üëç BOM DESEMPENHO!</strong><br>';
                resumo += 'O(a) avaliado(a) apresenta desempenho s√≥lido com oportunidades espec√≠ficas de desenvolvimento. ';
                resumo += 'Com investimento direcionado, pode alcan√ßar n√≠vel de excel√™ncia.';
            } else if (pontuacao >= 2.5) {
                resumo = '<strong style="color: #ffc107;">üìà DESEMPENHO REGULAR</strong><br>';
                resumo += '√â necess√°rio um plano de desenvolvimento estruturado. ';
                resumo += 'Recomenda-se coaching individual e acompanhamento pr√≥ximo para evolu√ß√£o das compet√™ncias.';
            } else {
                resumo = '<strong style="color: #dc3545;">üìö PRECISA MELHORAR</strong><br>';
                resumo += 'Necess√°ria interven√ß√£o imediata com programa intensivo de desenvolvimento. ';
                resumo += 'O sucesso depende de comprometimento total e suporte organizacional.';
            }

            return resumo;
        }

        function limparFormulario() {
            if (confirm('üóëÔ∏è Deseja realmente limpar todos os dados do formul√°rio?')) {
                document.getElementById('nomeAvaliado').value = '';
                document.getElementById('matriculaAvaliado').value = '';
                document.getElementById('funcaoAvaliado').value = '';
                document.getElementById('nomeGestor').value = '';
                document.getElementById('matriculaGestor').value = '';
                document.getElementById('funcaoGestor').value = '';
                document.getElementById('filial').value = '';
                document.getElementById('regionalGestor').value = '';
                document.getElementById('pontosFortes').value = '';
                document.getElementById('oportunidades').value = '';
                document.getElementById('comentarios').value = '';

                document.querySelectorAll('input[type="radio"]').forEach(radio => {
                    radio.checked = false;
                });

                document.getElementById('resultadoCard').classList.remove('show');
                document.getElementById('btnSalvar').disabled = true;
                
                // Resetar feedback visual
                limparCamposColaborador();
                limparCamposGestor();
                
                atualizarProgresso();
                avaliacaoAtual = null;

                mostrarAlerta('üóëÔ∏è Formul√°rio limpo com sucesso!', 'info');
            }
        }

        function atualizarEstatisticasHome() {
            const total = avaliacoes.length;
            let somaNotas = 0;
            let excelentes = 0;

            avaliacoes.forEach(av => {
                somaNotas += parseFloat(av.pontuacao);
                if (av.classificacao === 'EXCELENTE') excelentes++;
            });

            const media = total > 0 ? (somaNotas / total).toFixed(2) : '0.00';

            animarNumero('totalAvaliacoesHome', total);
            animarNumero('mediaGeralHome', parseFloat(media));
            animarNumero('totalColaboradoresHome', Object.keys(colaboradores).length);
            animarNumero('totalGestoresHome', Object.keys(gestores).length);
        }

        function atualizarEstatisticasConfig() {
            const totalColabs = Object.keys(colaboradores).length;
            const totalGests = Object.keys(gestores).length;
            const totalAvs = avaliacoes.length;

            animarNumero('totalColaboradoresConfig', totalColabs);
            animarNumero('totalGestoresConfig', totalGests);
            animarNumero('totalAvaliacoesConfig', totalAvs);
            
            // Atualizar status da conex√£o
            const statusEl = document.getElementById('statusSincronizacao');
            if (statusEl) {
                if (dadosCarregados) {
                    statusEl.textContent = 'OK';
                    statusEl.style.color = 'var(--cor-primaria)';
                } else {
                    statusEl.textContent = 'ERRO';
                    statusEl.style.color = '#dc3545';
                }
            }
            
            // Atualizar URL exibida
            const urlEl = document.getElementById('webappUrl');
            if (urlEl) {
                if (WEBAPP_URL && !WEBAPP_URL.includes('SEU_ID')) {
                    urlEl.textContent = WEBAPP_URL.substring(0, 50) + '...';
                    urlEl.style.color = 'var(--cor-primaria)';
                } else {
                    urlEl.textContent = 'N√£o configurada';
                    urlEl.style.color = '#dc3545';
                }
            }
        }

        // =====================================================
        // FUN√á√ïES DE CONFIGURA√á√ÉO
        // =====================================================

        function configurarWebApp() {
            const novaURL = prompt('üîó Digite a URL da sua Web App do Google Apps Script:\n\n(Exemplo: https://script.google.com/macros/s/SEU_ID/exec)', WEBAPP_URL);
            
            if (novaURL && novaURL.trim()) {
                WEBAPP_URL = novaURL.trim();
                localStorage.setItem('webapp_url_gg', WEBAPP_URL);
                
                // Resetar dados para for√ßar nova busca
                dadosCarregados = false;
                cacheLocal.ultimaAtualizacao = null;
                
                atualizarEstatisticasConfig();
                
                mostrarAlerta('‚úÖ URL da Web App configurada com sucesso!', 'success');
                console.log('üîó URL configurada:', WEBAPP_URL);
                
                // Tentar carregar dados automaticamente
                carregarDadosSalvos();
            }
        }

        async function testarConexaoSheets() {
            try {
                mostrarLoading(true);
                const resultado = await buscarDoGoogleSheets('status');
                
                if (resultado.sucesso) {
                    mostrarAlerta('‚úÖ Conex√£o com Google Sheets funcionando perfeitamente!', 'success');
                } else {
                    mostrarAlerta('‚ö†Ô∏è Conectado, mas com problemas: ' + resultado.mensagem, 'warning');
                }
                
            } catch (error) {
                mostrarAlerta('‚ùå Erro na conex√£o: ' + error.message, 'danger');
            } finally {
                mostrarLoading(false);
            }
        }

        async function sincronizarDados() {
            try {
                mostrarLoading(true);
                
                // For√ßar nova busca dos dados
                dadosCarregados = false;
                cacheLocal.ultimaAtualizacao = null;
                
                await carregarDadosSalvos();
                
                atualizarEstatisticasHome();
                atualizarEstatisticasConfig();
                
                mostrarAlerta('‚úÖ Sincroniza√ß√£o completa realizada!', 'success');
                
            } catch (error) {
                mostrarAlerta('‚ùå Erro na sincroniza√ß√£o: ' + error.message, 'danger');
            } finally {
                mostrarLoading(false);
            }
        }

        async function verificarIntegridadeDados() {
            try {
                mostrarLoading(true);
                
                const stats = {
                    colaboradores: Object.keys(colaboradores).length,
                    gestores: Object.keys(gestores).length,
                    avaliacoes: avaliacoes.length,
                    cacheValido: cacheLocal.ultimaAtualizacao && (new Date().getTime() - cacheLocal.ultimaAtualizacao) < cacheLocal.tempoCache
                };
                
                let relatorio = `üìä RELAT√ìRIO DE INTEGRIDADE\n\n`;
                relatorio += `‚Ä¢ Colaboradores: ${stats.colaboradores}\n`;
                relatorio += `‚Ä¢ Gestores: ${stats.gestores}\n`;
                relatorio += `‚Ä¢ Avalia√ß√µes: ${stats.avaliacoes}\n`;
                relatorio += `‚Ä¢ Cache v√°lido: ${stats.cacheValido ? 'Sim' : 'N√£o'}\n`;
                relatorio += `‚Ä¢ √öltima atualiza√ß√£o: ${cacheLocal.ultimaAtualizacao ? new Date(cacheLocal.ultimaAtualizacao).toLocaleString() : 'Nunca'}`;
                
                alert(relatorio);
                mostrarAlerta('‚úÖ Verifica√ß√£o de integridade conclu√≠da!', 'info');
                
            } catch (error) {
                mostrarAlerta('‚ùå Erro na verifica√ß√£o: ' + error.message, 'danger');
            } finally {
                mostrarLoading(false);
            }
        }

        async function gerarRelatorioCompleto() {
            try {
                const dadosCompletos = {
                    sistema: {
                        versao: '3.0.0',
                        timestamp: new Date().toISOString(),
                        usuario: acessoAtual.senha || 'An√¥nimo'
                    },
                    estatisticas: {
                        colaboradores: Object.keys(colaboradores).length,
                        gestores: Object.keys(gestores).length,
                        avaliacoes: avaliacoes.length,
                        dadosCarregados: dadosCarregados
                    },
                    dados: {
                        colaboradores: colaboradores,
                        gestores: gestores,
                        avaliacoes: avaliacoes
                    }
                };
                
                const blob = new Blob([JSON.stringify(dadosCompletos, null, 2)], { type: 'application/json' });
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'relatorio_completo_gg_' + new Date().toISOString().split('T')[0] + '.json';
                a.click();
                window.URL.revokeObjectURL(url);
                
                mostrarAlerta('üìä Relat√≥rio completo exportado!', 'success');
                
            } catch (error) {
                mostrarAlerta('‚ùå Erro ao gerar relat√≥rio: ' + error.message, 'danger');
            }
        }

        function exportarDados() {
            const dadosFiltrados = filtrarDadosPorAcesso(avaliacoes);
            
            if (dadosFiltrados.length === 0) {
                mostrarAlerta('‚ùå Nenhuma avalia√ß√£o para exportar!', 'danger');
                return;
            }

            let csv = 'Data,Avaliado,Matricula,Funcao,Gestor,Filial,Pontuacao,Classificacao\n';
            
            dadosFiltrados.forEach(av => {
                const linha = [
                    new Date(av.data).toLocaleDateString('pt-BR'),
                    av.nomeAvaliado,
                    av.matricula || '',
                    av.funcaoAvaliado || '',
                    av.nomeGestor,
                    av.filial,
                    av.pontuacao,
                    av.classificacao
                ].join(',');
                csv += linha + '\n';
            });

            const blob = new Blob([csv], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            
            const nomeArquivo = acessoAtual.tipo === 'filial' 
                ? `avaliacoes_filial_${acessoAtual.filial}_${new Date().toISOString().split('T')[0]}.csv`
                : `avaliacoes_gg_${new Date().toISOString().split('T')[0]}.csv`;
            
            a.download = nomeArquivo;
            a.click();
            window.URL.revokeObjectURL(url);

            mostrarAlerta('üì• Dados exportados com sucesso!', 'success');
        }

        // =====================================================
        // FUN√á√ïES AUXILIARES
        // =====================================================

        function animarNumero(elementId, valorFinal, duracao = 1000) {
            const elemento = document.getElementById(elementId);
            if (!elemento) return;

            const valorInicial = parseFloat(elemento.textContent) || 0;
            const inicio = performance.now();

            function animar(tempoAtual) {
                const decorrido = tempoAtual - inicio;
                const progresso = Math.min(decorrido / duracao, 1);
                const progressoSuave = 1 - Math.pow(1 - progresso, 3);
                const valorAtual = valorInicial + (valorFinal - valorInicial) * progressoSuave;
                
                if (elementId.includes('media') || elementId.includes('Media')) {
                    elemento.textContent = valorAtual.toFixed(2);
                } else {
                    elemento.textContent = Math.round(valorAtual);
                }

                if (progresso < 1) {
                    requestAnimationFrame(animar);
                }
            }

            requestAnimationFrame(animar);
        }

        function mostrarAlerta(mensagem, tipo) {
            const alertasExistentes = document.querySelectorAll('.alert');
            alertasExistentes.forEach(alerta => {
                if (!alerta.id || alerta.id !== 'statusDados') {
                    alerta.remove();
                }
            });

            const alerta = document.createElement('div');
            alerta.className = 'alert alert-' + tipo;
            alerta.innerHTML = mensagem;

            const secaoAtiva = document.querySelector('.section.active');
            secaoAtiva.insertBefore(alerta, secaoAtiva.firstChild);

            setTimeout(() => {
                if (alerta.parentNode) {
                    alerta.remove();
                }
            }, 5000);
        }

        function mostrarLoading(mostrar) {
            const loading = document.getElementById('loading');
            if (loading) {
                loading.style.display = mostrar ? 'block' : 'none';
            }
        }

        // =====================================================
        // INICIALIZA√á√ÉO
        // =====================================================

        document.addEventListener('DOMContentLoaded', async function() {
            console.log('üîÑ Iniciando sistema com busca autom√°tica...');
            
            // Carregar URL salva
            const urlSalva = localStorage.getItem('webapp_url_gg');
            if (urlSalva) {
                WEBAPP_URL = urlSalva;
            }
            
            // Tentar carregar cache do localStorage
            try {
                const cacheStorage = localStorage.getItem('gg_cache');
                if (cacheStorage) {
                    const dadosCache = JSON.parse(cacheStorage);
                    cacheLocal = dadosCache;
                    avaliacoes = dadosCache.avaliacoes || [];
                    colaboradores = dadosCache.colaboradores || {};
                    gestores = dadosCache.gestores || {};
                    console.log('üíæ Cache local carregado como fallback');
                }
            } catch (error) {
                console.warn('‚ö†Ô∏è Erro ao carregar cache local:', error);
            }
            
            // Carregar dados das planilhas
            await carregarDadosSalvos();
            
            // Inicializar interface
            atualizarEstatisticasHome();
            
            console.log('üéØ Sistema com busca autom√°tica inicializado!');
        });

        // =====================================================
        // COMANDOS DE CONSOLE PARA DEBUG
        // =====================================================

        window.sistemaGG = {
            info: () => ({
                versao: '3.0.0 - Busca Autom√°tica',
                totalAvaliacoes: avaliacoes.length,
                totalColaboradores: Object.keys(colaboradores).length,
                totalGestores: Object.keys(gestores).length,
                webappURL: WEBAPP_URL,
                acessoAtual: acessoAtual,
                dadosCarregados: dadosCarregados,
                cache: cacheLocal,
                ultimaAtualizacao: cacheLocal.ultimaAtualizacao ? new Date(cacheLocal.ultimaAtualizacao).toLocaleString() : 'Nunca'
            }),
            sincronizar: sincronizarDados,
            testarConexao: testarConexaoSheets,
            configurarURL: configurarWebApp,
            verificarIntegridade: verificarIntegridadeDados,
            logout: logout,
            acesso: () => acessoAtual,
            dados: () => ({ avaliacoes, colaboradores, gestores }),
            cache: () => cacheLocal,
            buscarColaborador: buscarColaborador,
            buscarGestor: buscarGestor,
            recarregarDados: () => {
                dadosCarregados = false;
                cacheLocal.ultimaAtualizacao = null;
                return carregarDadosSalvos();
            }
        };

        console.log(`
üéØ SISTEMA G&G - VERS√ÉO COM BUSCA AUTOM√ÅTICA
============================================
‚úÖ Busca autom√°tica de colaboradores e gestores
‚úÖ Sincroniza√ß√£o em tempo real com Google Sheets
‚úÖ Cache inteligente para melhor performance
‚úÖ Controle de acesso por filial mantido
‚úÖ Dados sempre atualizados das planilhas
‚úÖ Fallback para cache local em caso de falha

üîß COMO FUNCIONA:
‚Ä¢ Sistema busca automaticamente dados das planilhas
‚Ä¢ Colaboradores e gestores s√£o carregados em tempo real
‚Ä¢ Cache de 5 minutos para otimizar performance
‚Ä¢ Atualiza√ß√µes autom√°ticas conforme necess√°rio

üè¢ FILIAIS CADASTRADAS:
743-MS | 264-SC | 753-MT | 364-DF | 713-SP
468-MT | 892-SP | 723-SP | 230-SP | 773-RS
473-MT | 167-MS | 20-AGP

üíª DESENVOLVIDO POR: Juliano Patrick
üìß CONTATO: julianocorrea@bateforte.com.br
============================================

üîß COMANDOS DE DEBUG:
‚Ä¢ sistemaGG.info() - Informa√ß√µes do sistema
‚Ä¢ sistemaGG.sincronizar() - For√ßar sincroniza√ß√£o
‚Ä¢ sistemaGG.testarConexao() - Testar Google Sheets
‚Ä¢ sistemaGG.recarregarDados() - Recarregar dados
        `);
    </script>
</body>
</html>
