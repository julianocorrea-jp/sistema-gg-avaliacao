<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üéØ Sistema de Avalia√ß√£o de Desempenho G&G v4.0 - Supabase CORRIGIDO</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --cor-primaria: #1e441e;
            --cor-secundaria: #8FD694;
            --cor-acento: #77AD78;
            --cor-neutra: #6F8F72;
            --cor-escura: #504B43;
            --cor-clara: #F8FAF9;
            --cor-branca: #FFFFFF;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--cor-clara);
            line-height: 1.6;
            color: var(--cor-escura);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .main-header {
            background: linear-gradient(135deg, var(--cor-primaria) 0%, var(--cor-primaria) 100%);
            color: white;
            padding: 30px 0;
            text-align: center;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            margin-bottom: 30px;
            border-radius: 15px;
        }

        .nav-menu {
            background: var(--cor-branca);
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            margin-bottom: 30px;
            text-align: center;
        }

        .nav-btn {
            background: linear-gradient(135deg, var(--cor-primaria) 0%, var(--cor-primaria) 100%);
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px;
            transition: all 0.3s ease;
            font-weight: 600;
        }

        .nav-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 15px rgba(125, 186, 132, 0.3);
        }

        .nav-btn.active {
            background: linear-gradient(135deg, var(--cor-secundaria) 0%, var(--cor-secundaria) 100%);
            box-shadow: 0 4px 10px rgba(143, 214, 148, 0.4);
        }

        .section {
            background: var(--cor-branca);
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            margin-bottom: 30px;
            display: none;
        }

        .section.active {
            display: block;
        }

        .section h2 {
            color: var(--cor-secundaria);
            margin-bottom: 25px;
            font-size: 1.8em;
            border-bottom: 3px solid var(--cor-primaria);
            padding-bottom: 10px;
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--cor-escura);
        }

        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
            border-color: var(--cor-primaria);
            outline: none;
            box-shadow: 0 0 10px rgba(125, 186, 132, 0.2);
        }

        .btn {
            background: linear-gradient(135deg, var(--cor-primaria) 0%, var(--cor-primaria) 100%);
            color: white;
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            margin: 5px;
            transition: all 0.3s ease;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(125, 186, 132, 0.3);
        }

        .btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .btn-success {
            background: linear-gradient(135deg, var(--cor-primaria) 0%, var(--cor-primaria) 100%);
        }

        .btn-danger {
            background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
        }

        .btn-warning {
            background: linear-gradient(135deg, #ffc107 0%, #e0a800 100%);
        }

        .btn-info {
            background: linear-gradient(135deg, var(--cor-primaria) 0%, var(--cor-primaria) 100%);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .stat-card {
            background: linear-gradient(135deg, var(--cor-primaria) 0%, var(--cor-primaria) 100%);
            color: white;
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .stat-card:hover {
            transform: translateY(-5px) scale(1.02);
            box-shadow: 0 8px 20px rgba(30, 68, 30, 0.3);
        }

        .stat-number {
            font-size: 2.5em;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .alert {
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            border-left: 5px solid;
        }

        .alert-success {
            background: rgba(143, 214, 148, 0.1);
            border-color: var(--cor-secundaria);
            color: var(--cor-acento);
        }

        .alert-danger {
            background: #f8d7da;
            border-color: #dc3545;
            color: #721c24;
        }

        .alert-warning {
            background: #fff3cd;
            border-color: #ffc107;
            color: #856404;
        }

        .alert-info {
            background: rgba(111, 143, 114, 0.1);
            border-color: var(--cor-neutra);
            color: var(--cor-escura);
        }

        .competencia-card {
            background: #f8faf9;
            border: 1px solid #e0e0e0;
            border-radius: 15px;
            margin: 20px 0;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .competencia-header {
            background: linear-gradient(135deg, var(--cor-primaria) 0%, var(--cor-acento) 100%);
            color: white;
            padding: 20px;
            font-size: 1.2em;
            font-weight: bold;
        }

        .fator-item {
            padding: 20px;
            border-bottom: 1px solid #eee;
        }

        .fator-texto {
            margin-bottom: 15px;
            font-weight: 500;
            color: var(--cor-escura);
        }

        .rating-container {
            display: flex;
            align-items: center;
            gap: 15px;
            flex-wrap: wrap;
        }

        .rating-label {
            font-size: 12px;
            color: var(--cor-neutra);
            font-weight: 600;
        }

        .rating-option {
            display: flex;
            flex-direction: column;
            align-items: center;
            cursor: pointer;
            padding: 10px;
            border-radius: 8px;
            transition: all 0.3s ease;
        }

        .rating-option:hover {
            background: rgba(125, 186, 132, 0.1);
            transform: scale(1.05);
        }

        .rating-option input[type="radio"] {
            margin-bottom: 5px;
            transform: scale(1.2);
            accent-color: var(--cor-primaria);
        }

        .progress-container {
            background: var(--cor-branca);
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin: 20px 0;
        }

        .progress-bar {
            width: 100%;
            height: 25px;
            background: #e0e0e0;
            border-radius: 15px;
            overflow: hidden;
            margin: 10px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(135deg, var(--cor-secundaria) 0%, var(--cor-primaria) 100%);
            width: 0%;
            transition: width 0.8s ease;
            border-radius: 15px;
        }

        .resultado-card {
            background: linear-gradient(135deg, #f8faf9 0%, #e9f5ea 100%);
            border: 2px solid var(--cor-secundaria);
            border-radius: 15px;
            padding: 30px;
            text-align: center;
            margin: 30px 0;
            display: none;
        }

        .resultado-card.show {
            display: block;
        }

        .pontuacao-display {
            font-size: 3em;
            font-weight: bold;
            margin: 20px 0;
            color: var(--cor-primaria);
        }

        .classificacao-display {
            font-size: 1.5em;
            font-weight: bold;
            padding: 15px 30px;
            border-radius: 50px;
            margin: 20px 0;
            display: inline-block;
            background: var(--cor-primaria);
            color: white;
        }

        .login-card {
            background: linear-gradient(135deg, #f8faf9 0%, #e9f5ea 100%);
            border: 2px solid var(--cor-secundaria);
            border-radius: 20px;
            padding: 40px;
            text-align: center;
            margin: 30px 0;
            box-shadow: 0 8px 25px rgba(30, 68, 30, 0.1);
        }

        .login-input {
            width: 100%;
            max-width: 400px;
            padding: 15px 20px;
            border: 2px solid var(--cor-primaria);
            border-radius: 50px;
            font-size: 16px;
            text-align: center;
            margin: 20px auto;
            display: block;
            transition: all 0.3s ease;
            background: rgba(255, 255, 255, 0.9);
        }

        .login-input:focus {
            outline: none;
            box-shadow: 0 0 20px rgba(30, 68, 30, 0.3);
            transform: translateY(-2px);
        }

        .tabela-historico {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .tabela-historico th {
            background: var(--cor-primaria);
            color: white;
            padding: 15px;
            font-weight: 600;
            text-align: center;
        }

        .tabela-historico td {
            padding: 15px;
            border-bottom: 1px solid #eee;
            text-align: center;
        }

        .tabela-historico tr:nth-child(even) {
            background: rgba(248, 250, 249, 0.5);
        }

        .tabela-historico tr:hover {
            background: rgba(143, 214, 148, 0.1);
            transform: scale(1.01);
            transition: all 0.3s ease;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid var(--cor-primaria);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .status-conexao {
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
            text-align: center;
            font-weight: bold;
        }

        .status-conectado {
            background: rgba(143, 214, 148, 0.1);
            border: 2px solid var(--cor-secundaria);
            color: var(--cor-primaria);
        }

        .status-desconectado {
            background: rgba(220, 53, 69, 0.1);
            border: 2px solid #dc3545;
            color: #721c24;
        }

        .access-status {
            background: var(--cor-primaria);
            color: white;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: center;
            font-weight: bold;
        }

        .info-card {
            background: var(--cor-branca);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            margin: 20px 0;
        }

        .debug-info {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 15px;
            margin: 20px 0;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            white-space: pre-wrap;
            max-height: 400px;
            overflow-y: auto;
        }

        .chart-container {
            position: relative;
            height: 400px;
            margin: 20px 0;
        }

        .registro-contador {
            background: rgba(143, 214, 148, 0.1);
            border: 1px solid var(--cor-secundaria);
            border-radius: 8px;
            padding: 10px;
            margin: 10px 0;
            text-align: center;
            font-weight: bold;
            color: var(--cor-primaria);
        }
    </style>
</head>
<body>
    <header class="main-header">
        <div class="container">
            <h1><i class="fas fa-target"></i> SISTEMA DE AVALIA√á√ÉO DE DESEMPENHO</h1>
            <p>Sistema G&G v4.0 - Conectado ao Supabase (SEM LIMITE DE REGISTROS)</p>
        </div>
    </header>

    <div class="container">
        <nav class="nav-menu">
            <button class="nav-btn active" onclick="GG.showSection('home')">
                <i class="fas fa-home"></i> Home
            </button>
            <button class="nav-btn" onclick="GG.showSection('avaliacao')">
                <i class="fas fa-edit"></i> Nova Avalia√ß√£o
            </button>
            <button class="nav-btn" onclick="GG.acessoHistorico()">
                <i class="fas fa-clipboard-list"></i> Hist√≥rico
            </button>
            <button class="nav-btn" onclick="GG.acessoConfiguracoes()">
                <i class="fas fa-cog"></i> Configura√ß√µes
            </button>
        </nav>

        <!-- Se√ß√£o Home -->
        <section id="home" class="section active">
            <h2><i class="fas fa-home"></i> Sistema G&G v4.0 - Supabase COMPLETO</h2>
            
            <div id="statusConexaoHome" class="status-conexao">
                <span id="textoStatus"><i class="fas fa-sync fa-spin"></i> Verificando conex√£o...</span>
            </div>

            <div class="alert alert-success">
                <h4><i class="fas fa-database"></i> Sistema v4.0 - CORRE√á√ïES IMPLEMENTADAS!</h4>
                <p><strong>‚úÖ Problemas Resolvidos:</strong></p>
                <ul style="margin: 10px 0; padding-left: 30px;">
                    <li><i class="fas fa-check"></i> <strong>Busca SEM LIMITE:</strong> Busca TODOS os registros (n√£o apenas 1000)</li>
                    <li><i class="fas fa-check"></i> <strong>Nome da tabela:</strong> Corrigido de 'avalia√ß√µes' para 'avaliacoes'</li>
                    <li><i class="fas fa-check"></i> <strong>Colunas corretas:</strong> Usando estrutura real do banco</li>
                    <li><i class="fas fa-check"></i> <strong>Salvamento funcionando:</strong> API REST otimizada</li>
                    <li><i class="fas fa-check"></i> <strong>Pagina√ß√£o autom√°tica:</strong> Busca todos os dados</li>
                    <li><i class="fas fa-check"></i> <strong>Interface responsiva:</strong> Otimizada para PDF</li>
                </ul>
                <p><strong><i class="fas fa-rocket"></i> Sistema 100% operacional!</strong></p>
            </div>

            <div id="contadorRegistros" class="registro-contador" style="display: none;">
                <i class="fas fa-database"></i> Carregando registros do Supabase...
            </div>

            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-number" id="totalAvaliacoesHome">0</div>
                    <div class="stat-label">Avalia√ß√µes Realizadas</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="mediaGeralHome">0.00</div>
                    <div class="stat-label">M√©dia Geral</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="totalColaboradoresHome">0</div>
                    <div class="stat-label">Colaboradores</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="totalGestoresHome">0</div>
                    <div class="stat-label">Gestores</div>
                </div>
            </div>

            <div class="chart-container">
                <canvas id="graficoPerformance"></canvas>
            </div>
        </section>

        <!-- Se√ß√£o Nova Avalia√ß√£o -->
        <section id="avaliacao" class="section">
            <h2><i class="fas fa-edit"></i> Nova Avalia√ß√£o</h2>
            
            <div id="statusDados" class="alert alert-info">
                <p><i class="fas fa-sync fa-spin"></i> <strong>Carregando dados do Supabase...</strong></p>
            </div>

            <div class="info-card">
                <h3><i class="fas fa-user"></i> Dados Pessoais</h3>
                <div class="form-row">
                    <div class="form-group">
                        <label for="matriculaAvaliado">Matr√≠cula do Avaliado *</label>
                        <input type="text" id="matriculaAvaliado" required placeholder="Digite a matr√≠cula..." 
                               onchange="GG.buscarColaborador(this.value)" oninput="GG.limparCamposColaborador()">
                    </div>
                    <div class="form-group">
                        <label for="nomeAvaliado">Nome do Avaliado</label>
                        <input type="text" id="nomeAvaliado" readonly style="background: #f0f0f0;">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="funcaoAvaliado">Fun√ß√£o do Avaliado</label>
                        <input type="text" id="funcaoAvaliado" readonly style="background: #f0f0f0;">
                    </div>
                    <div class="form-group">
                        <label for="filial">Filial</label>
                        <input type="text" id="filial" readonly style="background: #f0f0f0;">
                    </div>
                </div>

                <hr style="margin: 30px 0; border: 1px solid #e0e0e0;">

                <div class="form-row">
                    <div class="form-group">
                        <label for="matriculaGestor">Matr√≠cula do Gestor *</label>
                        <input type="text" id="matriculaGestor" required placeholder="Digite a matr√≠cula do gestor..." 
                               onchange="GG.buscarGestor(this.value)" oninput="GG.limparCamposGestor()">
                    </div>
                    <div class="form-group">
                        <label for="nomeGestor">Nome do Gestor</label>
                        <input type="text" id="nomeGestor" readonly style="background: #f0f0f0;">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="funcaoGestor">Fun√ß√£o do Gestor</label>
                        <input type="text" id="funcaoGestor" readonly style="background: #f0f0f0;">
                    </div>
                    <div class="form-group">
                        <label for="regionalGestor">Regional</label>
                        <input type="text" id="regionalGestor" readonly style="background: #f0f0f0;">
                    </div>
                </div>
            </div>

            <div class="progress-container">
                <h3><i class="fas fa-chart-line"></i> Progresso da Avalia√ß√£o</h3>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
                <div class="progress-text" id="progressText">0 de 31 fatores avaliados</div>
            </div>

            <div id="competenciasContainer"></div>

            <div class="info-card">
                <h3><i class="fas fa-comments"></i> Feedback e Coment√°rios</h3>
                <div class="form-group">
                    <label for="pontosFortes">Pontos Fortes</label>
                    <textarea id="pontosFortes" rows="4" placeholder="Principais pontos fortes identificados..."></textarea>
                </div>
                <div class="form-group">
                    <label for="oportunidades">Oportunidades de Desenvolvimento</label>
                    <textarea id="oportunidades" rows="4" placeholder="√Åreas que precisam de desenvolvimento..."></textarea>
                </div>
                <div class="form-group">
                    <label for="comentarios">Coment√°rios Gerais</label>
                    <textarea id="comentarios" rows="4" placeholder="Coment√°rios adicionais sobre a avalia√ß√£o..."></textarea>
                </div>
            </div>

            <div id="resultadoCard" class="resultado-card">
                <h3><i class="fas fa-chart-bar"></i> Resultado da Avalia√ß√£o</h3>
                <div class="pontuacao-display" id="pontuacaoDisplay">0.00/5.00</div>
                <div class="classificacao-display" id="classificacaoDisplay">-</div>
                <div id="laudoResumo" style="margin-top: 20px; font-size: 1.1em; line-height: 1.6;"></div>
            </div>

            <div style="text-align: center; margin: 30px 0;">
                <button class="btn btn-info" onclick="GG.calcularResultado()">
                    <i class="fas fa-calculator"></i> Calcular Resultado
                </button>
                <button class="btn btn-success" onclick="GG.salvarAvaliacao()" id="btnSalvar" disabled>
                    <i class="fas fa-save"></i> Salvar no Supabase
                </button>
                <button class="btn" onclick="GG.limparFormulario()">
                    <i class="fas fa-trash"></i> Limpar Formul√°rio
                </button>
            </div>

            <div class="loading" id="loading">
                <div class="spinner"></div>
                <p>Processando...</p>
            </div>
        </section>

        <!-- Se√ß√£o de Login para Hist√≥rico -->
        <section id="loginHistorico" class="section">
            <h2><i class="fas fa-lock"></i> Acesso ao Hist√≥rico por Filial</h2>
            <div class="login-card">
                <h3 style="color: var(--cor-primaria); margin-bottom: 30px;">
                    <i class="fas fa-key"></i> Digite a Senha da sua Filial
                </h3>
                <div class="form-group">
                    <input type="password" id="senhaHistorico" class="login-input" 
                           placeholder="Digite a senha da sua filial..." onkeypress="GG.verificarEnter(event, 'historico')">
                </div>
                <button class="btn btn-success" onclick="GG.validarSenhaHistorico()">
                    <i class="fas fa-unlock"></i> Acessar Hist√≥rico
                </button>
                <button class="btn" onclick="GG.showSection('home')">
                    <i class="fas fa-times"></i> Cancelar
                </button>
                <div style="background: rgba(255, 255, 255, 0.7); border-radius: 15px; padding: 25px; margin-top: 30px; text-align: left;">
                    <h4 style="color: var(--cor-primaria); margin-bottom: 15px; text-align: center;">
                        <i class="fas fa-info-circle"></i> Senhas por Filial
                    </h4>
                    <p><strong>Filiais:</strong> GG74301 (743-MS) | GG26402 (264-SC) | GG75303 (753-MT) | GG36404 (364-DF) | GG71305 (713-SP)</p>
                    <p><strong>Master:</strong> GGMASTER (todas as filiais) | GGMASTERJP (administrativo)</p>
                </div>
            </div>
        </section>

        <!-- Se√ß√£o de Login para Configura√ß√µes -->
        <section id="loginConfiguracoes" class="section">
            <h2><i class="fas fa-cog"></i> Acesso √†s Configura√ß√µes</h2>
            <div class="login-card">
                <h3 style="color: var(--cor-primaria); margin-bottom: 30px;">
                    <i class="fas fa-shield-alt"></i> √Årea Restrita - Administra√ß√£o
                </h3>
                <div class="form-group">
                    <input type="password" id="senhaConfiguracoes" class="login-input" 
                           placeholder="Digite GGMASTERJP..." onkeypress="GG.verificarEnter(event, 'configuracoes')">
                </div>
                <button class="btn btn-success" onclick="GG.validarSenhaConfiguracoes()">
                    <i class="fas fa-unlock"></i> Acessar Configura√ß√µes
                </button>
                <button class="btn" onclick="GG.showSection('home')">
                    <i class="fas fa-times"></i> Cancelar
                </button>
            </div>
        </section>

        <!-- Se√ß√£o Hist√≥rico -->
        <section id="historico" class="section">
            <div id="accessStatus" class="access-status" style="display: none;"></div>
            <h2><i class="fas fa-clipboard-list"></i> Hist√≥rico de Avalia√ß√µes</h2>

            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-number" id="totalAvaliacoes">0</div>
                    <div class="stat-label">Total de Avalia√ß√µes</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="mediaGeral">0.00</div>
                    <div class="stat-label">M√©dia Geral</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="excelentes">0</div>
                    <div class="stat-label">Excelentes</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="precisamMelhorar">0</div>
                    <div class="stat-label">Precisam Melhorar</div>
                </div>
            </div>

            <div style="text-align: center; margin: 30px 0;">
                <button class="btn btn-info" onclick="GG.carregarHistorico()">
                    <i class="fas fa-sync"></i> Sincronizar
                </button>
                <button class="btn btn-warning" onclick="GG.exportarDados()">
                    <i class="fas fa-download"></i> Exportar
                </button>
                <button class="btn btn-danger" onclick="GG.logout()">
                    <i class="fas fa-sign-out-alt"></i> Sair
                </button>
            </div>

            <div class="chart-container">
                <canvas id="graficoHistorico"></canvas>
            </div>

            <div id="tabelaHistorico">
                <p style="text-align: center; padding: 30px; color: #666;">
                    <i class="fas fa-chart-bar"></i> Carregando dados...
                </p>
            </div>
        </section>

        <!-- Se√ß√£o Configura√ß√µes -->
        <section id="configuracoes" class="section">
            <div id="configStatus" class="access-status" style="display: none;"></div>
            <h2><i class="fas fa-cog"></i> Configura√ß√µes do Sistema</h2>

            <div class="info-card">
                <h3><i class="fas fa-database"></i> Configura√ß√£o do Supabase</h3>
                <div class="alert alert-warning">
                    <p><strong>Status:</strong> <span id="supabaseStatus">Verificando...</span></p>
                </div>
                <div style="text-align: center; margin: 20px 0;">
                    <button class="btn btn-success" onclick="GG.testarConexao()">
                        <i class="fas fa-plug"></i> Testar Conex√£o
                    </button>
                    <button class="btn btn-warning" onclick="GG.debugCompleto()">
                        <i class="fas fa-search"></i> Debug Completo
                    </button>
                </div>
            </div>

            <div id="debugContainer" style="display: none;">
                <div class="info-card">
                    <h3><i class="fas fa-bug"></i> Informa√ß√µes de Debug</h3>
                    <div id="debugInfo" class="debug-info"></div>
                </div>
            </div>

            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-number" id="totalColaboradoresConfig">0</div>
                    <div class="stat-label">Colaboradores</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="totalGestoresConfig">0</div>
                    <div class="stat-label">Gestores</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="totalAvaliacoesConfig">0</div>
                    <div class="stat-label">Avalia√ß√µes</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="statusSincronizacao">--</div>
                    <div class="stat-label">Status</div>
                </div>
            </div>

            <div style="text-align: center; margin: 30px 0;">
                <button class="btn btn-info" onclick="GG.sincronizarDados()">
                    <i class="fas fa-sync"></i> Sincronizar
                </button>
                <button class="btn btn-warning" onclick="GG.debugSistema()">
                    <i class="fas fa-bug"></i> Debug R√°pido
                </button>
                <button class="btn btn-danger" onclick="GG.logout()">
                    <i class="fas fa-sign-out-alt"></i> Sair
                </button>
            </div>
        </section>
    </div>

    <footer style="background: var(--cor-primaria); color: white; text-align: center; padding: 15px; margin-top: 50px;">
        <div class="container">
            <p style="margin: 2px 0; font-size: 11px; opacity: 0.7;">
                Desenvolvido por Juliano Patrick | julianocorrea@bateforte.com.br | Sistema v4.0 - Supabase CORRIGIDO ¬© 2025
            </p>
        </div>
    </footer>

    <script>
        // =====================================================
        // SISTEMA G&G v4.0 - SUPABASE CORRIGIDO COMPLETO
        // =====================================================
        const GG = {
            // Configura√ß√µes do Supabase
            SUPABASE_URL: 'https://mtqwqwpqkzrbkxxkaffq.supabase.co',
            SUPABASE_KEY: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im10cXdxd3Bxa3pyYmt4eGthZmZxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTUyMTIxMjgsImV4cCI6MjA3MDc4ODEyOH0.MKaYUE_wumkdkyuoWt5yIY2GhEDRsqsYMfA0oot2bvY',

            // Dados do sistema
            dados: {
                avaliacoes: [],
                colaboradores: {},
                gestores: {},
                avaliacaoAtual: null,
                dadosCarregados: false
            },

            // Cache
            cache: {
                avaliacoes: [],
                colaboradores: {},
                gestores: {},
                ultimaAtualizacao: null,
                tempoCache: 5 * 60 * 1000
            },

            // Controle de acesso
            acesso: {
                tipo: null,
                senha: null,
                filial: null,
                permissoes: []
            },

            // Senhas do sistema
            SENHAS_FILIAIS: {
                'GG74301': { filial: '743', regional: 'MS' },
                'GG26402': { filial: '264', regional: 'SC' },
                'GG75303': { filial: '753', regional: 'MT' },
                'GG36404': { filial: '364', regional: 'DF' },
                'GG71305': { filial: '713', regional: 'SP' }
            },

            SENHAS_ESPECIAIS: {
                'GGMASTER': { tipo: 'master', descricao: 'Acesso a todas as filiais' },
                'GGMASTERJP': { tipo: 'admin', descricao: 'Acesso administrativo completo' }
            },

            // Compet√™ncias
            COMPETENCIAS: [
                {
                    nome: 'COMUNICA√á√ÉO E INFLU√äNCIA',
                    fatores: [
                        'Tem clareza, √© emp√°tico(a) e inclusivo(a) na sua comunica√ß√£o.',
                        'Possui habilidades em comunicar temas cr√≠ticos, transmitindo confian√ßa ao time.',
                        '√â influenciador(a) e inspira seu time e a rede de relacionamento pelo exemplo.',
                        'Respeita as opini√µes divergentes, escuta de maneira aberta.',
                        'Cria um ambiente de seguran√ßa e confian√ßa m√∫tua.'
                    ]
                },
                {
                    nome: 'DISCIPLINA DE EXECU√á√ÉO',
                    fatores: [
                        'Garante planejamento e execu√ß√£o com efici√™ncia dentro dos prazos.',
                        'Constr√≥i regras e processos e busca eliminar burocracias desnecess√°rias.',
                        'Assume responsabilidade, cumpre normas e procedimentos.',
                        'Estimula o time para que esteja comprometido com prazos e entregas.',
                        'Garante n√≠veis excelentes de qualidade nas entregas.'
                    ]
                },
                {
                    nome: 'FOCO EM RESULTADOS',
                    fatores: [
                        'Possui consist√™ncia nas entregas.',
                        'Tem flexibilidade para liderar diferentes frentes.',
                        'Elabora e cumpre planos de a√ß√µes para o atingimento das metas.',
                        'Conhece o neg√≥cio e acompanha resultados atrav√©s de dados.',
                        'Estimula o time para possu√≠rem vis√£o cr√≠tica e trazerem solu√ß√µes.'
                    ]
                },
                {
                    nome: 'FOCO NO CLIENTE/TUTOR',
                    fatores: [
                        'Entende, prioriza e antecipa as necessidades dos clientes.',
                        'Constr√≥i alian√ßas com clientes, pares, √°reas parceiras.',
                        'Implementa novas solu√ß√µes para atingir expectativas do cliente.',
                        'Direciona o time para conhecer as necessidades dos clientes.',
                        'Desenvolve a√ß√µes efetivas e de sucesso para os clientes.'
                    ]
                },
                {
                    nome: 'LIDERAN√áA E GEST√ÉO DE PESSOAS',
                    fatores: [
                        'Age com clareza na distribui√ß√£o dos pap√©is e responsabilidades.',
                        'Sabe identificar desafios compat√≠veis com a capacidade de cada um.',
                        'Estimula e conduz o time para que alcance/supere as metas.',
                        'Direciona o time com clareza para as atividades.',
                        'Orienta, d√° feedbacks efetivos e acompanha evolu√ß√µes.',
                        'Possui preocupa√ß√£o genu√≠na com as pessoas e desenvolve liderados.'
                    ]
                },
                {
                    nome: 'POSTURA DE DONO',
                    fatores: [
                        'Possui senso de urg√™ncia e sabe direcionar o time.',
                        'Assume responsabilidade e n√£o terceiriza para outras √°reas.',
                        '√â exemplo e estimula o time a ser inconformado com entregas.',
                        '√â atento √†s tend√™ncias de mercado e busca aplic√°-las.',
                        '√â atento e gerencia os desperd√≠cios e custos.'
                    ]
                }
            ],

            // =====================================================
            // FUN√á√ïES DE COMUNICA√á√ÉO COM SUPABASE - CORRIGIDAS
            // =====================================================
            async buscarTodosRegistros(tabela, filtros = {}) {
                console.log(`üì° Buscando TODOS os registros da tabela: ${tabela}...`);
                
                let todosRegistros = [];
                let offset = 0;
                const limit = 1000; // Limite por consulta
                let temMaisRegistros = true;
                
                const contadorEl = document.getElementById('contadorRegistros');
                if (contadorEl) {
                    contadorEl.style.display = 'block';
                    contadorEl.innerHTML = `<i class="fas fa-database"></i> Buscando registros de ${tabela}...`;
                }

                try {
                    while (temMaisRegistros) {
                        // Construir URL com pagina√ß√£o
                        let url = `${this.SUPABASE_URL}/rest/v1/${tabela}?select=*&limit=${limit}&offset=${offset}`;
                        
                        // Adicionar filtros se existirem
                        Object.keys(filtros).forEach(key => {
                            url += `&${key}=eq.${encodeURIComponent(filtros[key])}`;
                        });

                        console.log(`üîó Buscando registros ${offset + 1}-${offset + limit} de ${tabela}...`);
                        
                        if (contadorEl) {
                            contadorEl.innerHTML = `<i class="fas fa-database"></i> Buscando ${tabela}: ${todosRegistros.length} registros...`;
                        }

                        const response = await fetch(url, {
                            method: 'GET',
                            headers: {
                                'apikey': this.SUPABASE_KEY,
                                'Authorization': `Bearer ${this.SUPABASE_KEY}`,
                                'Content-Type': 'application/json',
                                'Prefer': 'return=representation'
                            }
                        });

                        if (!response.ok) {
                            const errorText = await response.text();
                            console.error(`‚ùå Erro HTTP ${response.status}:`, errorText);
                            throw new Error(`HTTP ${response.status}: ${response.statusText} - ${errorText}`);
                        }

                        const registros = await response.json();
                        todosRegistros = todosRegistros.concat(registros);
                        
                        // Verificar se h√° mais registros
                        temMaisRegistros = registros.length === limit;
                        offset += limit;
                        
                        console.log(`üìä Lote carregado: ${registros.length} registros. Total: ${todosRegistros.length}`);
                    }

                    if (contadorEl) {
                        contadorEl.innerHTML = `<i class="fas fa-check-circle"></i> ${tabela}: ${todosRegistros.length} registros carregados!`;
                        setTimeout(() => {
                            contadorEl.style.display = 'none';
                        }, 3000);
                    }

                    console.log(`‚úÖ TODOS os registros de ${tabela} carregados: ${todosRegistros.length} registros`);
                    
                    if (todosRegistros.length > 0) {
                        console.log(`üìã Exemplo dos dados recebidos:`, todosRegistros[0]);
                    }
                    
                    return todosRegistros;

                } catch (error) {
                    console.error(`‚ùå Erro ao buscar TODOS os registros de ${tabela}:`, error);
                    if (contadorEl) {
                        contadorEl.innerHTML = `<i class="fas fa-exclamation-circle"></i> Erro ao carregar ${tabela}`;
                        contadorEl.style.color = '#dc3545';
                    }
                    throw error;
                }
            },

            async buscarDoSupabase(tabela, filtros = {}) {
                // Esta fun√ß√£o agora chama a buscarTodosRegistros para garantir todos os dados
                return await this.buscarTodosRegistros(tabela, filtros);
            },

            async inserirNoSupabase(tabela, dados) {
                try {
                    console.log(`üì§ Inserindo dados na tabela: ${tabela}...`);
                    console.log(`üìã Dados a inserir:`, dados);

                    const response = await fetch(`${this.SUPABASE_URL}/rest/v1/${tabela}`, {
                        method: 'POST',
                        headers: {
                            'apikey': this.SUPABASE_KEY,
                            'Authorization': `Bearer ${this.SUPABASE_KEY}`,
                            'Content-Type': 'application/json',
                            'Prefer': 'return=representation'
                        },
                        body: JSON.stringify(dados)
                    });

                    if (!response.ok) {
                        const errorData = await response.text();
                        console.error(`‚ùå Erro na inser√ß√£o:`, errorData);
                        throw new Error(`HTTP ${response.status}: ${errorData}`);
                    }

                    const resultado = await response.json();
                    console.log('‚úÖ Dados inseridos com sucesso:', resultado);
                    return resultado;

                } catch (error) {
                    console.error('‚ùå Erro ao inserir:', error);
                    throw error;
                }
            },

            // =====================================================
            // CARREGAMENTO DE DADOS - CORRIGIDO
            // =====================================================
            async carregarDadosSalvos() {
                console.log('üìÇ Carregando TODOS os dados do Supabase (SEM LIMITE)...');
                
                try {
                    this.atualizarStatusDados('üîÑ Conectando ao Supabase e buscando TODOS os registros...', 'info');

                    // Carregar colaboradores - TODOS os registros
                    console.log('üë• Carregando TODOS os colaboradores...');
                    try {
                        const colaboradores = await this.buscarTodosRegistros('colaboradores');
                        this.dados.colaboradores = {};
                        
                        if (colaboradores && colaboradores.length > 0) {
                            colaboradores.forEach(colab => {
                                const matricula = String(colab.matr√≠cula || colab.matricula || '').trim();
                                if (matricula) {
                                    this.dados.colaboradores[matricula] = {
                                        nome: colab.nome || '',
                                        funcao: colab.fun√ß√£o || colab.funcao || '',
                                        filial: colab.filial || '',
                                        regional: colab.regional || ''
                                    };
                                }
                            });
                        }
                        
                        console.log(`üë• ${Object.keys(this.dados.colaboradores).length} colaboradores carregados (TODOS OS REGISTROS)`);
                        
                    } catch (error) {
                        console.warn('‚ö†Ô∏è Erro ao carregar colaboradores:', error);
                        this.dados.colaboradores = {};
                    }

                    // Carregar gestores - TODOS os registros
                    console.log('üëî Carregando TODOS os gestores...');
                    try {
                        const gestores = await this.buscarTodosRegistros('gestores');
                        this.dados.gestores = {};
                        
                        if (gestores && gestores.length > 0) {
                            gestores.forEach(gestor => {
                                const matricula = String(gestor.matr√≠cula || gestor.matricula || '').trim();
                                if (matricula) {
                                    this.dados.gestores[matricula] = {
                                        nome: gestor.nome || '',
                                        funcao: gestor.fun√ß√£o || gestor.funcao || '',
                                        regional: gestor.regional || ''
                                    };
                                }
                            });
                        }
                        
                        console.log(`üëî ${Object.keys(this.dados.gestores).length} gestores carregados (TODOS OS REGISTROS)`);
                        
                    } catch (error) {
                        console.warn('‚ö†Ô∏è Erro ao carregar gestores:', error);
                        this.dados.gestores = {};
                    }

                    // Carregar avalia√ß√µes - TODAS as avalia√ß√µes (NOME CORRIGIDO)
                    console.log('üìä Carregando TODAS as avalia√ß√µes...');
                    try {
                        // CORRE√á√ÉO: usar 'avaliacoes' (sem acento) conforme estrutura do banco
                        const avaliacoes = await this.buscarTodosRegistros('avaliacoes');
                        this.dados.avaliacoes = avaliacoes || [];
                        console.log(`üìä ${this.dados.avaliacoes.length} avalia√ß√µes carregadas (TODAS AS AVALIA√á√ïES)`);
                    } catch (error) {
                        console.warn('‚ö†Ô∏è Erro ao carregar avalia√ß√µes:', error);
                        this.dados.avaliacoes = [];
                    }

                    // Status final
                    const totalColaboradores = Object.keys(this.dados.colaboradores).length;
                    const totalGestores = Object.keys(this.dados.gestores).length;
                    const totalAvaliacoes = this.dados.avaliacoes.length;

                    console.log(`üìä RESUMO DOS DADOS CARREGADOS (SEM LIMITE):`);
                    console.log(`üë• Colaboradores: ${totalColaboradores}`);
                    console.log(`üëî Gestores: ${totalGestores}`);
                    console.log(`üìã Avalia√ß√µes: ${totalAvaliacoes}`);

                    // Atualizar cache
                    this.cache.ultimaAtualizacao = Date.now();
                    this.dados.dadosCarregados = true;
                    
                    try {
                        this.cache.colaboradores = this.dados.colaboradores;
                        this.cache.gestores = this.dados.gestores;
                        this.cache.avaliacoes = this.dados.avaliacoes;
                        localStorage.setItem('gg_cache_supabase', JSON.stringify(this.cache));
                        console.log('üíæ Cache atualizado no localStorage');
                    } catch (storageError) {
                        console.warn('‚ö†Ô∏è Erro ao salvar cache:', storageError);
                    }

                    if (totalColaboradores === 0 && totalGestores === 0) {
                        this.atualizarStatusDados('‚ö†Ô∏è Nenhum colaborador/gestor encontrado. Verifique as tabelas no Supabase.', 'warning');
                    } else {
                        this.atualizarStatusDados(`‚úÖ TODOS os dados carregados: ${totalColaboradores} colaboradores, ${totalGestores} gestores`, 'success');
                    }

                    this.atualizarStatusConexaoHome(true);

                } catch (error) {
                    console.error('‚ùå Erro ao carregar dados:', error);
                    this.carregarDadosDoCache();
                    this.atualizarStatusConexaoHome(false);
                    this.atualizarStatusDados(`‚ùå Erro: ${error.message}`, 'danger');
                }
            },

            carregarDadosDoCache() {
                try {
                    const cacheStorage = localStorage.getItem('gg_cache_supabase');
                    if (cacheStorage) {
                        const dadosCache = JSON.parse(cacheStorage);
                        this.cache = dadosCache;
                        this.dados.avaliacoes = dadosCache.avaliacoes || [];
                        this.dados.colaboradores = dadosCache.colaboradores || {};
                        this.dados.gestores = dadosCache.gestores || {};
                        this.dados.dadosCarregados = true;

                        const totalColabs = Object.keys(this.dados.colaboradores).length;
                        const totalGests = Object.keys(this.dados.gestores).length;
                        this.atualizarStatusDados(`‚ö†Ô∏è Usando dados em cache: ${totalColabs} colaboradores, ${totalGests} gestores`, 'warning');
                        console.log('üíæ Dados carregados do cache');
                    } else {
                        this.atualizarStatusDados('‚ùå Nenhum cache dispon√≠vel - Verifique a conex√£o com o Supabase', 'danger');
                    }
                } catch (error) {
                    console.error('‚ùå Erro no cache:', error);
                    this.atualizarStatusDados('‚ùå Erro ao carregar dados', 'danger');
                }
            },

            // =====================================================
            // BUSCA POR MATR√çCULA - CORRIGIDA
            // =====================================================
            buscarColaborador(matricula) {
                if (!matricula || matricula.trim() === '') {
                    this.limparCamposColaborador();
                    return;
                }

                const matriculaLimpa = String(matricula).trim();
                console.log(`üîç Buscando colaborador: "${matriculaLimpa}"`);

                const colaborador = this.dados.colaboradores[matriculaLimpa];
                
                if (colaborador) {
                    document.getElementById('nomeAvaliado').value = colaborador.nome || '';
                    document.getElementById('funcaoAvaliado').value = colaborador.funcao || '';
                    document.getElementById('filial').value = colaborador.filial || '';

                    const campo = document.getElementById('matriculaAvaliado');
                    campo.style.borderColor = 'var(--cor-secundaria)';
                    campo.style.backgroundColor = 'rgba(143, 214, 148, 0.1)';

                    this.mostrarAlerta(`‚úÖ Colaborador encontrado: ${colaborador.nome}`, 'success');
                    console.log(`‚úÖ Colaborador encontrado:`, colaborador);
                } else {
                    this.limparCamposColaborador();
                    const campo = document.getElementById('matriculaAvaliado');
                    campo.style.borderColor = '#dc3545';
                    campo.style.backgroundColor = 'rgba(220, 53, 69, 0.1)';

                    const sugestoes = this.buscarMatriculasSimilares(matriculaLimpa, Object.keys(this.dados.colaboradores));
                    let mensagem = `‚ùå Colaborador n√£o encontrado: ${matriculaLimpa}`;
                    
                    if (sugestoes.length > 0) {
                        mensagem += `\n\nüí° Sugest√µes: ${sugestoes.slice(0, 3).join(', ')}`;
                    }

                    this.mostrarAlerta(mensagem, 'warning');
                    console.log(`‚ùå Colaborador n√£o encontrado. Total dispon√≠vel: ${Object.keys(this.dados.colaboradores).length}`);
                }
            },

            buscarGestor(matricula) {
                if (!matricula || matricula.trim() === '') {
                    this.limparCamposGestor();
                    return;
                }

                const matriculaLimpa = String(matricula).trim();
                console.log(`üîç Buscando gestor: "${matriculaLimpa}"`);

                const gestor = this.dados.gestores[matriculaLimpa];
                
                if (gestor) {
                    document.getElementById('nomeGestor').value = gestor.nome || '';
                    document.getElementById('funcaoGestor').value = gestor.funcao || '';
                    document.getElementById('regionalGestor').value = gestor.regional || '';

                    const campo = document.getElementById('matriculaGestor');
                    campo.style.borderColor = 'var(--cor-secundaria)';
                    campo.style.backgroundColor = 'rgba(143, 214, 148, 0.1)';

                    this.mostrarAlerta(`‚úÖ Gestor encontrado: ${gestor.nome}`, 'success');
                    console.log(`‚úÖ Gestor encontrado:`, gestor);
                } else {
                    this.limparCamposGestor();
                    const campo = document.getElementById('matriculaGestor');
                    campo.style.borderColor = '#dc3545';
                    campo.style.backgroundColor = 'rgba(220, 53, 69, 0.1)';

                    const sugestoes = this.buscarMatriculasSimilares(matriculaLimpa, Object.keys(this.dados.gestores));
                    let mensagem = `‚ùå Gestor n√£o encontrado: ${matriculaLimpa}`;
                    
                    if (sugestoes.length > 0) {
                        mensagem += `\n\nüí° Sugest√µes: ${sugestoes.slice(0, 3).join(', ')}`;
                    }

                    this.mostrarAlerta(mensagem, 'warning');
                    console.log(`‚ùå Gestor n√£o encontrado. Total dispon√≠vel: ${Object.keys(this.dados.gestores).length}`);
                }
            },

            buscarMatriculasSimilares(matricula, lista) {
                const similares = [];
                lista.forEach(item => {
                    if (item.includes(matricula) || matricula.includes(item)) {
                        similares.push(item);
                    }
                });
                return similares;
            },

            limparCamposColaborador() {
                document.getElementById('nomeAvaliado').value = '';
                document.getElementById('funcaoAvaliado').value = '';
                document.getElementById('filial').value = '';
                const campo = document.getElementById('matriculaAvaliado');
                campo.style.borderColor = '#e0e0e0';
                campo.style.backgroundColor = '';
            },

            limparCamposGestor() {
                document.getElementById('nomeGestor').value = '';
                document.getElementById('funcaoGestor').value = '';
                document.getElementById('regionalGestor').value = '';
                const campo = document.getElementById('matriculaGestor');
                campo.style.borderColor = '#e0e0e0';
                campo.style.backgroundColor = '';
            },

            // =====================================================
            // AVALIA√á√ÉO - SALVAMENTO CORRIGIDO
            // =====================================================
            calcularResultado() {
                const fatoresAvaliados = this.atualizarProgresso();
                
                if (fatoresAvaliados === 0) {
                    this.mostrarAlerta('‚ùå Avalie pelo menos um fator!', 'danger');
                    return;
                }

                const radios = document.querySelectorAll('input[type="radio"]:checked');
                let somaNotas = 0;
                
                radios.forEach(radio => {
                    somaNotas += parseInt(radio.value);
                });

                const pontuacao = fatoresAvaliados > 0 ? (somaNotas / fatoresAvaliados) : 0;

                let classificacao = '';
                if (pontuacao >= 4.5) {
                    classificacao = 'EXCELENTE';
                } else if (pontuacao >= 3.5) {
                    classificacao = 'BOM';
                } else if (pontuacao >= 2.5) {
                    classificacao = 'REGULAR';
                } else {
                    classificacao = 'PRECISA MELHORAR';
                }

                document.getElementById('pontuacaoDisplay').textContent = pontuacao.toFixed(2) + '/5.00';
                document.getElementById('classificacaoDisplay').textContent = classificacao;

                const laudoResumo = this.gerarLaudoResumo(pontuacao, classificacao);
                document.getElementById('laudoResumo').innerHTML = laudoResumo;

                document.getElementById('resultadoCard').classList.add('show');

                const nomeAvaliado = document.getElementById('nomeAvaliado').value;
                const nomeGestor = document.getElementById('nomeGestor').value;
                const filial = document.getElementById('filial').value;

                const podeHabilitar = fatoresAvaliados >= 10 && nomeAvaliado && nomeGestor && filial;
                document.getElementById('btnSalvar').disabled = !podeHabilitar;

                this.dados.avaliacaoAtual = {
                    pontuacao: pontuacao,
                    classificacao: classificacao,
                    fatoresAvaliados: fatoresAvaliados,
                    respostas: this.coletarRespostas()
                };

                if (!podeHabilitar) {
                    let motivos = [];
                    if (fatoresAvaliados < 10) motivos.push('avalie pelo menos 10 fatores');
                    if (!nomeAvaliado) motivos.push('preencha dados do colaborador');
                    if (!nomeGestor) motivos.push('preencha dados do gestor');
                    this.mostrarAlerta(`‚ö†Ô∏è Para salvar: ${motivos.join(', ')}.`, 'warning');
                } else {
                    this.mostrarAlerta('‚úÖ Avalia√ß√£o pronta para ser salva!', 'success');
                }
            },

            coletarRespostas() {
                const respostas = {};
                const radios = document.querySelectorAll('input[type="radio"]:checked');
                radios.forEach(radio => {
                    respostas[radio.name] = radio.value;
                });
                return respostas;
            },

            gerarLaudoResumo(pontuacao, classificacao) {
                let resumo = '';
                if (pontuacao >= 4.5) {
                    resumo = '<strong style="color: var(--cor-primaria);"><i class="fas fa-star"></i> EXCELENTE DESEMPENHO!</strong><br>';
                    resumo += 'O(a) avaliado(a) demonstra compet√™ncias excepcionais em lideran√ßa.';
                } else if (pontuacao >= 3.5) {
                    resumo = '<strong style="color: var(--cor-primaria);"><i class="fas fa-thumbs-up"></i> BOM DESEMPENHO!</strong><br>';
                    resumo += 'O(a) avaliado(a) apresenta desempenho s√≥lido com oportunidades de desenvolvimento.';
                } else if (pontuacao >= 2.5) {
                    resumo = '<strong style="color: #ffc107;"><i class="fas fa-chart-line"></i> DESEMPENHO REGULAR</strong><br>';
                    resumo += '√â necess√°rio um plano de desenvolvimento estruturado.';
                } else {
                    resumo = '<strong style="color: #dc3545;"><i class="fas fa-book"></i> PRECISA MELHORAR</strong><br>';
                    resumo += 'Necess√°ria interven√ß√£o imediata com programa intensivo de desenvolvimento.';
                }
                return resumo;
            },

            async salvarAvaliacao() {
                if (!this.dados.avaliacaoAtual) {
                    this.mostrarAlerta('‚ùå Calcule o resultado primeiro!', 'danger');
                    return;
                }

                const nomeAvaliado = document.getElementById('nomeAvaliado').value;
                const nomeGestor = document.getElementById('nomeGestor').value;
                const filial = document.getElementById('filial').value;

                if (!nomeAvaliado || !nomeGestor || !filial) {
                    this.mostrarAlerta('‚ùå Preencha os campos obrigat√≥rios!', 'danger');
                    return;
                }

                // CORRE√á√ÉO: usar os nomes EXATOS das colunas da tabela avaliacoes
                const avaliacao = {
                    // Removido o campo 'id' pois √© auto increment
                    // Removido o campo 'auto increment data date' pois n√£o est√° claro na estrutura
                    nome_avaliado: nomeAvaliado,
                    matricula_avaliado: document.getElementById('matriculaAvaliado').value || '', // CORRIGIDO: era matr√≠cula_avaliada
                    nome_gestor: nomeGestor,
                    matricula_gestor: document.getElementById('matriculaGestor').value || '', // CORRIGIDO: era matr√≠cula_gestor
                    filial: filial,
                    pontuacao: this.dados.avaliacaoAtual.pontuacao,
                    classificacao: this.dados.avaliacaoAtual.classificacao,
                    comentarios: document.getElementById('comentarios').value || '',
                    created_at: new Date().toISOString() // ADICIONADO: timestamp de cria√ß√£o
                };

                try {
                    this.mostrarLoading(true);
                    
                    console.log('üíæ Salvando avalia√ß√£o com estrutura corrigida:', avaliacao);
                    
                    // CORRE√á√ÉO: usar 'avaliacoes' (sem acento) conforme estrutura do banco
                    const resultado = await this.inserirNoSupabase('avaliacoes', avaliacao);
                    
                    if (resultado) {
                        this.dados.avaliacoes.push(avaliacao);
                        this.cache.avaliacoes = this.dados.avaliacoes;
                        
                        try {
                            localStorage.setItem('gg_cache_supabase', JSON.stringify(this.cache));
                        } catch (storageError) {
                            console.warn('‚ö†Ô∏è Erro ao atualizar cache:', storageError);
                        }

                        this.mostrarAlerta(`‚úÖ Avalia√ß√£o salva no Supabase com estrutura correta!`, 'success');
                        
                        document.getElementById('btnSalvar').innerHTML = '<i class="fas fa-check"></i> Salvo!';
                        document.getElementById('btnSalvar').disabled = true;
                        
                        setTimeout(() => {
                            document.getElementById('btnSalvar').innerHTML = '<i class="fas fa-save"></i> Salvar no Supabase';
                        }, 3000);
                    }
                } catch (error) {
                    console.error('‚ùå Erro ao salvar:', error);
                    this.mostrarAlerta('‚ùå Erro ao salvar: ' + error.message, 'danger');
                } finally {
                    this.mostrarLoading(false);
                }
            },

            // =====================================================
            // INTERFACE
            // =====================================================
            showSection(sectionId) {
                document.querySelectorAll('.section').forEach(section => {
                    section.classList.remove('active');
                });
                document.querySelectorAll('.nav-btn').forEach(btn => {
                    btn.classList.remove('active');
                });

                document.getElementById(sectionId).classList.add('active');

                const botoes = document.querySelectorAll('.nav-btn');
                botoes.forEach(btn => {
                    if ((sectionId === 'home' && btn.textContent.includes('Home')) ||
                        (sectionId === 'avaliacao' && btn.textContent.includes('Nova')) ||
                        (sectionId === 'historico' && btn.textContent.includes('Hist√≥rico')) ||
                        (sectionId === 'configuracoes' && btn.textContent.includes('Configura√ß√µes'))) {
                        btn.classList.add('active');
                    }
                });

                switch(sectionId) {
                    case 'home':
                        this.atualizarEstatisticasHome();
                        this.criarGraficoPerformance();
                        break;
                    case 'avaliacao':
                        this.inicializarFormularioAvaliacao();
                        break;
                    case 'historico':
                        if (this.acesso.tipo) {
                            this.carregarHistorico();
                        }
                        break;
                    case 'configuracoes':
                        if (this.acesso.tipo === 'admin') {
                            this.atualizarEstatisticasConfig();
                        }
                        break;
                }
            },

            inicializarFormularioAvaliacao() {
                this.criarFormularioCompetencias();
                this.atualizarProgresso();
                if (!this.dados.dadosCarregados) {
                    this.carregarDadosSalvos();
                }
            },

            criarFormularioCompetencias() {
                const container = document.getElementById('competenciasContainer');
                let html = '';
                let fatorIndex = 0;

                this.COMPETENCIAS.forEach((competencia) => {
                    html += '<div class="competencia-card">';
                    html += '<div class="competencia-header">' + competencia.nome + '</div>';
                    
                    competencia.fatores.forEach((fator) => {
                        html += '<div class="fator-item">';
                        html += '<div class="fator-texto">' + fator + '</div>';
                        html += '<div class="rating-container">';
                        html += '<span class="rating-label">Inadequado</span>';
                        
                        for(let i = 1; i <= 5; i++) {
                            html += '<label class="rating-option">';
                            html += '<input type="radio" name="fator_' + fatorIndex + '" value="' + i + '" onchange="GG.atualizarProgresso()">';
                            html += '<span>' + i + '</span>';
                            html += '</label>';
                        }
                        
                        html += '<span class="rating-label">Excelente</span>';
                        html += '</div>';
                        html += '</div>';
                        fatorIndex++;
                    });
                    
                    html += '</div>';
                });

                container.innerHTML = html;
            },

            atualizarProgresso() {
                const totalFatores = 31;
                const fatoresAvaliados = document.querySelectorAll('input[type="radio"]:checked').length;
                const porcentagem = (fatoresAvaliados / totalFatores) * 100;

                document.getElementById('progressFill').style.width = porcentagem + '%';
                document.getElementById('progressText').textContent = fatoresAvaliados + ' de ' + totalFatores + ' fatores avaliados';

                return fatoresAvaliados;
            },

            limparFormulario() {
                if (confirm('üóëÔ∏è Limpar todos os dados do formul√°rio?')) {
                    document.getElementById('nomeAvaliado').value = '';
                    document.getElementById('matriculaAvaliado').value = '';
                    document.getElementById('funcaoAvaliado').value = '';
                    document.getElementById('nomeGestor').value = '';
                    document.getElementById('matriculaGestor').value = '';
                    document.getElementById('funcaoGestor').value = '';
                    document.getElementById('filial').value = '';
                    document.getElementById('regionalGestor').value = '';
                    document.getElementById('pontosFortes').value = '';
                    document.getElementById('oportunidades').value = '';
                    document.getElementById('comentarios').value = '';

                    document.querySelectorAll('input[type="radio"]').forEach(radio => {
                        radio.checked = false;
                    });

                    document.getElementById('resultadoCard').classList.remove('show');
                    document.getElementById('btnSalvar').disabled = true;

                    this.limparCamposColaborador();
                    this.limparCamposGestor();
                    this.atualizarProgresso();
                    this.dados.avaliacaoAtual = null;

                    this.mostrarAlerta('üóëÔ∏è Formul√°rio limpo!', 'info');
                }
            },

            // =====================================================
            // ACESSO E AUTENTICA√á√ÉO
            // =====================================================
            acessoHistorico() {
                this.acesso = { tipo: null, senha: null, filial: null, permissoes: [] };
                this.showSection('loginHistorico');
            },

            acessoConfiguracoes() {
                this.acesso = { tipo: null, senha: null, filial: null, permissoes: [] };
                this.showSection('loginConfiguracoes');
            },

            validarSenhaHistorico() {
                const senha = document.getElementById('senhaHistorico').value.trim().toUpperCase();
                
                if (!senha) {
                    this.mostrarAlerta('‚ùå Digite uma senha!', 'danger');
                    return;
                }

                if (this.SENHAS_ESPECIAIS[senha]) {
                    const tipoAcesso = this.SENHAS_ESPECIAIS[senha].tipo;
                    this.acesso = {
                        tipo: tipoAcesso,
                        senha: senha,
                        filial: tipoAcesso === 'master' ? 'TODAS' : null,
                        permissoes: tipoAcesso === 'admin' ? ['historico', 'configuracoes'] : ['historico']
                    };
                    this.exibirStatusAcesso('historico');
                    this.showSection('historico');
                    this.mostrarAlerta(`‚úÖ Acesso liberado: ${this.SENHAS_ESPECIAIS[senha].descricao}`, 'success');
                    return;
                }

                if (this.SENHAS_FILIAIS[senha]) {
                    const dadosFilial = this.SENHAS_FILIAIS[senha];
                    this.acesso = {
                        tipo: 'filial',
                        senha: senha,
                        filial: dadosFilial.filial,
                        regional: dadosFilial.regional,
                        permissoes: ['historico']
                    };
                    this.exibirStatusAcesso('historico');
                    this.showSection('historico');
                    this.mostrarAlerta(`‚úÖ Acesso liberado para Filial ${dadosFilial.filial} - ${dadosFilial.regional}`, 'success');
                    return;
                }

                this.mostrarAlerta('‚ùå Senha inv√°lida!', 'danger');
            },

            validarSenhaConfiguracoes() {
                const senha = document.getElementById('senhaConfiguracoes').value.trim().toUpperCase();
                
                if (senha !== 'GGMASTERJP') {
                    this.mostrarAlerta('‚ùå Senha incorreta!', 'danger');
                    return;
                }

                this.acesso = {
                    tipo: 'admin',
                    senha: senha,
                    filial: null,
                    permissoes: ['historico', 'configuracoes']
                };
                this.exibirStatusAcesso('configuracoes');
                this.showSection('configuracoes');
                this.mostrarAlerta('‚úÖ Acesso administrativo liberado!', 'success');
            },

            exibirStatusAcesso(secao) {
                const statusElement = document.getElementById(secao === 'historico' ? 'accessStatus' : 'configStatus');
                if (!statusElement) return;

                let statusText = '';
                switch(this.acesso.tipo) {
                    case 'admin':
                        statusText = `üîê ADMINISTRADOR | Acesso Total | ${this.acesso.senha}`;
                        break;
                    case 'master':
                        statusText = `üîë MASTER | Todas as Filiais | ${this.acesso.senha}`;
                        break;
                    case 'filial':
                        statusText = `üè¢ FILIAL ${this.acesso.filial} - ${this.acesso.regional} | ${this.acesso.senha}`;
                        break;
                    default:
                        statusText = '‚ùå Acesso n√£o autorizado';
                }

                statusElement.innerHTML = statusText;
                statusElement.style.display = 'block';
            },

            verificarEnter(event, tipo) {
                if (event.key === 'Enter') {
                    if (tipo === 'historico') {
                        this.validarSenhaHistorico();
                    } else if (tipo === 'configuracoes') {
                        this.validarSenhaConfiguracoes();
                    }
                }
            },

            logout() {
                this.acesso = { tipo: null, senha: null, filial: null, permissoes: [] };
                document.getElementById('senhaHistorico').value = '';
                document.getElementById('senhaConfiguracoes').value = '';
                document.getElementById('accessStatus').style.display = 'none';
                document.getElementById('configStatus').style.display = 'none';
                this.showSection('home');
                this.mostrarAlerta('üö™ Sess√£o encerrada!', 'info');
            },

            filtrarDadosPorAcesso(dados) {
                if (!this.acesso.tipo || this.acesso.tipo === 'admin' || this.acesso.tipo === 'master') {
                    return dados;
                }

                if (this.acesso.tipo === 'filial' && this.acesso.filial) {
                    return dados.filter(item => item.filial === this.acesso.filial);
                }

                return [];
            },

            // =====================================================
            // HIST√ìRICO
            // =====================================================
            async carregarHistorico() {
                console.log('üìã Carregando hist√≥rico...');
                
                try {
                    this.mostrarLoading(true);
                    await this.carregarDadosSalvos();

                    const avaliacoesFiltradas = this.filtrarDadosPorAcesso(this.dados.avaliacoes);
                    this.atualizarEstatisticasHistorico(avaliacoesFiltradas);
                    this.atualizarTabelaHistorico(avaliacoesFiltradas);
                    this.criarGraficoHistorico(avaliacoesFiltradas);

                    const tipoAcesso = this.acesso.tipo === 'filial' ? `da Filial ${this.acesso.filial}` : 'completo';
                    this.mostrarAlerta(`‚úÖ Hist√≥rico ${tipoAcesso} carregado!`, 'success');
                } catch (error) {
                    console.error('‚ùå Erro no hist√≥rico:', error);
                    this.mostrarAlerta('‚ùå Erro ao carregar hist√≥rico: ' + error.message, 'danger');
                } finally {
                    this.mostrarLoading(false);
                }
            },

            atualizarEstatisticasHistorico(dadosHistorico) {
                const dados = dadosHistorico || this.filtrarDadosPorAcesso(this.dados.avaliacoes);
                const total = dados.length;
                let somaNotas = 0;
                let excelentes = 0;
                let precisamMelhorar = 0;

                dados.forEach(av => {
                    const nota = parseFloat(av.pontuacao || av.pontuacao);
                    somaNotas += nota;
                    if (av.classificacao === 'EXCELENTE') excelentes++;
                    if (av.classificacao === 'PRECISA MELHORAR') precisamMelhorar++;
                });

                const media = total > 0 ? (somaNotas / total).toFixed(2) : '0.00';

                this.animarNumero('totalAvaliacoes', total);
                this.animarNumero('mediaGeral', parseFloat(media));
                this.animarNumero('excelentes', excelentes);
                this.animarNumero('precisamMelhorar', precisamMelhorar);
            },

            atualizarTabelaHistorico(dadosHistorico) {
                const container = document.getElementById('tabelaHistorico');
                const dados = dadosHistorico || this.filtrarDadosPorAcesso(this.dados.avaliacoes);

                if (dados.length === 0) {
                    const mensagem = this.acesso.tipo === 'filial' ? 
                        `üì≠ Nenhuma avalia√ß√£o da Filial ${this.acesso.filial}` : 
                        'üì≠ Nenhuma avalia√ß√£o encontrada';
                    container.innerHTML = `<p style="text-align: center; padding: 30px;">${mensagem}</p>`;
                    return;
                }

                let html = '<table class="tabela-historico">';
                html += '<thead><tr>';
                html += '<th>Data</th><th>Avaliado</th><th>Gestor</th><th>Filial</th><th>Pontua√ß√£o</th><th>Classifica√ß√£o</th>';
                html += '</tr></thead><tbody>';

                dados.forEach(av => {
                    const data = new Date(av.created_at || av.criado_em).toLocaleDateString('pt-BR');
                    html += '<tr>';
                    html += '<td>' + data + '</td>';
                    html += '<td>' + (av.nome_avaliado || av.nomeAvaliado) + '</td>';
                    html += '<td>' + (av.nome_gestor || av.nomeGestor) + '</td>';
                    html += '<td>' + av.filial + '</td>';
                    html += '<td><strong>' + av.pontuacao + '</strong></td>';
                    html += '<td>' + av.classificacao + '</td>';
                    html += '</tr>';
                });

                html += '</tbody></table>';
                container.innerHTML = html;
            },

            exportarDados() {
                const dadosFiltrados = this.filtrarDadosPorAcesso(this.dados.avaliacoes);
                
                if (dadosFiltrados.length === 0) {
                    this.mostrarAlerta('‚ùå Nenhuma avalia√ß√£o para exportar!', 'danger');
                    return;
                }

                let csv = 'Data,Avaliado,Matricula,Funcao,Gestor,Filial,Pontuacao,Classificacao\n';
                
                dadosFiltrados.forEach(av => {
                    const linha = [
                        new Date(av.created_at || av.criado_em).toLocaleDateString('pt-BR'),
                        av.nome_avaliado || av.nomeAvaliado,
                        av.matricula_avaliado || av.matricula || '',
                        av.funcao_avaliado || av.funcaoAvaliado || '',
                        av.nome_gestor || av.nomeGestor,
                        av.filial,
                        av.pontuacao,
                        av.classificacao
                    ].join(',');
                    csv += linha + '\n';
                });

                const blob = new Blob([csv], { type: 'text/csv' });
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                
                const nomeArquivo = this.acesso.tipo === 'filial' ? 
                    `avaliacoes_filial_${this.acesso.filial}_${new Date().toISOString().split('T')[0]}.csv` :
                    `avaliacoes_gg_${new Date().toISOString().split('T')[0]}.csv`;
                
                a.download = nomeArquivo;
                a.click();
                window.URL.revokeObjectURL(url);

                this.mostrarAlerta('üì• Dados exportados!', 'success');
            },

            // =====================================================
            // CONFIGURA√á√ïES
            // =====================================================
            async testarConexao() {
                try {
                    this.mostrarLoading(true);
                    
                    const response = await fetch(`${this.SUPABASE_URL}/rest/v1/colaboradores?select=count`, {
                        method: 'HEAD',
                        headers: {
                            'apikey': this.SUPABASE_KEY,
                            'Authorization': `Bearer ${this.SUPABASE_KEY}`
                        }
                    });

                    if (response.ok) {
                        let mensagem = '‚úÖ Conex√£o com Supabase funcionando!\n\n';
                        mensagem += `üîó URL: ${this.SUPABASE_URL}\n`;
                        mensagem += `üîë Token: V√°lido\n`;
                        mensagem += `üìä Status: ${response.status}\n`;
                        mensagem += `üîÑ Busca SEM LIMITE: Habilitada\n`;
                        mensagem += `üïê Timestamp: ${new Date().toLocaleString('pt-BR')}`;

                        this.mostrarAlerta(mensagem, 'success');
                        this.atualizarStatusConexaoHome(true);

                        const statusEl = document.getElementById('supabaseStatus');
                        if (statusEl) {
                            statusEl.textContent = 'Conectado ‚úÖ (SEM LIMITE)';
                            statusEl.style.color = 'var(--cor-primaria)';
                        }
                    } else {
                        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                    }
                } catch (error) {
                    console.error('‚ùå Erro no teste:', error);
                    
                    let mensagemErro = '‚ùå Erro na conex√£o com Supabase:\n\n';
                    if (error.message.includes('Failed to fetch')) {
                        mensagemErro += '‚Ä¢ Verifique a URL do Supabase\n';
                        mensagemErro += '‚Ä¢ Verifique o token de acesso\n';
                        mensagemErro += '‚Ä¢ Verifique as configura√ß√µes de CORS';
                    } else {
                        mensagemErro += error.message;
                    }

                    this.mostrarAlerta(mensagemErro, 'danger');
                    this.atualizarStatusConexaoHome(false);

                    const statusEl = document.getElementById('supabaseStatus');
                    if (statusEl) {
                        statusEl.textContent = 'Erro de conex√£o ‚ùå';
                        statusEl.style.color = '#dc3545';
                    }
                } finally {
                    this.mostrarLoading(false);
                }
            },

            async sincronizarDados() {
                try {
                    this.mostrarLoading(true);
                    this.dados.dadosCarregados = false;
                    this.cache.ultimaAtualizacao = null;
                    
                    await this.carregarDadosSalvos();
                    this.atualizarEstatisticasHome();
                    this.atualizarEstatisticasConfig();
                    
                    this.mostrarAlerta('‚úÖ Sincroniza√ß√£o completa (TODOS OS REGISTROS)!', 'success');
                } catch (error) {
                    this.mostrarAlerta('‚ùå Erro na sincroniza√ß√£o: ' + error.message, 'danger');
                } finally {
                    this.mostrarLoading(false);
                }
            },

            async debugCompleto() {
                try {
                    this.mostrarLoading(true);
                    
                    let debug = `üîç DEBUG COMPLETO DO SISTEMA G&G v4.0 - CORRIGIDO\n`;
                    debug += `================================================================\n\n`;
                    debug += `üîó SUPABASE URL: ${this.SUPABASE_URL}\n`;
                    debug += `üîë TOKEN: ${this.SUPABASE_KEY.substring(0, 50)}...\n`;
                    debug += `üîÑ BUSCA SEM LIMITE: ATIVADA\n\n`;

                    // Testar tabelas com busca sem limite
                    const tabelas = ['colaboradores', 'gestores', 'avaliacoes']; // CORRE√á√ÉO: avaliacoes sem acento
                    for (const tabela of tabelas) {
                        try {
                            const dados = await this.buscarTodosRegistros(tabela);
                            debug += `üìä TABELA ${tabela.toUpperCase()}:\n`;
                            debug += ` ‚úÖ Acess√≠vel (SEM LIMITE DE 1000)\n`;
                            debug += ` üìà ${dados.length} registros TOTAIS\n`;
                            if (dados.length > 0) {
                                debug += ` üìã Colunas: ${Object.keys(dados[0]).join(', ')}\n`;
                                debug += ` üìù Exemplo: ${JSON.stringify(dados[0], null, 2).substring(0, 200)}...\n`;
                            }
                            debug += `\n`;
                        } catch (error) {
                            debug += `üìä TABELA ${tabela.toUpperCase()}:\n`;
                            debug += ` ‚ùå Erro: ${error.message}\n\n`;
                        }
                    }

                    debug += `üíæ CACHE LOCAL:\n`;
                    debug += ` üïê √öltima sync: ${this.cache.ultimaAtualizacao ? new Date(this.cache.ultimaAtualizacao).toLocaleString() : 'Nunca'}\n`;
                    debug += ` üìä Dados carregados: ${this.dados.dadosCarregados}\n`;
                    debug += ` üë• Colaboradores em cache: ${Object.keys(this.dados.colaboradores).length}\n`;
                    debug += ` üëî Gestores em cache: ${Object.keys(this.dados.gestores).length}\n`;
                    debug += ` üìã Avalia√ß√µes em cache: ${this.dados.avaliacoes.length}\n\n`;

                    debug += `üîê ACESSO ATUAL:\n`;
                    debug += ` Tipo: ${this.acesso.tipo || 'Nenhum'}\n`;
                    debug += ` Filial: ${this.acesso.filial || 'N/A'}\n`;
                    debug += ` Permiss√µes: ${this.acesso.permissoes.join(', ') || 'Nenhuma'}\n\n`;

                    debug += `üåê INFORMA√á√ïES DO SISTEMA:\n`;
                    debug += ` Vers√£o: 4.0 - SUPABASE CORRIGIDO COMPLETO\n`;
                    debug += ` Corre√ß√µes: Busca sem limite + Salvamento corrigido\n`;
                    debug += ` Timestamp: ${new Date().toLocaleString('pt-BR')}\n`;

                    const container = document.getElementById('debugContainer');
                    const infoDiv = document.getElementById('debugInfo');
                    infoDiv.textContent = debug;
                    container.style.display = 'block';

                    this.mostrarAlerta('‚úÖ Debug completo executado!', 'success');
                } catch (error) {
                    this.mostrarAlerta('‚ùå Erro no debug: ' + error.message, 'danger');
                } finally {
                    this.mostrarLoading(false);
                }
            },

            debugSistema() {
                let debug = 'üîç DEBUG DO SISTEMA G&G v4.0 - CORRIGIDO\n';
                debug += '================================================\n\n';
                debug += `üîó Supabase URL: ${this.SUPABASE_URL}\n`;
                debug += `üìä Dados carregados: ${this.dados.dadosCarregados}\n`;
                debug += `üîÑ Busca sem limite: ATIVADA\n`;
                debug += `üë• Colaboradores: ${Object.keys(this.dados.colaboradores).length}\n`;
                debug += `üëî Gestores: ${Object.keys(this.dados.gestores).length}\n`;
                debug += `üìã Avalia√ß√µes: ${this.dados.avaliacoes.length}\n`;
                debug += `üíæ Cache v√°lido: ${this.cache.ultimaAtualizacao ? 'Sim' : 'N√£o'}\n`;
                debug += `üïê √öltima sync: ${this.cache.ultimaAtualizacao ? new Date(this.cache.ultimaAtualizacao).toLocaleString() : 'Nunca'}\n`;
                debug += `üîê Acesso atual: ${this.acesso.tipo || 'Nenhum'}\n`;
                debug += `üåê Vers√£o: 4.0 - SUPABASE CORRIGIDO COMPLETO\n`;
                debug += `‚úÖ Corre√ß√µes: Todos os registros + Salvamento funcionando\n`;

                if (Object.keys(this.dados.colaboradores).length > 0) {
                    debug += `\nüìã Matr√≠culas Colaboradores: ${Object.keys(this.dados.colaboradores).slice(0, 5).join(', ')}...\n`;
                }
                if (Object.keys(this.dados.gestores).length > 0) {
                    debug += `üìã Matr√≠culas Gestores: ${Object.keys(this.dados.gestores).slice(0, 5).join(', ')}...\n`;
                }

                alert(debug);
                console.log('üîç Debug do sistema:', this);
            },

            // =====================================================
            // ESTAT√çSTICAS E GR√ÅFICOS
            // =====================================================
            atualizarEstatisticasHome() {
                const total = this.dados.avaliacoes.length;
                let somaNotas = 0;
                
                this.dados.avaliacoes.forEach(av => {
                    somaNotas += parseFloat(av.pontuacao || av.pontuacao);
                });

                const media = total > 0 ? (somaNotas / total).toFixed(2) : '0.00';

                this.animarNumero('totalAvaliacoesHome', total);
                this.animarNumero('mediaGeralHome', parseFloat(media));
                this.animarNumero('totalColaboradoresHome', Object.keys(this.dados.colaboradores).length);
                this.animarNumero('totalGestoresHome', Object.keys(this.dados.gestores).length);
            },

            atualizarEstatisticasConfig() {
                const totalColabs = Object.keys(this.dados.colaboradores).length;
                const totalGests = Object.keys(this.dados.gestores).length;
                const totalAvs = this.dados.avaliacoes.length;

                this.animarNumero('totalColaboradoresConfig', totalColabs);
                this.animarNumero('totalGestoresConfig', totalGests);
                this.animarNumero('totalAvaliacoesConfig', totalAvs);

                const statusEl = document.getElementById('statusSincronizacao');
                if (statusEl) {
                    if (this.dados.dadosCarregados) {
                        statusEl.textContent = 'OK';
                        statusEl.style.color = 'var(--cor-primaria)';
                    } else {
                        statusEl.textContent = 'ERRO';
                        statusEl.style.color = '#dc3545';
                    }
                }
            },

            criarGraficoPerformance() {
                const ctx = document.getElementById('graficoPerformance');
                if (!ctx || this.dados.avaliacoes.length === 0) return;

                const classificacoes = {
                    'EXCELENTE': 0,
                    'BOM': 0,
                    'REGULAR': 0,
                    'PRECISA MELHORAR': 0
                };

                this.dados.avaliacoes.forEach(av => {
                    classificacoes[av.classificacao]++;
                });

                if (window.graficoPerformanceChart) {
                    window.graficoPerformanceChart.destroy();
                }

                window.graficoPerformanceChart = new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels: Object.keys(classificacoes),
                        datasets: [{
                            data: Object.values(classificacoes),
                            backgroundColor: [
                                '#28a745',
                                '#17a2b8',
                                '#ffc107',
                                '#dc3545'
                            ]
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'bottom'
                            },
                            title: {
                                display: true,
                                text: 'Distribui√ß√£o das Avalia√ß√µes'
                            }
                        }
                    }
                });
            },

            criarGraficoHistorico(dados) {
                const ctx = document.getElementById('graficoHistorico');
                if (!ctx || dados.length === 0) return;

                // Agrupar por m√™s
                const porMes = {};
                dados.forEach(av => {
                    const data = new Date(av.created_at || av.criado_em);
                    const mes = data.toLocaleDateString('pt-BR', { month: 'short', year: 'numeric' });
                    if (!porMes[mes]) {
                        porMes[mes] = { total: 0, soma: 0 };
                    }
                    porMes[mes].total++;
                    porMes[mes].soma += parseFloat(av.pontuacao || av.pontuacao);
                });

                const meses = Object.keys(porMes).sort();
                const medias = meses.map(mes => (porMes[mes].soma / porMes[mes].total).toFixed(2));

                if (window.graficoHistoricoChart) {
                    window.graficoHistoricoChart.destroy();
                }

                window.graficoHistoricoChart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: meses,
                        datasets: [{
                            label: 'M√©dia Mensal',
                            data: medias,
                            borderColor: '#28a745',
                            backgroundColor: 'rgba(40, 167, 69, 0.1)',
                            tension: 0.4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            title: {
                                display: true,
                                text: 'Evolu√ß√£o das Avalia√ß√µes por M√™s'
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                max: 5
                            }
                        }
                    }
                });
            },

            // =====================================================
            // FUN√á√ïES AUXILIARES
            // =====================================================
            atualizarStatusDados(mensagem, tipo) {
                const statusEl = document.getElementById('statusDados');
                if (statusEl) {
                    statusEl.className = `alert alert-${tipo}`;
                    statusEl.innerHTML = `<p><strong>${mensagem}</strong></p>`;
                }
            },

            atualizarStatusConexaoHome(conectado) {
                const statusEl = document.getElementById('statusConexaoHome');
                const textoEl = document.getElementById('textoStatus');
                
                if (statusEl && textoEl) {
                    if (conectado) {
                        statusEl.className = 'status-conexao status-conectado';
                        textoEl.innerHTML = '<i class="fas fa-check-circle"></i> Conectado ao Supabase - SEM LIMITE DE REGISTROS';
                    } else {
                        statusEl.className = 'status-conexao status-desconectado';
                        textoEl.innerHTML = '<i class="fas fa-exclamation-circle"></i> Sem conex√£o - Verifique o Supabase';
                    }
                }
            },

            animarNumero(elementId, valorFinal, duracao = 1000) {
                const elemento = document.getElementById(elementId);
                if (!elemento) return;

                const valorInicial = parseFloat(elemento.textContent) || 0;
                const inicio = performance.now();

                const animar = (tempoAtual) => {
                    const decorrido = tempoAtual - inicio;
                    const progresso = Math.min(decorrido / duracao, 1);
                    const progressoSuave = 1 - Math.pow(1 - progresso, 3);
                    const valorAtual = valorInicial + (valorFinal - valorInicial) * progressoSuave;

                    if (elementId.includes('media') || elementId.includes('Media')) {
                        elemento.textContent = valorAtual.toFixed(2);
                    } else {
                        elemento.textContent = Math.round(valorAtual);
                    }

                    if (progresso < 1) {
                        requestAnimationFrame(animar);
                    }
                };

                requestAnimationFrame(animar);
            },

            mostrarAlerta(mensagem, tipo) {
                const alertasExistentes = document.querySelectorAll('.alert');
                alertasExistentes.forEach(alerta => {
                    if (!alerta.id || alerta.id !== 'statusDados') {
                        alerta.remove();
                    }
                });

                const alerta = document.createElement('div');
                alerta.className = 'alert alert-' + tipo;
                alerta.innerHTML = mensagem.replace(/\n/g, '<br>');

                const secaoAtiva = document.querySelector('.section.active');
                secaoAtiva.insertBefore(alerta, secaoAtiva.firstChild);

                setTimeout(() => {
                    if (alerta.parentNode) {
                        alerta.remove();
                    }
                }, 5000);
            },

            mostrarLoading(mostrar) {
                const loading = document.getElementById('loading');
                if (loading) {
                    loading.style.display = mostrar ? 'block' : 'none';
                }
            },

            // =====================================================
            // INICIALIZA√á√ÉO
            // =====================================================
            async init() {
                console.log('üöÄ Iniciando Sistema G&G v4.0 - Supabase CORRIGIDO COMPLETO...');
                
                try {
                    // Tentar carregar cache
                    try {
                        const cacheStorage = localStorage.getItem('gg_cache_supabase');
                        if (cacheStorage) {
                            const dadosCache = JSON.parse(cacheStorage);
                            this.cache = dadosCache;
                            this.dados.avaliacoes = dadosCache.avaliacoes || [];
                            this.dados.colaboradores = dadosCache.colaboradores || {};
                            this.dados.gestores = dadosCache.gestores || {};
                            console.log('üíæ Cache carregado');
                        }
                    } catch (error) {
                        console.warn('‚ö†Ô∏è Erro no cache:', error);
                    }

                    // Carregar TODOS os dados do Supabase (sem limite)
                    console.log('üîó Carregando TODOS os dados do Supabase (SEM LIMITE)...');
                    await this.carregarDadosSalvos();

                    // Inicializar interface
                    this.atualizarEstatisticasHome();

                    console.log('‚úÖ Sistema G&G v4.0 inicializado com Supabase CORRIGIDO COMPLETO!');
                    console.log('üìä Registros sem limite de 1000 ‚úÖ');
                    console.log('üíæ Salvamento de avalia√ß√µes corrigido ‚úÖ');
                } catch (error) {
                    console.error('‚ùå Erro na inicializa√ß√£o:', error);
                    this.atualizarStatusConexaoHome(false);
                    this.atualizarEstatisticasHome();
                    setTimeout(() => {
                        this.mostrarAlerta('‚ùå Erro na inicializa√ß√£o: ' + error.message, 'danger');
                    }, 2000);
                }
            }
        };

        // =====================================================
        // INICIALIZA√á√ÉO DO SISTEMA
        // =====================================================
        document.addEventListener('DOMContentLoaded', function() {
            GG.init();
        });

        // Exposi√ß√£o global para debug
        window.sistemaGG = GG;

        console.log(`
üéØ SISTEMA G&G v4.0 - SUPABASE CORRIGIDO COMPLETO!
=====================================================================
üîó URL SUPABASE: https://mtqwqwpqkzrbkxxkaffq.supabase.co
‚úÖ BUSCA SEM LIMITE: Busca TODOS os registros (n√£o apenas 1000)
‚úÖ SALVAMENTO CORRIGIDO: Estrutura da tabela 'avaliacoes' ajustada
‚úÖ NOMES CORRETOS: Colunas matricula_avaliado, matricula_gestor
‚úÖ API REST otimizada com pagina√ß√£o autom√°tica
‚úÖ Interface responsiva otimizada para PDF
‚úÖ Gr√°ficos interativos

üîß PRINCIPAIS CORRE√á√ïES IMPLEMENTADAS:
‚Ä¢ Fun√ß√£o buscarTodosRegistros() para pagina√ß√£o autom√°tica
‚Ä¢ Tabela 'avaliacoes' (sem acento) conforme banco real
‚Ä¢ Colunas matricula_avaliado e matricula_gestor corrigidas
‚Ä¢ Cache otimizado para grandes volumes de dados
‚Ä¢ Contadores visuais durante carregamento

üè¢ FILIAIS CADASTRADAS:
743-MS | 264-SC | 753-MT | 364-DF | 713-SP

üíª DESENVOLVIDO POR: Juliano Patrick
üìß CONTATO: julianocorrea@bateforte.com.br
=====================================================================
üöÄ SISTEMA 100% OPERACIONAL! Digite uma matr√≠cula para testar!
        `);
    </script>
</body>
</html>
