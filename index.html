<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üéØ Sistema de Avalia√ß√£o de Desempenho - G&G v3.1</title>
    <style>
        :root {
            --cor-primaria: #1e441e;     
            --cor-secundaria: #8FD694;   
            --cor-acento: #77AD78;       
            --cor-neutra: #6F8F72;       
            --cor-escura: #504B43;       
            --cor-clara: #F8FAF9;
            --cor-branca: #FFFFFF;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            background: var(--cor-clara); 
            line-height: 1.6;
            color: var(--cor-escura);
            animation: fadeIn 0.5s ease-out;
        }

        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes slideInUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes slideInDown { from { opacity: 0; transform: translateY(-20px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes slideInLeft { from { opacity: 0; transform: translateX(-20px); } to { opacity: 1; transform: translateX(0); } }
        @keyframes pulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.02); } }
        @keyframes bounce { 0%, 20%, 50%, 80%, 100% { transform: translateY(0); } 40% { transform: translateY(-8px); } 60% { transform: translateY(-4px); } }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        @keyframes shimmer { 0% { background-position: -200% 0; } 100% { background-position: 200% 0; } }

        .container { 
            max-width: 1200px; 
            margin: 0 auto; 
            padding: 20px;
            animation: slideInUp 0.6s ease-out;
        }

        .main-header {
            background: linear-gradient(135deg, var(--cor-primaria) 0%, var(--cor-primaria) 100%);
            color: white;
            padding: 30px 0;
            text-align: center;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            margin-bottom: 30px;
            border-radius: 15px;
            animation: slideInDown 0.7s ease-out;
            position: relative;
            overflow: hidden;
        }

        .main-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
            animation: shimmer 3s infinite;
        }

        .main-header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            animation: bounce 1s ease-out 0.5s both;
        }

        .nav-menu {
            background: var(--cor-branca);
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            margin-bottom: 30px;
            text-align: center;
            animation: slideInUp 0.6s ease-out 0.2s both;
        }

        .nav-btn {
            background: linear-gradient(135deg, var(--cor-primaria) 0%, var(--cor-primaria) 100%);
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px;
            transition: all 0.3s ease;
            font-weight: 600;
            position: relative;
            overflow: hidden;
        }

        .nav-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 15px rgba(125, 186, 132, 0.3);
        }

        .nav-btn.active {
            background: linear-gradient(135deg, var(--cor-secundaria) 0%, var(--cor-secundaria) 100%);
            box-shadow: 0 4px 10px rgba(143, 214, 148, 0.4);
            animation: pulse 2s infinite;
        }

        .section {
            background: var(--cor-branca);
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            margin-bottom: 30px;
            display: none;
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.5s ease;
        }

        .section.active {
            display: block;
            animation: slideInUp 0.5s ease-out forwards;
        }

        .section h2 {
            color: var(--cor-secundaria);
            margin-bottom: 25px;
            font-size: 1.8em;
            border-bottom: 3px solid var(--cor-primaria);
            padding-bottom: 10px;
            animation: slideInLeft 0.6s ease-out;
        }

        .login-card {
            background: linear-gradient(135deg, #f8faf9 0%, #e9f5ea 100%);
            border: 2px solid var(--cor-secundaria);
            border-radius: 20px;
            padding: 40px;
            text-align: center;
            margin: 30px 0;
            box-shadow: 0 8px 25px rgba(30, 68, 30, 0.1);
        }

        .login-input {
            width: 100%;
            max-width: 400px;
            padding: 15px 20px;
            border: 2px solid var(--cor-primaria);
            border-radius: 50px;
            font-size: 16px;
            text-align: center;
            margin: 20px auto;
            display: block;
            transition: all 0.3s ease;
            background: rgba(255, 255, 255, 0.9);
        }

        .login-input:focus {
            outline: none;
            box-shadow: 0 0 20px rgba(30, 68, 30, 0.3);
            transform: translateY(-2px);
        }

        .access-status {
            background: var(--cor-primaria);
            color: white;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: center;
            font-weight: bold;
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .form-group {
            margin-bottom: 20px;
            animation: slideInLeft 0.5s ease-out;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--cor-escura);
        }

        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
            border-color: var(--cor-primaria);
            outline: none;
            box-shadow: 0 0 10px rgba(125, 186, 132, 0.2);
            transform: translateY(-2px);
        }

        .btn {
            background: linear-gradient(135deg, var(--cor-primaria) 0%, var(--cor-primaria) 100%);
            color: white;
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            margin: 5px;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(125, 186, 132, 0.3);
        }

        .btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .btn-success { background: linear-gradient(135deg, var(--cor-primaria) 0%, var(--cor-primaria) 100%); }
        .btn-danger { background: linear-gradient(135deg, #dc3545 0%, #c82333 100%); }
        .btn-warning { background: linear-gradient(135deg, #ffc107 0%, #e0a800 100%); }
        .btn-info { background: linear-gradient(135deg, var(--cor-primaria) 0%, var(--cor-primaria) 100%); }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .stat-card {
            background: linear-gradient(135deg, var(--cor-primaria) 0%, var(--cor-primaria) 100%);
            color: white;
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            transition: all 0.3s ease;
            animation: slideInUp 0.6s ease-out;
            cursor: pointer;
        }

        .stat-card:hover {
            transform: translateY(-5px) scale(1.02);
            box-shadow: 0 8px 20px rgba(30, 68, 30, 0.3);
        }

        .stat-number {
            font-size: 2.5em;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 20px;
            animation: fadeIn 0.5s ease-out;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid var(--cor-primaria);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }

        .alert {
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            border-left: 5px solid;
            animation: slideInLeft 0.5s ease-out;
        }

        .alert-success {
            background: rgba(143, 214, 148, 0.1);
            border-color: var(--cor-secundaria);
            color: var(--cor-acento);
        }

        .alert-danger {
            background: #f8d7da;
            border-color: #dc3545;
            color: #721c24;
        }

        .alert-warning {
            background: #fff3cd;
            border-color: #ffc107;
            color: #856404;
        }

        .alert-info {
            background: rgba(111, 143, 114, 0.1);
            border-color: var(--cor-neutra);
            color: var(--cor-escura);
        }

        .competencia-card {
            background: #f8faf9;
            border: 1px solid #e0e0e0;
            border-radius: 15px;
            margin: 20px 0;
            overflow: hidden;
            transition: all 0.3s ease;
            animation: slideInUp 0.6s ease-out;
        }

        .competencia-header {
            background: linear-gradient(135deg, var(--cor-primaria) 0%, var(--cor-acento) 100%);
            color: white;
            padding: 20px;
            font-size: 1.2em;
            font-weight: bold;
        }

        .fator-item {
            padding: 20px;
            border-bottom: 1px solid #eee;
        }

        .fator-texto {
            margin-bottom: 15px;
            font-weight: 500;
            color: var(--cor-escura);
        }

        .rating-container {
            display: flex;
            align-items: center;
            gap: 15px;
            flex-wrap: wrap;
        }

        .rating-label {
            font-size: 12px;
            color: var(--cor-neutra);
            font-weight: 600;
        }

        .rating-option {
            display: flex;
            flex-direction: column;
            align-items: center;
            cursor: pointer;
            padding: 10px;
            border-radius: 8px;
            transition: all 0.3s ease;
        }

        .rating-option:hover {
            background: rgba(125, 186, 132, 0.1);
            transform: scale(1.05);
        }

        .rating-option input[type="radio"] {
            margin-bottom: 5px;
            transform: scale(1.2);
            accent-color: var(--cor-primaria);
        }

        .progress-container {
            background: var(--cor-branca);
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin: 20px 0;
        }

        .progress-bar {
            width: 100%;
            height: 25px;
            background: #e0e0e0;
            border-radius: 15px;
            overflow: hidden;
            margin: 10px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(135deg, var(--cor-secundaria) 0%, var(--cor-primaria) 100%);
            width: 0%;
            transition: width 0.8s ease;
            border-radius: 15px;
        }

        .resultado-card {
            background: linear-gradient(135deg, #f8faf9 0%, #e9f5ea 100%);
            border: 2px solid var(--cor-secundaria);
            border-radius: 15px;
            padding: 30px;
            text-align: center;
            margin: 30px 0;
            display: none;
        }

        .resultado-card.show {
            display: block;
            animation: slideInUp 0.8s ease-out;
        }

        .pontuacao-display {
            font-size: 3em;
            font-weight: bold;
            margin: 20px 0;
            color: var(--cor-primaria);
        }

        .classificacao-display {
            font-size: 1.5em;
            font-weight: bold;
            padding: 15px 30px;
            border-radius: 50px;
            margin: 20px 0;
            display: inline-block;
            background: var(--cor-primaria);
            color: white;
        }

        .info-card {
            background: var(--cor-branca);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            margin: 20px 0;
            animation: slideInUp 0.6s ease-out;
        }

        .tabela-historico {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .tabela-historico th {
            background: var(--cor-primaria);
            color: white;
            padding: 15px;
            font-weight: 600;
            text-align: center;
        }

        .tabela-historico td {
            padding: 15px;
            border-bottom: 1px solid #eee;
            text-align: center;
        }

        .tabela-historico tr:nth-child(even) {
            background: rgba(248, 250, 249, 0.5);
        }

        .tabela-historico tr:hover {
            background: rgba(143, 214, 148, 0.1);
            transform: scale(1.01);
            transition: all 0.3s ease;
        }

        .status-conexao {
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
            text-align: center;
            font-weight: bold;
        }

        .status-conectado {
            background: rgba(143, 214, 148, 0.1);
            border: 2px solid var(--cor-secundaria);
            color: var(--cor-primaria);
        }

        .status-desconectado {
            background: rgba(220, 53, 69, 0.1);
            border: 2px solid #dc3545;
            color: #721c24;
        }
    </style>
</head>
<body>
    <header class="main-header">
        <div class="container">
            <h1>üéØ SISTEMA DE AVALIA√á√ÉO DE DESEMPENHO</h1>
            <p>Sistema G&G v3.1 - Otimizado e Corrigido</p>
        </div>

        <footer style="background: var(--cor-primaria); color: white; text-align: center; padding: 15px; margin-top: 50px;">
            <div class="container">
                <p style="margin: 2px 0; font-size: 11px; opacity: 0.7;">
                    Desenvolvido por Juliano Patrick | julianocorrea@bateforte.com.br | Sistema v3.1 - Corrigido ¬© 2025
                </p>
            </div>
        </footer>
    </header>

    <div class="container">
        <nav class="nav-menu">
            <button class="nav-btn active" onclick="GG.showSection('home')">üè† Home</button>
            <button class="nav-btn" onclick="GG.showSection('avaliacao')">üìù Nova Avalia√ß√£o</button>
            <button class="nav-btn" onclick="GG.acessoHistorico()">üìã Hist√≥rico</button>
            <button class="nav-btn" onclick="GG.acessoConfiguracoes()">‚öôÔ∏è Configura√ß√µes</button>
        </nav>

        <!-- Se√ß√£o Home -->
        <section id="home" class="section active">
            <h2>üè† Sistema G&G v3.1 - Otimizado</h2>
            
            <div id="statusConexaoHome" class="status-conexao">
                <span id="textoStatus">üîÑ Verificando conex√£o...</span>
            </div>
            
            <div class="alert alert-info">
                <h4>üîó Sistema Corrigido e Otimizado</h4>
                <p><strong>Todas as funcionalidades restauradas!</strong></p>
                <ul style="margin: 10px 0; padding-left: 30px;">
                    <li>‚úÖ Busca autom√°tica de colaboradores e gestores</li>
                    <li>‚úÖ Salvamento seguro no Google Sheets</li>
                    <li>‚úÖ Hist√≥rico com controle de acesso por filial</li>
                    <li>‚úÖ Interface totalmente funcional</li>
                    <li>‚úÖ Sistema de cache otimizado</li>
                    <li>‚úÖ Debug e recupera√ß√£o de erros</li>
                </ul>
            </div>
            
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-number" id="totalAvaliacoesHome">0</div>
                    <div class="stat-label">Avalia√ß√µes Realizadas</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="mediaGeralHome">0.00</div>
                    <div class="stat-label">M√©dia Geral</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="totalColaboradoresHome">0</div>
                    <div class="stat-label">Colaboradores</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="totalGestoresHome">0</div>
                    <div class="stat-label">Gestores</div>
                </div>
            </div>
        </section>

        <!-- Se√ß√£o Nova Avalia√ß√£o -->
        <section id="avaliacao" class="section">
            <h2>üìù Nova Avalia√ß√£o</h2>

            <div id="statusDados" class="alert alert-info">
                <p>üîÑ <strong>Carregando dados das planilhas...</strong></p>
            </div>

            <div class="info-card">
                <h3>üë§ Dados Pessoais</h3>
                <div class="form-row">
                    <div class="form-group">
                        <label for="matriculaAvaliado">Matr√≠cula do Avaliado *</label>
                        <input type="text" id="matriculaAvaliado" required placeholder="Digite a matr√≠cula..." 
                               onchange="GG.buscarColaborador(this.value)">
                    </div>
                    <div class="form-group">
                        <label for="nomeAvaliado">Nome do Avaliado</label>
                        <input type="text" id="nomeAvaliado" readonly style="background: #f0f0f0;">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="funcaoAvaliado">Fun√ß√£o do Avaliado</label>
                        <input type="text" id="funcaoAvaliado" readonly style="background: #f0f0f0;">
                    </div>
                    <div class="form-group">
                        <label for="filial">Filial</label>
                        <input type="text" id="filial" readonly style="background: #f0f0f0;">
                    </div>
                </div>
                
                <hr style="margin: 30px 0; border: 1px solid #e0e0e0;">
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="matriculaGestor">Matr√≠cula do Gestor *</label>
                        <input type="text" id="matriculaGestor" required placeholder="Digite a matr√≠cula do gestor..." 
                               onchange="GG.buscarGestor(this.value)">
                    </div>
                    <div class="form-group">
                        <label for="nomeGestor">Nome do Gestor</label>
                        <input type="text" id="nomeGestor" readonly style="background: #f0f0f0;">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="funcaoGestor">Fun√ß√£o do Gestor</label>
                        <input type="text" id="funcaoGestor" readonly style="background: #f0f0f0;">
                    </div>
                    <div class="form-group">
                        <label for="regionalGestor">Regional</label>
                        <input type="text" id="regionalGestor" readonly style="background: #f0f0f0;">
                    </div>
                </div>
            </div>

            <div class="progress-container">
                <h3>üìä Progresso da Avalia√ß√£o</h3>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
                <div class="progress-text" id="progressText">0 de 31 fatores avaliados</div>
            </div>

            <div id="competenciasContainer"></div>

            <div class="info-card">
                <h3>üí¨ Feedback e Coment√°rios</h3>
                <div class="form-group">
                    <label for="pontosFortes">Pontos Fortes</label>
                    <textarea id="pontosFortes" rows="4" placeholder="Principais pontos fortes identificados..."></textarea>
                </div>
                <div class="form-group">
                    <label for="oportunidades">Oportunidades de Desenvolvimento</label>
                    <textarea id="oportunidades" rows="4" placeholder="√Åreas que precisam de desenvolvimento..."></textarea>
                </div>
                <div class="form-group">
                    <label for="comentarios">Coment√°rios Gerais</label>
                    <textarea id="comentarios" rows="4" placeholder="Coment√°rios adicionais sobre a avalia√ß√£o..."></textarea>
                </div>
            </div>

            <div id="resultadoCard" class="resultado-card">
                <h3>üìä Resultado da Avalia√ß√£o</h3>
                <div class="pontuacao-display" id="pontuacaoDisplay">0.00/5.00</div>
                <div class="classificacao-display" id="classificacaoDisplay">-</div>
                <div id="laudoResumo" style="margin-top: 20px; font-size: 1.1em; line-height: 1.6;"></div>
            </div>

            <div style="text-align: center; margin: 30px 0;">
                <button class="btn btn-info" onclick="GG.calcularResultado()">üìä Calcular Resultado</button>
                <button class="btn btn-success" onclick="GG.salvarAvaliacao()" id="btnSalvar" disabled>‚òÅÔ∏è Salvar no Google Sheets</button>
                <button class="btn" onclick="GG.limparFormulario()">üóëÔ∏è Limpar Formul√°rio</button>
            </div>

            <div class="loading" id="loading">
                <div class="spinner"></div>
                <p>Processando...</p>
            </div>
        </section>

        <!-- Se√ß√£o de Login para Hist√≥rico -->
        <section id="loginHistorico" class="section">
            <h2>üîê Acesso ao Hist√≥rico por Filial</h2>
            
            <div class="login-card">
                <h3 style="color: var(--cor-primaria); margin-bottom: 30px;">üîí Digite a Senha da sua Filial</h3>
                
                <div class="form-group">
                    <input type="password" id="senhaHistorico" class="login-input" placeholder="Digite a senha da sua filial..." onkeypress="GG.verificarEnter(event, 'historico')">
                </div>
                
                <button class="btn btn-success" onclick="GG.validarSenhaHistorico()">üîì Acessar Hist√≥rico</button>
                <button class="btn" onclick="GG.showSection('home')">‚ùå Cancelar</button>
                
                <div style="background: rgba(255, 255, 255, 0.7); border-radius: 15px; padding: 25px; margin-top: 30px; text-align: left;">
                    <h4 style="color: var(--cor-primaria); margin-bottom: 15px; text-align: center;">‚ÑπÔ∏è Senhas por Filial</h4>
                    <p><strong>Filiais:</strong> GG74301 (743-MS) | GG26402 (264-SC) | GG75303 (753-MT) | GG36404 (364-DF) | GG71305 (713-SP)</p>
                    <p><strong>Master:</strong> GGMASTER (todas as filiais) | GGMASTERJP (administrativo)</p>
                </div>
            </div>
        </section>

        <!-- Se√ß√£o de Login para Configura√ß√µes -->
        <section id="loginConfiguracoes" class="section">
            <h2>‚öôÔ∏è Acesso √†s Configura√ß√µes</h2>
            
            <div class="login-card">
                <h3 style="color: var(--cor-primaria); margin-bottom: 30px;">üîí √Årea Restrita - Administra√ß√£o</h3>
                
                <div class="form-group">
                    <input type="password" id="senhaConfiguracoes" class="login-input" placeholder="Digite GGMASTERJP..." onkeypress="GG.verificarEnter(event, 'configuracoes')">
                </div>
                
                <button class="btn btn-success" onclick="GG.validarSenhaConfiguracoes()">üîì Acessar Configura√ß√µes</button>
                <button class="btn" onclick="GG.showSection('home')">‚ùå Cancelar</button>
            </div>
        </section>

        <!-- Se√ß√£o Hist√≥rico -->
        <section id="historico" class="section">
            <div id="accessStatus" class="access-status" style="display: none;"></div>

            <h2>üìã Hist√≥rico de Avalia√ß√µes</h2>

            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-number" id="totalAvaliacoes">0</div>
                    <div class="stat-label">Total de Avalia√ß√µes</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="mediaGeral">0.00</div>
                    <div class="stat-label">M√©dia Geral</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="excelentes">0</div>
                    <div class="stat-label">Excelentes</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="precisamMelhorar">0</div>
                    <div class="stat-label">Precisam Melhorar</div>
                </div>
            </div>

            <div style="text-align: center; margin: 30px 0;">
                <button class="btn btn-info" onclick="GG.carregarHistorico()">üîÑ Sincronizar</button>
                <button class="btn btn-warning" onclick="GG.exportarDados()">üì• Exportar</button>
                <button class="btn btn-danger" onclick="GG.logout()">üö™ Sair</button>
            </div>

            <div id="tabelaHistorico">
                <p style="text-align: center; padding: 30px; color: #666;">üìä Carregando dados...</p>
            </div>
        </section>

        <!-- Se√ß√£o Configura√ß√µes -->
        <section id="configuracoes" class="section">
            <div id="configStatus" class="access-status" style="display: none;"></div>

            <h2>‚öôÔ∏è Configura√ß√µes do Sistema</h2>

            <div class="info-card">
                <h3>üîó Configura√ß√£o da Web App</h3>
                <div class="alert alert-warning">
                    <p><strong>URL Atual:</strong> <span id="webappUrl">Verificando...</span></p>
                </div>
                <div style="text-align: center; margin: 20px 0;">
                    <button class="btn btn-info" onclick="GG.configurarWebApp()">üîó Configurar URL</button>
                    <button class="btn btn-success" onclick="GG.testarConexao()">üß™ Testar Conex√£o</button>
                </div>
            </div>

            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-number" id="totalColaboradoresConfig">0</div>
                    <div class="stat-label">Colaboradores</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="totalGestoresConfig">0</div>
                    <div class="stat-label">Gestores</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="totalAvaliacoesConfig">0</div>
                    <div class="stat-label">Avalia√ß√µes</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="statusSincronizacao">--</div>
                    <div class="stat-label">Status</div>
                </div>
            </div>

            <div style="text-align: center; margin: 30px 0;">
                <button class="btn btn-info" onclick="GG.sincronizarDados()">üîÑ Sincronizar</button>
                <button class="btn btn-warning" onclick="GG.debugSistema()">üîç Debug</button>
                <button class="btn btn-danger" onclick="GG.logout()">üö™ Sair</button>
            </div>
        </section>
    </div>

    <script>
        // =====================================================
        // SISTEMA G&G v3.1 - TOTALMENTE OTIMIZADO E CORRIGIDO
        // =====================================================

        // Objeto principal do sistema
        const GG = {
            // Configura√ß√µes
            WEBAPP_URL: 'https://script.google.com/macros/s/AKfycbwdKwQh35U-zt0-8047vALY3nlFjdIMtZFHF8YFYB8pxOi2Poba9Dj6NmSvp5RDRz31OQ/exec',
            
            // Dados do sistema
            dados: {
                avaliacoes: [],
                colaboradores: {},
                gestores: {},
                avaliacaoAtual: null,
                dadosCarregados: false
            },

            // Cache
            cache: {
                avaliacoes: [],
                colaboradores: {},
                gestores: {},
                ultimaAtualizacao: null,
                tempoCache: 5 * 60 * 1000
            },

            // Controle de acesso
            acesso: {
                tipo: null,
                senha: null,
                filial: null,
                permissoes: []
            },

            // Senhas do sistema
            SENHAS_FILIAIS: {
                'GG74301': { filial: '743', regional: 'MS' },
                'GG26402': { filial: '264', regional: 'SC' },
                'GG75303': { filial: '753', regional: 'MT' },
                'GG36404': { filial: '364', regional: 'DF' },
                'GG71305': { filial: '713', regional: 'SP' },
                'GG46806': { filial: '468', regional: 'MT' },
                'GG89207': { filial: '892', regional: 'SP' },
                'GG72308': { filial: '723', regional: 'SP' },
                'GG23009': { filial: '230', regional: 'SP' },
                'GG77310': { filial: '773', regional: 'RS' },
                'GG47311': { filial: '473', regional: 'MT' },
                'GG16712': { filial: '167', regional: 'MS' },
                'GG02013': { filial: '20', regional: 'AGP' }
            },

            SENHAS_ESPECIAIS: {
                'GGMASTER': { tipo: 'master', descricao: 'Acesso a todas as filiais' },
                'GGMASTERJP': { tipo: 'admin', descricao: 'Acesso administrativo completo' }
            },

            // Compet√™ncias
            COMPETENCIAS: [
                {
                    nome: 'COMUNICA√á√ÉO E INFLU√äNCIA',
                    fatores: [
                        'Tem clareza, √© emp√°tico(a) e inclusivo(a) na sua comunica√ß√£o.',
                        'Possui habilidades em comunicar temas cr√≠ticos, transmitindo confian√ßa ao time.',
                        '√â influenciador(a) e inspira seu time e a rede de relacionamento pelo exemplo.',
                        'Respeita as opini√µes divergentes, escuta de maneira aberta.',
                        'Cria um ambiente de seguran√ßa e confian√ßa m√∫tua.'
                    ]
                },
                {
                    nome: 'DISCIPLINA DE EXECU√á√ÉO',
                    fatores: [
                        'Garante planejamento e execu√ß√£o com efici√™ncia dentro dos prazos.',
                        'Constr√≥i regras e processos e busca eliminar burocracias desnecess√°rias.',
                        'Assume responsabilidade, cumpre normas e procedimentos.',
                        'Estimula o time para que esteja comprometido com prazos e entregas.',
                        'Garante n√≠veis excelentes de qualidade nas entregas.'
                    ]
                },
                {
                    nome: 'FOCO EM RESULTADOS',
                    fatores: [
                        'Possui consist√™ncia nas entregas.',
                        'Tem flexibilidade para liderar diferentes frentes.',
                        'Elabora e cumpre planos de a√ß√µes para o atingimento das metas.',
                        'Conhece o neg√≥cio e acompanha resultados atrav√©s de dados.',
                        'Estimula o time para possu√≠rem vis√£o cr√≠tica e trazerem solu√ß√µes.'
                    ]
                },
                {
                    nome: 'FOCO NO CLIENTE/TUTOR',
                    fatores: [
                        'Entende, prioriza e antecipa as necessidades dos clientes.',
                        'Constr√≥i alian√ßas com clientes, pares, √°reas parceiras.',
                        'Implementa novas solu√ß√µes para atingir expectativas do cliente.',
                        'Direciona o time para conhecer as necessidades dos clientes.',
                        'Desenvolve a√ß√µes efetivas e de sucesso para os clientes.'
                    ]
                },
                {
                    nome: 'LIDERAN√áA E GEST√ÉO DE PESSOAS',
                    fatores: [
                        'Age com clareza na distribui√ß√£o dos pap√©is e responsabilidades.',
                        'Sabe identificar desafios compat√≠veis com a capacidade de cada um.',
                        'Estimula e conduz o time para que alcance/supere as metas.',
                        'Direciona o time com clareza para as atividades.',
                        'Orienta, d√° feedbacks efetivos e acompanha evolu√ß√µes.',
                        'Possui preocupa√ß√£o genu√≠na com as pessoas e desenvolve liderados.'
                    ]
                },
                {
                    nome: 'POSTURA DE DONO',
                    fatores: [
                        'Possui senso de urg√™ncia e sabe direcionar o time.',
                        'Assume responsabilidade e n√£o terceiriza para outras √°reas.',
                        '√â exemplo e estimula o time a ser inconformado com entregas.',
                        '√â atento √†s tend√™ncias de mercado e busca aplic√°-las.',
                        '√â atento e gerencia os desperd√≠cios e custos.'
                    ]
                }
            ],

            // =====================================================
            // FUN√á√ïES DE COMUNICA√á√ÉO COM GOOGLE SHEETS
            // =====================================================

            async buscarDoGoogleSheets(acao) {
                if (!this.WEBAPP_URL || this.WEBAPP_URL.includes('SEU_ID')) {
                    throw new Error('URL da Web App n√£o configurada');
                }

                try {
                    console.log(`üì° Buscando ${acao}...`);
                    
                    const response = await fetch(`${this.WEBAPP_URL}?acao=${acao}`, { 
                        method: 'GET',
                        headers: {
                            'Content-Type': 'application/json',
                            'Accept': 'application/json'
                        },
                        mode: 'cors'
                    });
                    
                    if (!response.ok) {
                        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                    }
                    
                    const texto = await response.text();
                    const resultado = JSON.parse(texto);
                    
                    if (resultado && resultado.sucesso) {
                        console.log(`‚úÖ ${acao} carregado`);
                        return resultado;
                    } else {
                        throw new Error(resultado?.mensagem || 'Resposta inv√°lida');
                    }

                } catch (error) {
                    console.error(`‚ùå Erro ${acao}:`, error);
                    throw error;
                }
            },

            async enviarParaGoogleSheets(acao, dados = {}) {
                if (!this.WEBAPP_URL || this.WEBAPP_URL.includes('SEU_ID')) {
                    throw new Error('URL da Web App n√£o configurada');
                }

                try {
                    console.log(`üì§ Enviando ${acao}...`);
                    
                    const payload = { acao: acao, ...dados };
                    
                    const response = await fetch(this.WEBAPP_URL, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });
                    
                    if (!response.ok) {
                        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                    }
                    
                    const resultado = await response.json();
                    
                    if (resultado && resultado.sucesso) {
                        console.log('‚úÖ Dados enviados');
                        return resultado;
                    } else {
                        throw new Error(resultado?.mensagem || 'Erro desconhecido');
                    }
                    
                } catch (error) {
                    console.error('‚ùå Erro no envio:', error);
                    throw error;
                }
            },

            // =====================================================
            // FUN√á√ïES DE CARREGAMENTO DE DADOS
            // =====================================================

            async carregarDadosSalvos() {
                console.log('üìÇ Carregando dados...');
                
                try {
                    this.atualizarStatusDados('üîÑ Buscando dados das planilhas...', 'info');
                    
                    const [resAvaliacoes, resColaboradores, resGestores] = await Promise.all([
                        this.buscarDoGoogleSheets('buscar_avaliacoes'),
                        this.buscarDoGoogleSheets('buscar_colaboradores'),
                        this.buscarDoGoogleSheets('buscar_gestores')
                    ]);
                    
                    if (resAvaliacoes.sucesso) {
                        this.dados.avaliacoes = resAvaliacoes.dados || [];
                        this.cache.avaliacoes = this.dados.avaliacoes;
                    }
                    
                    if (resColaboradores.sucesso) {
                        this.dados.colaboradores = resColaboradores.dados || {};
                        this.cache.colaboradores = this.dados.colaboradores;
                    }
                    
                    if (resGestores.sucesso) {
                        this.dados.gestores = resGestores.dados || {};
                        this.cache.gestores = this.dados.gestores;
                    }
                    
                    this.cache.ultimaAtualizacao = Date.now();
                    this.dados.dadosCarregados = true;
                    
                    localStorage.setItem('gg_cache', JSON.stringify(this.cache));
                    
                    console.log('‚úÖ Dados carregados:', {
                        avaliacoes: this.dados.avaliacoes.length,
                        colaboradores: Object.keys(this.dados.colaboradores).length,
                        gestores: Object.keys(this.dados.gestores).length
                    });
                    
                    this.atualizarStatusDados(`‚úÖ Dados carregados: ${Object.keys(this.dados.colaboradores).length} colaboradores, ${Object.keys(this.dados.gestores).length} gestores`, 'success');
                    this.atualizarStatusConexaoHome(true);
                    
                } catch (error) {
                    console.error('‚ùå Erro ao carregar dados:', error);
                    this.carregarDadosDoCache();
                    this.atualizarStatusConexaoHome(false);
                }
            },

            carregarDadosDoCache() {
                try {
                    const cacheStorage = localStorage.getItem('gg_cache');
                    if (cacheStorage) {
                        const dadosCache = JSON.parse(cacheStorage);
                        this.cache = dadosCache;
                        this.dados.avaliacoes = dadosCache.avaliacoes || [];
                        this.dados.colaboradores = dadosCache.colaboradores || {};
                        this.dados.gestores = dadosCache.gestores || {};
                        this.dados.dadosCarregados = true;
                        
                        this.atualizarStatusDados('‚ö†Ô∏è Usando dados em cache (offline)', 'warning');
                    } else {
                        this.atualizarStatusDados('‚ùå Nenhum dado dispon√≠vel. Configure a conex√£o.', 'danger');
                    }
                } catch (error) {
                    console.error('‚ùå Erro no cache:', error);
                    this.atualizarStatusDados('‚ùå Erro ao carregar dados', 'danger');
                }
            },

            // =====================================================
            // FUN√á√ïES DE INTERFACE
            // =====================================================

            showSection(sectionId) {
                // Ocultar todas as se√ß√µes
                document.querySelectorAll('.section').forEach(section => {
                    section.classList.remove('active');
                });

                // Remover classe ativa dos bot√µes
                document.querySelectorAll('.nav-btn').forEach(btn => {
                    btn.classList.remove('active');
                });

                // Mostrar se√ß√£o selecionada
                document.getElementById(sectionId).classList.add('active');

                // Ativar bot√£o correspondente
                const botoes = document.querySelectorAll('.nav-btn');
                botoes.forEach(btn => {
                    if ((sectionId === 'home' && btn.textContent.includes('Home')) ||
                        (sectionId === 'avaliacao' && btn.textContent.includes('Nova')) ||
                        (sectionId === 'historico' && btn.textContent.includes('Hist√≥rico')) ||
                        (sectionId === 'configuracoes' && btn.textContent.includes('Configura√ß√µes'))) {
                        btn.classList.add('active');
                    }
                });

                // Executar a√ß√µes espec√≠ficas da se√ß√£o
                switch(sectionId) {
                    case 'home':
                        this.atualizarEstatisticasHome();
                        break;
                    case 'avaliacao':
                        this.inicializarFormularioAvaliacao();
                        break;
                    case 'historico':
                        if (this.acesso.tipo) {
                            this.carregarHistorico();
                        }
                        break;
                    case 'configuracoes':
                        if (this.acesso.tipo === 'admin') {
                            this.atualizarEstatisticasConfig();
                        }
                        break;
                }
            },

            inicializarFormularioAvaliacao() {
                this.criarFormularioCompetencias();
                this.atualizarProgresso();
                
                if (!this.dados.dadosCarregados) {
                    this.carregarDadosSalvos();
                }
            },

            criarFormularioCompetencias() {
                const container = document.getElementById('competenciasContainer');
                let html = '';
                let fatorIndex = 0;

                this.COMPETENCIAS.forEach((competencia) => {
                    html += '<div class="competencia-card">';
                    html += '<div class="competencia-header">' + competencia.nome + '</div>';

                    competencia.fatores.forEach((fator) => {
                        html += '<div class="fator-item">';
                        html += '<div class="fator-texto">' + fator + '</div>';
                        html += '<div class="rating-container">';
                        html += '<span class="rating-label">Inadequado</span>';
                        
                        for(let i = 1; i <= 5; i++) {
                            html += '<label class="rating-option">';
                            html += '<input type="radio" name="fator_' + fatorIndex + '" value="' + i + '" onchange="GG.atualizarProgresso()">';
                            html += '<span>' + i + '</span>';
                            html += '</label>';
                        }
                        
                        html += '<span class="rating-label">Excelente</span>';
                        html += '</div>';
                        html += '</div>';
                        fatorIndex++;
                    });

                    html += '</div>';
                });

                container.innerHTML = html;
            },

            atualizarProgresso() {
                const totalFatores = 31;
                const fatoresAvaliados = document.querySelectorAll('input[type="radio"]:checked').length;
                const porcentagem = (fatoresAvaliados / totalFatores) * 100;
                
                document.getElementById('progressFill').style.width = porcentagem + '%';
                document.getElementById('progressText').textContent = fatoresAvaliados + ' de ' + totalFatores + ' fatores avaliados';
                
                return fatoresAvaliados;
            },

            // =====================================================
            // FUN√á√ïES DE BUSCA
            // =====================================================

            buscarColaborador(matricula) {
                if (!matricula || matricula.trim() === '') {
                    this.limparCamposColaborador();
                    return;
                }
                
                const colaborador = this.dados.colaboradores[matricula.trim()];
                
                if (colaborador) {
                    document.getElementById('nomeAvaliado').value = colaborador.nome || '';
                    document.getElementById('funcaoAvaliado').value = colaborador.funcao || '';
                    document.getElementById('filial').value = colaborador.filial || '';
                    
                    const campo = document.getElementById('matriculaAvaliado');
                    campo.style.borderColor = 'var(--cor-secundaria)';
                    campo.style.backgroundColor = 'rgba(143, 214, 148, 0.1)';
                    
                    this.mostrarAlerta(`‚úÖ Colaborador encontrado: ${colaborador.nome}`, 'success');
                } else {
                    this.limparCamposColaborador();
                    
                    const campo = document.getElementById('matriculaAvaliado');
                    campo.style.borderColor = '#dc3545';
                    campo.style.backgroundColor = 'rgba(220, 53, 69, 0.1)';
                    
                    this.mostrarAlerta(`‚ùå Colaborador n√£o encontrado: ${matricula}`, 'warning');
                }
            },

            buscarGestor(matricula) {
                if (!matricula || matricula.trim() === '') {
                    this.limparCamposGestor();
                    return;
                }
                
                const gestor = this.dados.gestores[matricula.trim()];
                
                if (gestor) {
                    document.getElementById('nomeGestor').value = gestor.nome || '';
                    document.getElementById('funcaoGestor').value = gestor.funcao || '';
                    document.getElementById('regionalGestor').value = gestor.regional || '';
                    
                    const campo = document.getElementById('matriculaGestor');
                    campo.style.borderColor = 'var(--cor-secundaria)';
                    campo.style.backgroundColor = 'rgba(143, 214, 148, 0.1)';
                    
                    this.mostrarAlerta(`‚úÖ Gestor encontrado: ${gestor.nome}`, 'success');
                } else {
                    this.limparCamposGestor();
                    
                    const campo = document.getElementById('matriculaGestor');
                    campo.style.borderColor = '#dc3545';
                    campo.style.backgroundColor = 'rgba(220, 53, 69, 0.1)';
                    
                    this.mostrarAlerta(`‚ùå Gestor n√£o encontrado: ${matricula}`, 'warning');
                }
            },

            limparCamposColaborador() {
                document.getElementById('nomeAvaliado').value = '';
                document.getElementById('funcaoAvaliado').value = '';
                document.getElementById('filial').value = '';
                
                const campo = document.getElementById('matriculaAvaliado');
                campo.style.borderColor = '#e0e0e0';
                campo.style.backgroundColor = '';
            },

            limparCamposGestor() {
                document.getElementById('nomeGestor').value = '';
                document.getElementById('funcaoGestor').value = '';
                document.getElementById('regionalGestor').value = '';
                
                const campo = document.getElementById('matriculaGestor');
                campo.style.borderColor = '#e0e0e0';
                campo.style.backgroundColor = '';
            },

            // =====================================================
            // FUN√á√ïES DE AVALIA√á√ÉO
            // =====================================================

            calcularResultado() {
                const fatoresAvaliados = this.atualizarProgresso();
                
                if (fatoresAvaliados === 0) {
                    this.mostrarAlerta('‚ùå Avalie pelo menos um fator!', 'danger');
                    return;
                }

                const radios = document.querySelectorAll('input[type="radio"]:checked');
                let somaNotas = 0;
                
                radios.forEach(radio => {
                    somaNotas += parseInt(radio.value);
                });

                const pontuacao = fatoresAvaliados > 0 ? (somaNotas / fatoresAvaliados) : 0;
                let classificacao = '';
                
                if (pontuacao >= 4.5) {
                    classificacao = 'EXCELENTE';
                } else if (pontuacao >= 3.5) {
                    classificacao = 'BOM';
                } else if (pontuacao >= 2.5) {
                    classificacao = 'REGULAR';
                } else {
                    classificacao = 'PRECISA MELHORAR';
                }

                document.getElementById('pontuacaoDisplay').textContent = pontuacao.toFixed(2) + '/5.00';
                document.getElementById('classificacaoDisplay').textContent = classificacao;

                const laudoResumo = this.gerarLaudoResumo(pontuacao, classificacao);
                document.getElementById('laudoResumo').innerHTML = laudoResumo;

                document.getElementById('resultadoCard').classList.add('show');
                document.getElementById('btnSalvar').disabled = fatoresAvaliados < 15;

                this.dados.avaliacaoAtual = {
                    pontuacao: pontuacao,
                    classificacao: classificacao,
                    fatoresAvaliados: fatoresAvaliados,
                    respostas: this.coletarRespostas()
                };

                if (fatoresAvaliados < 15) {
                    this.mostrarAlerta('‚ö†Ô∏è Avalie pelo menos 15 fatores para salvar.', 'warning');
                }
            },

            coletarRespostas() {
                const respostas = {};
                const radios = document.querySelectorAll('input[type="radio"]:checked');
                
                radios.forEach(radio => {
                    respostas[radio.name] = radio.value;
                });

                return respostas;
            },

            gerarLaudoResumo(pontuacao, classificacao) {
                let resumo = '';
                
                if (pontuacao >= 4.5) {
                    resumo = '<strong style="color: var(--cor-primaria);">üéØ EXCELENTE DESEMPENHO!</strong><br>';
                    resumo += 'O(a) avaliado(a) demonstra compet√™ncias excepcionais em lideran√ßa.';
                } else if (pontuacao >= 3.5) {
                    resumo = '<strong style="color: var(--cor-primaria);">üëç BOM DESEMPENHO!</strong><br>';
                    resumo += 'O(a) avaliado(a) apresenta desempenho s√≥lido com oportunidades de desenvolvimento.';
                } else if (pontuacao >= 2.5) {
                    resumo = '<strong style="color: #ffc107;">üìà DESEMPENHO REGULAR</strong><br>';
                    resumo += '√â necess√°rio um plano de desenvolvimento estruturado.';
                } else {
                    resumo = '<strong style="color: #dc3545;">üìö PRECISA MELHORAR</strong><br>';
                    resumo += 'Necess√°ria interven√ß√£o imediata com programa intensivo de desenvolvimento.';
                }

                return resumo;
            },

            async salvarAvaliacao() {
                if (!this.dados.avaliacaoAtual) {
                    this.mostrarAlerta('‚ùå Calcule o resultado primeiro!', 'danger');
                    return;
                }

                const nomeAvaliado = document.getElementById('nomeAvaliado').value;
                const nomeGestor = document.getElementById('nomeGestor').value;
                const filial = document.getElementById('filial').value;

                if (!nomeAvaliado || !nomeGestor || !filial) {
                    this.mostrarAlerta('‚ùå Preencha os campos obrigat√≥rios!', 'danger');
                    return;
                }

                const avaliacao = {
                    id: 'AV' + Date.now(),
                    data: new Date(),
                    nomeAvaliado: nomeAvaliado,
                    matricula: document.getElementById('matriculaAvaliado').value,
                    funcaoAvaliado: document.getElementById('funcaoAvaliado').value,
                    nomeGestor: nomeGestor,
                    matriculaGestor: document.getElementById('matriculaGestor').value,
                    funcaoGestor: document.getElementById('funcaoGestor').value,
                    filial: filial,
                    regional: document.getElementById('regionalGestor').value || 'N/A',
                    pontuacao: this.dados.avaliacaoAtual.pontuacao.toFixed(2),
                    classificacao: this.dados.avaliacaoAtual.classificacao,
                    pontosFortes: document.getElementById('pontosFortes').value,
                    oportunidades: document.getElementById('oportunidades').value,
                    comentarios: document.getElementById('comentarios').value,
                    respostas: this.dados.avaliacaoAtual.respostas || {}
                };

                try {
                    this.mostrarLoading(true);
                    const resultado = await this.enviarParaGoogleSheets('salvar_avaliacao', { avaliacao: avaliacao });
                    
                    if (resultado.sucesso) {
                        this.dados.avaliacoes.push(avaliacao);
                        this.cache.avaliacoes = this.dados.avaliacoes;
                        localStorage.setItem('gg_cache', JSON.stringify(this.cache));
                        
                        this.mostrarAlerta('‚úÖ Avalia√ß√£o salva no Google Sheets! ID: ' + avaliacao.id, 'success');
                        
                        document.getElementById('btnSalvar').textContent = '‚úÖ Salvo!';
                        setTimeout(() => {
                            document.getElementById('btnSalvar').textContent = '‚òÅÔ∏è Salvar no Google Sheets';
                        }, 3000);
                    } else {
                        throw new Error(resultado.mensagem);
                    }
                    
                } catch (error) {
                    console.error('‚ùå Erro ao salvar:', error);
                    this.mostrarAlerta('‚ùå Erro ao salvar: ' + error.message, 'danger');
                } finally {
                    this.mostrarLoading(false);
                }
            },

            limparFormulario() {
                if (confirm('üóëÔ∏è Limpar todos os dados do formul√°rio?')) {
                    document.getElementById('nomeAvaliado').value = '';
                    document.getElementById('matriculaAvaliado').value = '';
                    document.getElementById('funcaoAvaliado').value = '';
                    document.getElementById('nomeGestor').value = '';
                    document.getElementById('matriculaGestor').value = '';
                    document.getElementById('funcaoGestor').value = '';
                    document.getElementById('filial').value = '';
                    document.getElementById('regionalGestor').value = '';
                    document.getElementById('pontosFortes').value = '';
                    document.getElementById('oportunidades').value = '';
                    document.getElementById('comentarios').value = '';

                    document.querySelectorAll('input[type="radio"]').forEach(radio => {
                        radio.checked = false;
                    });

                    document.getElementById('resultadoCard').classList.remove('show');
                    document.getElementById('btnSalvar').disabled = true;
                    
                    this.limparCamposColaborador();
                    this.limparCamposGestor();
                    
                    this.atualizarProgresso();
                    this.dados.avaliacaoAtual = null;

                    this.mostrarAlerta('üóëÔ∏è Formul√°rio limpo!', 'info');
                }
            },

            // =====================================================
            // FUN√á√ïES DE ACESSO E AUTENTICA√á√ÉO
            // =====================================================

            acessoHistorico() {
                this.acesso = { tipo: null, senha: null, filial: null, permissoes: [] };
                this.showSection('loginHistorico');
            },

            acessoConfiguracoes() {
                this.acesso = { tipo: null, senha: null, filial: null, permissoes: [] };
                this.showSection('loginConfiguracoes');
            },

            validarSenhaHistorico() {
                const senha = document.getElementById('senhaHistorico').value.trim().toUpperCase();
                
                if (!senha) {
                    this.mostrarAlerta('‚ùå Digite uma senha!', 'danger');
                    return;
                }

                // Verificar senhas especiais
                if (this.SENHAS_ESPECIAIS[senha]) {
                    const tipoAcesso = this.SENHAS_ESPECIAIS[senha].tipo;
                    
                    this.acesso = {
                        tipo: tipoAcesso,
                        senha: senha,
                        filial: tipoAcesso === 'master' ? 'TODAS' : null,
                        permissoes: tipoAcesso === 'admin' ? ['historico', 'configuracoes'] : ['historico']
                    };

                    this.exibirStatusAcesso('historico');
                    this.showSection('historico');
                    this.carregarHistorico();
                    this.mostrarAlerta(`‚úÖ Acesso liberado: ${this.SENHAS_ESPECIAIS[senha].descricao}`, 'success');
                    return;
                }

                // Verificar senhas de filiais
                if (this.SENHAS_FILIAIS[senha]) {
                    const dadosFilial = this.SENHAS_FILIAIS[senha];
                    
                    this.acesso = {
                        tipo: 'filial',
                        senha: senha,
                        filial: dadosFilial.filial,
                        regional: dadosFilial.regional,
                        permissoes: ['historico']
                    };

                    this.exibirStatusAcesso('historico');
                    this.showSection('historico');
                    this.carregarHistorico();
                    this.mostrarAlerta(`‚úÖ Acesso liberado para Filial ${dadosFilial.filial} - ${dadosFilial.regional}`, 'success');
                    return;
                }

                this.mostrarAlerta('‚ùå Senha inv√°lida!', 'danger');
            },

            validarSenhaConfiguracoes() {
                const senha = document.getElementById('senhaConfiguracoes').value.trim().toUpperCase();
                
                if (senha !== 'GGMASTERJP') {
                    this.mostrarAlerta('‚ùå Senha incorreta!', 'danger');
                    return;
                }

                this.acesso = {
                    tipo: 'admin',
                    senha: senha,
                    filial: null,
                    permissoes: ['historico', 'configuracoes']
                };

                this.exibirStatusAcesso('configuracoes');
                this.showSection('configuracoes');
                this.atualizarEstatisticasConfig();
                this.mostrarAlerta('‚úÖ Acesso administrativo liberado!', 'success');
            },

            exibirStatusAcesso(secao) {
                const statusElement = document.getElementById(secao === 'historico' ? 'accessStatus' : 'configStatus');
                
                if (!statusElement) return;

                let statusText = '';

                switch(this.acesso.tipo) {
                    case 'admin':
                        statusText = `üîê ADMINISTRADOR | Acesso Total | ${this.acesso.senha}`;
                        break;
                    case 'master':
                        statusText = `üîë MASTER | Todas as Filiais | ${this.acesso.senha}`;
                        break;
                    case 'filial':
                        statusText = `üè¢ FILIAL ${this.acesso.filial} - ${this.acesso.regional} | ${this.acesso.senha}`;
                        break;
                    default:
                        statusText = '‚ùå Acesso n√£o autorizado';
                }

                statusElement.innerHTML = statusText;
                statusElement.style.display = 'block';
            },

            verificarEnter(event, tipo) {
                if (event.key === 'Enter') {
                    if (tipo === 'historico') {
                        this.validarSenhaHistorico();
                    } else if (tipo === 'configuracoes') {
                        this.validarSenhaConfiguracoes();
                    }
                }
            },

            logout() {
                this.acesso = { tipo: null, senha: null, filial: null, permissoes: [] };
                
                document.getElementById('senhaHistorico').value = '';
                document.getElementById('senhaConfiguracoes').value = '';
                
                document.getElementById('accessStatus').style.display = 'none';
                document.getElementById('configStatus').style.display = 'none';
                
                this.showSection('home');
                this.mostrarAlerta('üö™ Sess√£o encerrada!', 'info');
            },

            filtrarDadosPorAcesso(dados) {
                if (!this.acesso.tipo || this.acesso.tipo === 'admin' || this.acesso.tipo === 'master') {
                    return dados;
                }

                if (this.acesso.tipo === 'filial' && this.acesso.filial) {
                    return dados.filter(item => item.filial === this.acesso.filial);
                }

                return [];
            },

            // =====================================================
            // FUN√á√ïES DE HIST√ìRICO
            // =====================================================

            async carregarHistorico() {
                console.log('üìã Carregando hist√≥rico...');
                
                try {
                    this.mostrarLoading(true);
                    
                    await this.carregarDadosSalvos();
                    
                    const avaliacoesFiltradas = this.filtrarDadosPorAcesso(this.dados.avaliacoes);
                    
                    this.atualizarEstatisticasHistorico(avaliacoesFiltradas);
                    this.atualizarTabelaHistorico(avaliacoesFiltradas);
                    
                    const tipoAcesso = this.acesso.tipo === 'filial' ? `da Filial ${this.acesso.filial}` : 'completo';
                    this.mostrarAlerta(`‚úÖ Hist√≥rico ${tipoAcesso} carregado!`, 'success');
                    
                } catch (error) {
                    console.error('‚ùå Erro no hist√≥rico:', error);
                    this.mostrarAlerta('‚ùå Erro ao carregar hist√≥rico', 'danger');
                } finally {
                    this.mostrarLoading(false);
                }
            },

            atualizarEstatisticasHistorico(dadosHistorico) {
                const dados = dadosHistorico || this.filtrarDadosPorAcesso(this.dados.avaliacoes);
                const total = dados.length;
                let somaNotas = 0;
                let excelentes = 0;
                let precisamMelhorar = 0;

                dados.forEach(av => {
                    const nota = parseFloat(av.pontuacao);
                    somaNotas += nota;
                    
                    if (av.classificacao === 'EXCELENTE') excelentes++;
                    if (av.classificacao === 'PRECISA MELHORAR') precisamMelhorar++;
                });

                const media = total > 0 ? (somaNotas / total).toFixed(2) : '0.00';

                this.animarNumero('totalAvaliacoes', total);
                this.animarNumero('mediaGeral', parseFloat(media));
                this.animarNumero('excelentes', excelentes);
                this.animarNumero('precisamMelhorar', precisamMelhorar);
            },

            atualizarTabelaHistorico(dadosHistorico) {
                const container = document.getElementById('tabelaHistorico');
                const dados = dadosHistorico || this.filtrarDadosPorAcesso(this.dados.avaliacoes);
                
                if (dados.length === 0) {
                    const mensagem = this.acesso.tipo === 'filial' 
                        ? `üì≠ Nenhuma avalia√ß√£o da Filial ${this.acesso.filial}`
                        : 'üì≠ Nenhuma avalia√ß√£o encontrada';
                    container.innerHTML = `<p style="text-align: center; padding: 30px;">${mensagem}</p>`;
                    return;
                }

                let html = '<table class="tabela-historico">';
                html += '<thead><tr>';
                html += '<th>Data</th><th>Avaliado</th><th>Gestor</th><th>Filial</th><th>Pontua√ß√£o</th><th>Classifica√ß√£o</th>';
                html += '</tr></thead><tbody>';

                dados.forEach(av => {
                    const data = new Date(av.data).toLocaleDateString('pt-BR');
                    html += '<tr>';
                    html += '<td>' + data + '</td>';
                    html += '<td>' + av.nomeAvaliado + '</td>';
                    html += '<td>' + av.nomeGestor + '</td>';
                    html += '<td>' + av.filial + '</td>';
                    html += '<td><strong>' + av.pontuacao + '</strong></td>';
                    html += '<td>' + av.classificacao + '</td>';
                    html += '</tr>';
                });

                html += '</tbody></table>';
                container.innerHTML = html;
            },

            exportarDados() {
                const dadosFiltrados = this.filtrarDadosPorAcesso(this.dados.avaliacoes);
                
                if (dadosFiltrados.length === 0) {
                    this.mostrarAlerta('‚ùå Nenhuma avalia√ß√£o para exportar!', 'danger');
                    return;
                }

                let csv = 'Data,Avaliado,Matricula,Funcao,Gestor,Filial,Pontuacao,Classificacao\n';
                
                dadosFiltrados.forEach(av => {
                    const linha = [
                        new Date(av.data).toLocaleDateString('pt-BR'),
                        av.nomeAvaliado,
                        av.matricula || '',
                        av.funcaoAvaliado || '',
                        av.nomeGestor,
                        av.filial,
                        av.pontuacao,
                        av.classificacao
                    ].join(',');
                    csv += linha + '\n';
                });

                const blob = new Blob([csv], { type: 'text/csv' });
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                
                const nomeArquivo = this.acesso.tipo === 'filial' 
                    ? `avaliacoes_filial_${this.acesso.filial}_${new Date().toISOString().split('T')[0]}.csv`
                    : `avaliacoes_gg_${new Date().toISOString().split('T')[0]}.csv`;
                
                a.download = nomeArquivo;
                a.click();
                window.URL.revokeObjectURL(url);

                this.mostrarAlerta('üì• Dados exportados!', 'success');
            },

            // =====================================================
            // FUN√á√ïES DE CONFIGURA√á√ÉO
            // =====================================================

            configurarWebApp() {
                const novaURL = prompt(`üîó Cole a URL da Web App do Google Apps Script:

üìã INSTRU√á√ïES:
1. Google Apps Script > Implantar > Gerenciar implanta√ß√µes
2. Editar (l√°pis) > Nova vers√£o
3. Execute como: Voc√™
4. Acesso: Qualquer pessoa
5. Implantar e copiar URL:`, this.WEBAPP_URL);
                
                if (novaURL && novaURL.trim()) {
                    this.WEBAPP_URL = novaURL.trim();
                    localStorage.setItem('webapp_url_gg', this.WEBAPP_URL);
                    
                    this.dados.dadosCarregados = false;
                    this.cache.ultimaAtualizacao = null;
                    
                    this.atualizarEstatisticasConfig();
                    this.mostrarAlerta('‚úÖ URL configurada! Testando...', 'info');
                    
                    setTimeout(() => {
                        this.testarConexao();
                    }, 1000);
                }
            },

            async testarConexao() {
                try {
                    this.mostrarLoading(true);
                    
                    const response = await fetch(`${this.WEBAPP_URL}?acao=status`, { 
                        method: 'GET',
                        headers: { 'Content-Type': 'application/json' },
                        mode: 'cors'
                    });
                    
                    if (!response.ok) {
                        throw new Error(`Servidor n√£o respondeu: ${response.status}`);
                    }
                    
                    const resultado = await response.json();
                    
                    if (resultado.sucesso) {
                        let mensagem = '‚úÖ Conex√£o funcionando!\n\n';
                        mensagem += `üìä Vers√£o: ${resultado.dados?.versao || 'N/A'}\n`;
                        mensagem += `üïê Timestamp: ${resultado.dados?.timestamp || 'N/A'}`;
                        
                        this.mostrarAlerta(mensagem, 'success');
                        this.atualizarStatusConexaoHome(true);
                    } else {
                        throw new Error(resultado.mensagem || 'Teste falhou');
                    }
                    
                } catch (error) {
                    console.error('‚ùå Erro no teste:', error);
                    
                    let mensagemErro = '‚ùå Erro na conex√£o:\n\n';
                    
                    if (error.message.includes('Failed to fetch')) {
                        mensagemErro += '‚Ä¢ Verifique se a URL est√° correta\n';
                        mensagemErro += '‚Ä¢ Reimplante a Web App\n';
                        mensagemErro += '‚Ä¢ Verifique as permiss√µes';
                    } else {
                        mensagemErro += error.message;
                    }
                    
                    this.mostrarAlerta(mensagemErro, 'danger');
                    this.atualizarStatusConexaoHome(false);
                } finally {
                    this.mostrarLoading(false);
                }
            },

            async sincronizarDados() {
                try {
                    this.mostrarLoading(true);
                    
                    this.dados.dadosCarregados = false;
                    this.cache.ultimaAtualizacao = null;
                    
                    await this.carregarDadosSalvos();
                    
                    this.atualizarEstatisticasHome();
                    this.atualizarEstatisticasConfig();
                    
                    this.mostrarAlerta('‚úÖ Sincroniza√ß√£o completa!', 'success');
                    
                } catch (error) {
                    this.mostrarAlerta('‚ùå Erro na sincroniza√ß√£o: ' + error.message, 'danger');
                } finally {
                    this.mostrarLoading(false);
                }
            },

            debugSistema() {
                let debug = 'üîç DEBUG DO SISTEMA G&G v3.1\n';
                debug += '=====================================\n\n';
                debug += `üîó URL: ${this.WEBAPP_URL}\n`;
                debug += `üìä Dados carregados: ${this.dados.dadosCarregados}\n`;
                debug += `üë• Colaboradores: ${Object.keys(this.dados.colaboradores).length}\n`;
                debug += `üëî Gestores: ${Object.keys(this.dados.gestores).length}\n`;
                debug += `üìã Avalia√ß√µes: ${this.dados.avaliacoes.length}\n`;
                debug += `üíæ Cache v√°lido: ${this.cache.ultimaAtualizacao ? 'Sim' : 'N√£o'}\n`;
                debug += `üïê √öltima sync: ${this.cache.ultimaAtualizacao ? new Date(this.cache.ultimaAtualizacao).toLocaleString() : 'Nunca'}\n`;
                debug += `üîê Acesso atual: ${this.acesso.tipo || 'Nenhum'}\n`;
                
                alert(debug);
                console.log('üîç Debug do sistema:', this);
            },

            // =====================================================
            // FUN√á√ïES DE ESTAT√çSTICAS
            // =====================================================

            atualizarEstatisticasHome() {
                const total = this.dados.avaliacoes.length;
                let somaNotas = 0;
                let excelentes = 0;

                this.dados.avaliacoes.forEach(av => {
                    somaNotas += parseFloat(av.pontuacao);
                    if (av.classificacao === 'EXCELENTE') excelentes++;
                });

                const media = total > 0 ? (somaNotas / total).toFixed(2) : '0.00';

                this.animarNumero('totalAvaliacoesHome', total);
                this.animarNumero('mediaGeralHome', parseFloat(media));
                this.animarNumero('totalColaboradoresHome', Object.keys(this.dados.colaboradores).length);
                this.animarNumero('totalGestoresHome', Object.keys(this.dados.gestores).length);
            },

            atualizarEstatisticasConfig() {
                const totalColabs = Object.keys(this.dados.colaboradores).length;
                const totalGests = Object.keys(this.dados.gestores).length;
                const totalAvs = this.dados.avaliacoes.length;

                this.animarNumero('totalColaboradoresConfig', totalColabs);
                this.animarNumero('totalGestoresConfig', totalGests);
                this.animarNumero('totalAvaliacoesConfig', totalAvs);
                
                const statusEl = document.getElementById('statusSincronizacao');
                if (statusEl) {
                    if (this.dados.dadosCarregados) {
                        statusEl.textContent = 'OK';
                        statusEl.style.color = 'var(--cor-primaria)';
                    } else {
                        statusEl.textContent = 'ERRO';
                        statusEl.style.color = '#dc3545';
                    }
                }
                
                const urlEl = document.getElementById('webappUrl');
                if (urlEl) {
                    if (this.WEBAPP_URL && !this.WEBAPP_URL.includes('SEU_ID')) {
                        urlEl.textContent = this.WEBAPP_URL.substring(0, 50) + '...';
                        urlEl.style.color = 'var(--cor-primaria)';
                    } else {
                        urlEl.textContent = 'N√£o configurada';
                        urlEl.style.color = '#dc3545';
                    }
                }
            },

            // =====================================================
            // FUN√á√ïES AUXILIARES
            // =====================================================

            atualizarStatusDados(mensagem, tipo) {
                const statusEl = document.getElementById('statusDados');
                if (statusEl) {
                    statusEl.className = `alert alert-${tipo}`;
                    statusEl.innerHTML = `<p><strong>${mensagem}</strong></p>`;
                }
            },

            atualizarStatusConexaoHome(conectado) {
                const statusEl = document.getElementById('statusConexaoHome');
                const textoEl = document.getElementById('textoStatus');
                
                if (statusEl && textoEl) {
                    if (conectado) {
                        statusEl.className = 'status-conexao status-conectado';
                        textoEl.textContent = 'üü¢ Conectado ao Google Sheets';
                    } else {
                        statusEl.className = 'status-conexao status-desconectado';
                        textoEl.textContent = 'üî¥ Sem conex√£o - Verifique configura√ß√µes';
                    }
                }
            },

            animarNumero(elementId, valorFinal, duracao = 1000) {
                const elemento = document.getElementById(elementId);
                if (!elemento) return;

                const valorInicial = parseFloat(elemento.textContent) || 0;
                const inicio = performance.now();

                const animar = (tempoAtual) => {
                    const decorrido = tempoAtual - inicio;
                    const progresso = Math.min(decorrido / duracao, 1);
                    const progressoSuave = 1 - Math.pow(1 - progresso, 3);
                    const valorAtual = valorInicial + (valorFinal - valorInicial) * progressoSuave;
                    
                    if (elementId.includes('media') || elementId.includes('Media')) {
                        elemento.textContent = valorAtual.toFixed(2);
                    } else {
                        elemento.textContent = Math.round(valorAtual);
                    }

                    if (progresso < 1) {
                        requestAnimationFrame(animar);
                    }
                };

                requestAnimationFrame(animar);
            },

            mostrarAlerta(mensagem, tipo) {
                const alertasExistentes = document.querySelectorAll('.alert');
                alertasExistentes.forEach(alerta => {
                    if (!alerta.id || alerta.id !== 'statusDados') {
                        alerta.remove();
                    }
                });

                const alerta = document.createElement('div');
                alerta.className = 'alert alert-' + tipo;
                alerta.innerHTML = mensagem;

                const secaoAtiva = document.querySelector('.section.active');
                secaoAtiva.insertBefore(alerta, secaoAtiva.firstChild);

                setTimeout(() => {
                    if (alerta.parentNode) {
                        alerta.remove();
                    }
                }, 5000);
            },

            mostrarLoading(mostrar) {
                const loading = document.getElementById('loading');
                if (loading) {
                    loading.style.display = mostrar ? 'block' : 'none';
                }
            },

            // =====================================================
            // INICIALIZA√á√ÉO
            // =====================================================

            async init() {
                console.log('üöÄ Iniciando Sistema G&G v3.1...');
                
                try {
                    // Carregar URL salva
                    const urlSalva = localStorage.getItem('webapp_url_gg');
                    if (urlSalva) {
                        this.WEBAPP_URL = urlSalva;
                        console.log('üîó URL carregada:', this.WEBAPP_URL);
                    }
                    
                    // Tentar carregar cache
                    try {
                        const cacheStorage = localStorage.getItem('gg_cache');
                        if (cacheStorage) {
                            const dadosCache = JSON.parse(cacheStorage);
                            this.cache = dadosCache;
                            this.dados.avaliacoes = dadosCache.avaliacoes || [];
                            this.dados.colaboradores = dadosCache.colaboradores || {};
                            this.dados.gestores = dadosCache.gestores || {};
                            console.log('üíæ Cache carregado');
                        }
                    } catch (error) {
                        console.warn('‚ö†Ô∏è Erro no cache:', error);
                    }
                    
                    // Verificar URL e carregar dados
                    if (this.WEBAPP_URL && !this.WEBAPP_URL.includes('SEU_ID')) {
                        console.log('üîó Carregando dados...');
                        await this.carregarDadosSalvos();
                    } else {
                        console.warn('‚ö†Ô∏è URL n√£o configurada');
                        this.atualizarStatusDados('‚ö†Ô∏è Configure a URL da Web App nas Configura√ß√µes', 'warning');
                        this.atualizarStatusConexaoHome(false);
                    }
                    
                    // Inicializar interface
                    this.atualizarEstatisticasHome();
                    
                    console.log('‚úÖ Sistema G&G v3.1 inicializado!');
                    
                } catch (error) {
                    console.error('‚ùå Erro na inicializa√ß√£o:', error);
                    this.atualizarStatusConexaoHome(false);
                    this.atualizarEstatisticasHome();
                    
                    setTimeout(() => {
                        this.mostrarAlerta('‚ùå Erro na inicializa√ß√£o: ' + error.message, 'danger');
                    }, 2000);
                }
            }
        };

        // =====================================================
        // INICIALIZA√á√ÉO DO SISTEMA
        // =====================================================

        document.addEventListener('DOMContentLoaded', function() {
            GG.init();
        });

        // Exposi√ß√£o global para debug
        window.sistemaGG = GG;

        console.log(`
üéØ SISTEMA G&G v3.1 - TOTALMENTE CORRIGIDO E OTIMIZADO
====================================================
‚úÖ Todas as fun√ß√µes corrigidas e testadas
‚úÖ Interface completamente funcional
‚úÖ Busca autom√°tica de colaboradores e gestores
‚úÖ Sistema de controle de acesso por filial
‚úÖ Integra√ß√£o completa com Google Sheets
‚úÖ Cache inteligente e recupera√ß√£o de erros
‚úÖ Debug e diagn√≥stico integrados

üîß CORRE√á√ïES APLICADAS:
‚Ä¢ Todas as fun√ß√µes onClick definidas corretamente
‚Ä¢ Sistema organizado em objeto √∫nico (GG)
‚Ä¢ Tratamento de erros robusto
‚Ä¢ Interface totalmente responsiva
‚Ä¢ Cache e fallback otimizados

üè¢ FILIAIS CADASTRADAS:
743-MS | 264-SC | 753-MT | 364-DF | 713-SP
468-MT | 892-SP | 723-SP | 230-SP | 773-RS
473-MT | 167-MS | 20-AGP

üíª DESENVOLVIDO POR: Juliano Patrick
üìß CONTATO: julianocorrea@bateforte.com.br
====================================================

üîß COMANDOS DE DEBUG:
‚Ä¢ sistemaGG.debugSistema() - Debug completo
‚Ä¢ sistemaGG.testarConexao() - Testar conex√£o
‚Ä¢ sistemaGG.sincronizarDados() - Sincronizar
        `);
    </script>
</body>
</html>
